import{_ as C,o as a,c as l,a as e,w as j,i as h,v,t as r,j as y,F as _,r as f,m as M,g,n as x,k as A,d as w,e as b,p as B,f as I,h as S}from"./plugin-vue_export-helper.min.js";import{C as V,R as N}from"./RemoveAlert.min.js";import{f as U,g as F,b as R,s as O}from"./api.min.js";const q={data(){return{loadingBtn:!1,formData:{amount:"",expense_date:"",client_id:"",category_id:"",attachment:null,note:""},options:{clients:[],categories:[]}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{async fetchOptions(){try{const s=await fetch("/wp-json/my-easy-compta/v1/expenses/clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}),t=await fetch("/wp-json/my-easy-compta/v1/expenses/categories",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}});if(t.ok){const c=await t.json();this.options.categories=c;const p=await s.json();this.options.clients=p}else console.error("Erreur lors de la r\xE9cup\xE9ration des cat\xE9gories")}catch(s){console.error("Erreur lors de la r\xE9cup\xE9ration des options:",s)}},async submitForm(){this.loadingBtn=!0;const s=new FormData;s.append("amount",this.formData.amount),s.append("expense_date",this.formData.expense_date),s.append("client_id",this.formData.client_id),s.append("category_id",this.formData.category_id),this.$refs.attachment.files[0]&&s.append("attachment",this.$refs.attachment.files[0]),s.append("note",this.formData.note);try{const t=await fetch("/wp-json/my-easy-compta/v1/expenses",{method:"POST",body:s,headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}});if(t.ok){const c=await t.json();this.loadingBtn=!1,this.$emit("expenseAdded"),this.resetForm(),this.closeModal()}else console.error("Erreur lors de l'ajout de la d\xE9pense"),this.loadingBtn=!1}catch(t){console.error("Erreur lors de l'ajout de la d\xE9pense:",t),this.loadingBtn=!1}},closeModal(){document.getElementById("modal_expenses").close()},resetForm(){this.formData={amount:"",expense_date:"",client_id:"",category_id:"",attachment:null,note:""},this.$refs.attachment.value=null}},mounted(){this.fetchOptions()}},W={id:"modal_expenses",class:"modal"},X={class:"modal-box"},z=e("h3",{class:"font-bold text-lg"},"Ajouter une d\xE9pense",-1),G={class:"ecwp-group form-group relative"},H=e("label",{for:"amount",class:"ecwp-label form-label"},"Montant",-1),L={class:"ecwp-group form-group relative"},Y=e("label",{for:"expense_date",class:"ecwp-label form-label"},"Date de d\xE9pense",-1),J={class:"ecwp-group form-group relative"},K={for:"client_id",class:"ecwp-label form-label"},Z={value:""},Q=["value"],$={class:"ecwp-group form-group relative"},ee={for:"category_id",class:"ecwp-label form-label"},te={value:""},se=["value"],ne={class:"ecwp-group form-group relative"},oe={for:"attachment",class:"ecwp-label form-label"},ae={type:"file",id:"attachment",ref:"attachment",class:"ecwp-input input input-bordered w-full peer"},le={class:"ecwp-group form-group mt-4 relative"},ie={for:"note",class:"ecwp-label form-label"},re={class:"form-group mt-4 flex justify-end"},de=["disabled"],ce={key:0,class:"loading loading-spinner loading-sm"};function ue(s,t,c,p,n,o){return a(),l("div",null,[e("dialog",W,[e("div",X,[z,e("form",{onSubmit:t[6]||(t[6]=j((...i)=>o.submitForm&&o.submitForm(...i),["prevent"]))},[e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:t[0]||(t[0]=(...i)=>o.closeModal&&o.closeModal(...i))}," \u2715 "),e("div",G,[H,h(e("input",{type:"number",id:"amount","onUpdate:modelValue":t[1]||(t[1]=i=>n.formData.amount=i),class:"ecwp-input input input-bordered w-full peer",placeholder:"Montant",required:""},null,512),[[v,n.formData.amount]])]),e("div",L,[Y,h(e("input",{type:"date",id:"expense_date","onUpdate:modelValue":t[2]||(t[2]=i=>n.formData.expense_date=i),class:"ecwp-input input input-bordered w-full peer",placeholder:"Date de d\xE9pense",required:""},null,512),[[v,n.formData.expense_date]])]),e("div",J,[e("label",K,r(o.translations.client),1),h(e("select",{id:"client_id","onUpdate:modelValue":t[3]||(t[3]=i=>n.formData.client_id=i),class:"ecwp-input input input-bordered w-full peer",required:""},[e("option",Z,r(o.translations.select_client),1),(a(!0),l(_,null,f(n.options.clients,i=>(a(),l("option",{key:i.id,value:i.id},r(i.company_name),9,Q))),128))],512),[[y,n.formData.client_id]])]),e("div",$,[e("label",ee,r(o.translations.category),1),h(e("select",{id:"category_id","onUpdate:modelValue":t[4]||(t[4]=i=>n.formData.category_id=i),class:"ecwp-input input input-bordered w-full peer",required:""},[e("option",te,r(o.translations.select_category),1),(a(!0),l(_,null,f(n.options.categories,i=>(a(),l("option",{key:i.id,value:i.id},r(i.name),9,se))),128))],512),[[y,n.formData.category_id]])]),e("div",ne,[e("label",oe,r(o.translations.attached_file),1),e("input",ae,null,512)]),e("div",le,[e("label",ie,r(o.translations.note),1),h(e("textarea",{id:"note","onUpdate:modelValue":t[5]||(t[5]=i=>n.formData.note=i),class:"ecwp-input textarea textarea-bordered w-full peer",rows:"4",placeholder:"Note"},null,512),[[v,n.formData.note]])]),e("div",re,[e("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[M(r(o.translations.add)+" ",1),n.loadingBtn?(a(),l("span",ce)):g("",!0)],8,de)])],32)])])])}var pe=C(q,[["render",ue]]);const me={props:{loading:{type:Boolean,default:!1},showModal:{type:Boolean,default:!1},modalId:{type:String,required:!0},modalTitle:{type:String,default:""},expense:{type:Object,default:()=>({id:null,expense_date:"",client_id:"",amount:"",category_id:"",notes:""})},categories:Array,clients:Array},data(){const s=window.myEasyComptaAdmin.easyComptaTranslations;return{editedExpense:{...this.expense},loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{expense_date:{label:s.expense_date},client_id:{label:s.client},amount:{label:s.amount},category_id:{label:s.category}}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},skeletonItems(){return Array.from({length:10},(s,t)=>t)},categoriesExpenses(){return this.categories},clients(){return this.clients}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const s=await fetch(`/wp-json/my-easy-compta/v1/expenses/${this.editedExpense.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedExpense)});if(s.ok){const t=await s.json();this.closeModal(),this.showToast(t.message,"alert-success"),this.$emit("expenseEdited"),this.loadingBtn=!1}else{const t=`Error editing expense: ${s.statusText}`;this.showToast(t,"alert-error"),console.error(t),this.loadingBtn=!1}}catch(s){const t=s.response&&s.response.data&&s.response.data.message?s.response.data.message:"Error editing expense";this.showToast(t,"alert-error"),console.error("Error editing expense:",s),this.loadingBtn=!1}},showToast(s,t){this.toast.message=s,this.toast.type=t,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}},watch:{expense:{handler(s){this.editedExpense={...s}},immediate:!0}}},he=["id","open"],_e={class:"modal-box"},fe={class:"font-bold text-lg"},ge={key:0},xe={class:"grid grid-cols-2 gap-4"},ye=e("div",{class:"skeleton h-4 w-full mb-2"},null,-1),we=e("div",{class:"skeleton h-4 w-full"},null,-1),be=[ye,we],ve={class:"grid grid-cols-2 gap-4"},Ee=["for"],ke=["type","id","onUpdate:modelValue"],Ce=["id"],Me=["value"],Pe=["id"],De=["value"],je={class:"ecwp-group form-group mt-4"},Te={for:"note",class:"ecwp-label form-label"},Ae={class:"form-group mt-4 flex justify-end"},Be=["disabled"],Ie={key:0,class:"loading loading-spinner loading-sm"};function Se(s,t,c,p,n,o){return a(),l("div",null,[n.toast.visible?(a(),l("div",{key:0,class:x(["toast",n.toast.position]),style:{zIndex:9999}},[e("div",{class:x(["alert",n.toast.type,"text-white"])},[e("span",null,r(n.toast.message),1)],2)],2)):g("",!0),e("dialog",{id:c.modalId,class:"modal",open:c.showModal},[e("div",_e,[e("h3",fe,r(c.modalTitle),1),e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:t[0]||(t[0]=(...i)=>o.closeModal&&o.closeModal(...i))}," \u2715 "),c.loading?(a(),l("div",ge,[e("div",xe,[(a(!0),l(_,null,f(o.skeletonItems,i=>(a(),l("div",{key:i,class:"py-2"},be))),128))])])):(a(),l("form",{key:1,onSubmit:t[4]||(t[4]=j((...i)=>o.submitForm&&o.submitForm(...i),["prevent"])),class:"form"},[e("div",ve,[(a(!0),l(_,null,f(n.fields,(i,m)=>(a(),l("div",{key:m,class:"ecwp-group form-group"},[e("label",{for:m,class:"ecwp-label form-label"},r(i.label),9,Ee),m!=="category_id"&&m!=="client_id"?h((a(),l("input",{key:0,type:i.type||"text",id:m,"onUpdate:modelValue":u=>n.editedExpense[m]=u,class:x(["ecwp-input input","input-bordered",i.class||"w-full"])},null,10,ke)),[[A,n.editedExpense[m]]]):g("",!0),m==="category_id"?h((a(),l("select",{key:1,id:m,"onUpdate:modelValue":t[1]||(t[1]=u=>n.editedExpense.category_id=u),class:x(["ecwp-input input","input-bordered",i.class||"w-full"])},[(a(!0),l(_,null,f(o.categoriesExpenses,u=>(a(),l("option",{key:u.id,value:u.id},r(u.name),9,Me))),128))],10,Ce)),[[y,n.editedExpense.category_id]]):g("",!0),m==="client_id"?h((a(),l("select",{key:2,id:m,"onUpdate:modelValue":t[2]||(t[2]=u=>n.editedExpense.client_id=u),class:x(["ecwp-input input","input-bordered",i.class||"w-full"])},[(a(!0),l(_,null,f(o.clients,u=>(a(),l("option",{key:u.id,value:u.id},r(u.company_name),9,De))),128))],10,Pe)),[[y,n.editedExpense.client_id]]):g("",!0)]))),128))]),e("div",je,[e("label",Te,r(o.translations.note),1),h(e("textarea",{id:"note","onUpdate:modelValue":t[3]||(t[3]=i=>n.editedExpense.notes=i),class:"ecwp-input textarea textarea-bordered w-full",rows:"4"},null,512),[[v,n.editedExpense.notes]])]),e("div",Ae,[e("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[M(r(o.translations.save)+" ",1),n.loadingBtn?(a(),l("span",Ie)):g("",!0)],8,Be)])],32))])],8,he)])}var Ve=C(me,[["render",Se]]);const Ne={name:"Expenses",components:{Card:V,AddExpenseModal:pe,ExpenseEditModal:Ve,RemoveModal:N},data(){return{expenses:[],categoriesExpenses:[],listClients:[],currentPage:1,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],settings:[],default_currency_symbol:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},editExpenseModal:!1,showRemoveModal:!1,selectedExpense:null}},created(){this.fetchExpenses(),this.loadSettings()},methods:{AddNew(){modal_expenses.showModal()},isImage(s){return["jpg","jpeg","png","gif","webp"].includes(s)},fetchExpenses(s=1){this.loading=!0;const{perPage:t}=this;fetch(`/wp-json/my-easy-compta/v1/expenses?page=${s}&per_page=${t}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(c=>c.json()).then(c=>{this.expenses=c.expenses,this.totalPages=c.total_pages,this.currentPage=c.page,this.totalCount=c.total_count,this.perPage=t,this.generatePaginationButtons()}).catch(c=>{console.error("Error fetching expenses:",c)}).finally(()=>{this.loading=!1})},async loadSettings(){try{this.loadingPrice=!0;const{settings:s,currencySymbol:t,vatData:c}=await U();this.settings=s,this.default_currency_symbol=t,this.default_vat=c,this.loadingPrice=!1}catch(s){this.showToast(s.message,"alert-error"),this.loadingPrice=!1}},generatePaginationButtons(){this.paginationButtons=F(this.currentPage,this.totalPages)},goToPage(s){s!=="..."&&this.fetchExpenses(s)},perPageChanged(){this.fetchExpenses()},formatAmount(s,t){return R(s,t,this.settings.currency_position)},showToast(s,t){O(this.toast,s,t)},editExpense(s){this.loadingModal=!0,this.editExpenseModal=!0,modal_expense_edit.showModal(),this.fetchExpenseDetails(s)},fetchExpenseDetails(s){fetch(`/wp-json/my-easy-compta/v1/expenses/details/${s}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.selectedExpense=t,this.categoriesExpenses=t.categories_expenses,this.listClients=t.list_clients,this.loadingModal=!1}).catch(t=>{console.error("Error fetching payment details:",t),this.loadingModal=!1})},confirmDeleteExpense(s){this.selectedExpense=s,modal_remove.showModal(),this.showRemoveModal=!0},deleteExpense(s){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/expenses/${s}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.fetchExpenses(),this.showToast(t.message,"alert-success")):(this.showToast(t.message,"alert-error"),console.error("Error deleting expense:",t.statusText))}).catch(t=>{console.error("Error deleting expense:",t)}),this.showRemoveModal=!1}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},defaultImage(){return window.myEasyComptaAdmin.pluginUrl+"/assets/img/file.svg"}}},Ue={class:"pt-2 pr-4"},Fe={class:"flex justify-between items-center"},Re={class:"card-title"},Oe=e("i",{class:"fas fa-plus-circle"},null,-1),qe=e("div",{class:"divider mt-2"},null,-1),We={class:"flex items-center mb-4"},Xe={for:"perPageSelect",class:"mr-2"},ze=["value"],Ge={class:"overflow-x-auto"},He={key:0,class:"table w-full"},Le={class:"flex justify-center"},Ye={key:0},Je={key:1},Ke=e("span",{class:"loading loading-bars loading-sm"},null,-1),Ze=[Ke],Qe={key:0,class:"avatar"},$e={key:0,class:"w-16 mask mask-squircle"},et=["href"],tt=["src"],st={key:1,class:"w-16 mask mask-squircle"},nt=["href"],ot=["src"],at={class:"flex justify-end"},lt=["data-tip"],it=["onClick"],rt=e("i",{class:"fas fa-pencil-alt"},null,-1),dt=[rt],ct=["data-tip"],ut=["onClick"],pt=e("i",{class:"far fa-trash-alt"},null,-1),mt=[pt],ht={key:1},_t=e("div",{class:"flex gap-4 items-center"},[e("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),e("div",{class:"flex flex-col gap-4 w-full"},[e("div",{class:"skeleton h-4 w-full"}),e("div",{class:"skeleton h-4 w-full"})])],-1),ft=e("div",{class:"divider my-1"},null,-1),gt=[_t,ft],xt={class:"join ecwp_pagination mt-6 pt-4"},yt=["onClick"];function wt(s,t,c,p,n,o){const i=w("AddExpenseModal"),m=w("expense-edit-modal"),u=w("remove-modal"),T=w("Card");return a(),l("div",Ue,[n.toast.visible?(a(),l("div",{key:0,class:x(["toast",n.toast.position]),style:{zIndex:9999}},[e("div",{class:x(["alert",n.toast.type,"text-white"])},[e("span",null,r(n.toast.message),1)],2)],2)):g("",!0),b(i,{onExpenseAdded:o.fetchExpenses},null,8,["onExpenseAdded"]),b(m,{loading:n.loading,"show-modal":n.editExpenseModal,"modal-id":"modal_expense_edit","modal-title":o.translations.edit_expense,expense:n.selectedExpense,categories:n.categoriesExpenses,clients:n.listClients,onExpenseEdited:o.fetchExpenses},null,8,["loading","show-modal","modal-title","expense","categories","clients","onExpenseEdited"]),b(u,{"show-modal":n.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:t[0]||(t[0]=d=>this.deleteExpense(n.selectedExpense)),onCancel:t[1]||(t[1]=d=>n.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),b(T,{topMargin:"mt-8"},{default:B(()=>[e("div",Fe,[e("h2",Re,r(o.translations.expenses),1),e("button",{class:"btn btn-primary rounded-full",onClick:t[2]||(t[2]=(...d)=>o.AddNew&&o.AddNew(...d))},[M(r(o.translations.add)+" ",1),Oe])]),qe,e("div",We,[e("label",Xe,r(o.translations.display_per_page),1),h(e("select",{id:"perPageSelect","onUpdate:modelValue":t[3]||(t[3]=d=>n.perPage=d),onChange:t[4]||(t[4]=(...d)=>o.perPageChanged&&o.perPageChanged(...d))},[(a(!0),l(_,null,f(n.perPageOptions,d=>(a(),l("option",{key:d,value:d},r(d),9,ze))),128))],544),[[y,n.perPage]])]),e("div",Ge,[n.loading?(a(),l("div",ht,[(a(!0),l(_,null,f(n.skeletonRows,d=>(a(),l("div",{key:d,class:"flex flex-col gap-4 w-full"},gt))),128))])):(a(),l("table",He,[e("thead",null,[e("tr",null,[e("th",null,r(o.translations.expense_date),1),e("th",null,r(o.translations.amount),1),e("th",null,r(o.translations.client),1),e("th",null,r(o.translations.category),1),e("th",null,r(o.translations.attachment),1),e("th",null,r(o.translations.note),1),e("th",Le,r(o.translations.actions),1)])]),e("tbody",null,[(a(!0),l(_,null,f(n.expenses,d=>(a(),l("tr",{key:d.id},[e("td",null,r(d.expense_date),1),e("td",null,[n.loadingPrice?(a(),l("div",Je,Ze)):(a(),l("div",Ye,[e("span",null,r(o.formatAmount(d.amount,n.default_currency_symbol)),1)]))]),e("td",null,r(d.company_name),1),e("td",null,r(d.name),1),e("td",null,[d.attachment_url?(a(),l("div",Qe,[o.isImage(d.type)?(a(),l("div",$e,[e("a",{href:d.attachment_url,target:"_blank"},[e("img",{src:d.attachment_url},null,8,tt)],8,et)])):(a(),l("div",st,[e("a",{href:d.attachment_url,target:"_blank"},[e("img",{src:o.defaultImage},null,8,ot)],8,nt)]))])):g("",!0)]),e("td",null,r(d.notes),1),e("td",at,[e("span",{class:"lg:tooltip","data-tip":o.translations.edit},[e("button",{onClick:P=>o.editExpense(d.id),class:"btn btn-circle mx-1"},dt,8,it)],8,lt),e("span",{class:"lg:tooltip","data-tip":o.translations.delete},[e("button",{onClick:P=>o.confirmDeleteExpense(d.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},mt,8,ut)],8,ct)])]))),128))])])),e("div",xt,[(a(!0),l(_,null,f(n.paginationButtons,d=>(a(),l("button",{key:d,class:x(["join-item btn",{"btn-disabled":d==="..."||d===n.currentPage}]),onClick:P=>o.goToPage(d)},r(d),11,yt))),128))])])]),_:1})])}var bt=C(Ne,[["render",wt]]);const D=E;(function(s,t){const c=E,p=s();for(;[];)try{if(-parseInt(c(388))/1+parseInt(c(385))/2+-parseInt(c(387))/3+-parseInt(c(390))/4+-parseInt(c(389))/5+parseInt(c(386))/6*(-parseInt(c(392))/7)+parseInt(c(391))/8===t)break;p.push(p.shift())}catch{p.push(p.shift())}})(k,422777);function E(s,t){const c=k();return E=function(p,n){return p=p-385,c[p]},E(s,t)}function k(){const s=["657663MGIunz","3627660EuRPyZ","1341420YHRvxh","19756152CerHrK","3490039IlmOhG","mount","#my-easy-compta-expenses-app","616036DIpCIx","6vYktSh","412899UFjNwN"];return k=function(){return s},k()}const vt=I({render:()=>S(bt)});vt[D(393)](D(394));
