import{_ as M,o as i,c as d,n as p,a as t,t as r,g as w,F as y,r as _,w as T,i as g,k as E,j as C,v as B,m as j,d as v,e as x,p as I,f as A,h as S}from"./plugin-vue_export-helper.min.js";import{C as D,R}from"./RemoveAlert.min.js";import{g as V,b as N,s as O,f as U}from"./api.min.js";const F={props:{loading:{type:Boolean,default:!1},showModal:{type:Boolean,default:!1},modalId:{type:String,required:!0},modalTitle:{type:String,default:""},payment:{type:Object,default:()=>({id:null,invoice_number:"",company_name:"",amount:"",payment_method_id:"",payment_date:"",note:"",payment_methods:[]})},disabled:{type:Boolean,default:!0},methods:Array},data(){const s=window.myEasyComptaAdmin.easyComptaTranslations;return{editedPayment:{...this.payment},loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{invoice_number:{label:s.invoice_number,disabled:this.disabled},company_name:{label:s.client,disabled:this.disabled},amount:{label:s.amount,disabled:!1},payment_method:{label:s.payment_method},payment_date:{label:s.payment_date}}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},paymentMethods(){return this.methods},skeletonItems(){return Array.from({length:10},(s,e)=>e)}},methods:{closeModal(){document.getElementById("modal_payment_edit").close()},async submitForm(){this.loadingBtn=!0;try{const s=await fetch(`/wp-json/my-easy-compta/v1/payments/${this.editedPayment.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedPayment)});if(s.ok){const e=await s.json();this.closeModal(),this.loadingBtn=!1,this.showToast(e.message,"alert-success"),this.$emit("paymentEdited")}else{this.loadingBtn=!1;const e=`Error editing payment: ${s.statusText}`;this.showToast(e,"alert-error"),console.error(e)}}catch(s){const e=s.response&&s.response.data&&s.response.data.message?s.response.data.message:"Error editing payment";this.showToast(e,"alert-error"),console.error("Error editing payment:",s),this.loadingBtn=!1}},showToast(s,e){this.toast.message=s,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}},watch:{payment:{handler(s){this.editedPayment={...s}},immediate:!0}}},L=["id","open"],W={class:"modal-box"},q={class:"font-bold text-lg"},z={key:0},X={class:"grid grid-cols-2 gap-4"},J=t("div",{class:"skeleton h-4 w-full mb-2"},null,-1),Q=t("div",{class:"skeleton h-4 w-full"},null,-1),Y=[J,Q],G={class:"grid grid-cols-2 gap-4"},H=["for"],K=["type","id","onUpdate:modelValue","disabled"],Z=["id"],$=["value"],ee={class:"ecwp-group form-group mt-4"},te={for:"note",class:"ecwp-label form-label"},se={class:"form-group mt-4 flex justify-end"},ne=["disabled"],ae={key:0,class:"loading loading-spinner loading-sm"};function oe(s,e,o,c,n,a){return i(),d("div",null,[n.toast.visible?(i(),d("div",{key:0,class:p(["toast",n.toast.position]),style:{zIndex:9999}},[t("div",{class:p(["alert",n.toast.type,"text-white"])},[t("span",null,r(n.toast.message),1)],2)],2)):w("",!0),t("dialog",{id:o.modalId,class:"modal",open:o.showModal},[t("div",W,[t("h3",q,r(o.modalTitle),1),t("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=(...m)=>a.closeModal&&a.closeModal(...m))}," \u2715 "),o.loading?(i(),d("div",z,[t("div",X,[(i(!0),d(y,null,_(a.skeletonItems,m=>(i(),d("div",{key:m,class:"py-2"},Y))),128))])])):(i(),d("form",{key:1,onSubmit:e[3]||(e[3]=T((...m)=>a.submitForm&&a.submitForm(...m),["prevent"])),class:"form"},[t("div",G,[(i(!0),d(y,null,_(n.fields,(m,h)=>(i(),d("div",{key:h,class:"ecwp-group form-group"},[t("label",{for:h,class:"ecwp-label form-label"},r(m.label),9,H),h!=="payment_method"?g((i(),d("input",{key:0,type:m.type||"text",id:h,"onUpdate:modelValue":u=>n.editedPayment[h]=u,class:p(["ecwp-input input","input-bordered",m.class||"w-full"]),disabled:m.disabled},null,10,K)),[[E,n.editedPayment[h]]]):g((i(),d("select",{key:1,id:h,"onUpdate:modelValue":e[1]||(e[1]=u=>n.editedPayment.payment_method_id=u),class:p(["ecwp-input input","input-bordered",m.class||"w-full"])},[(i(!0),d(y,null,_(a.paymentMethods,u=>(i(),d("option",{key:u.id,value:u.id},r(u.method_name),9,$))),128))],10,Z)),[[C,n.editedPayment.payment_method_id]])]))),128))]),t("div",ee,[t("label",te,r(a.translations.note),1),g(t("textarea",{id:"note","onUpdate:modelValue":e[2]||(e[2]=m=>n.editedPayment.notes=m),class:"ecwp-input textarea textarea-bordered w-full",rows:"4"},null,512),[[B,n.editedPayment.notes]])]),t("div",se,[t("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[j(r(a.translations.save)+" ",1),n.loadingBtn?(i(),d("span",ae)):w("",!0)],8,ne)])],32))])],8,L)])}var le=M(F,[["render",oe]]);const ie={name:"Payments",components:{Card:D,PaymentEditModal:le,RemoveModal:R},data(){return{payments:[],paymentMethods:[],paymentForm:{invoice_id:"",client_id:"",amount:"",payment_method_id:"",payment_date:""},editPaymentModal:!1,selectedPayment:null,currentPage:1,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,loadingModal:!1,showRemoveModal:!1,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],settings:[],default_currency_symbol:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},created(){this.fetchPayments(),this.loadSettings()},methods:{fetchPayments(s=1){this.loading=!0;const{perPage:e}=this;fetch(`/wp-json/my-easy-compta/v1/payments?page=${s}&per_page=${e}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(o=>o.json()).then(o=>{this.payments=o.payments,this.totalCount=o.total_count,this.totalPages=o.total_pages,this.currentPage=o.page,this.perPage=e,this.generatePaginationButtons()}).catch(o=>{console.error("Error fetching payments:",o)}).finally(()=>{this.loading=!1})},editPayment(s){this.loadingModal=!0,this.editPaymentModal=!0,modal_payment_edit.showModal(),this.fetchPaymentDetails(s)},fetchPaymentDetails(s){fetch(`/wp-json/my-easy-compta/v1/payments/details/${s}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{this.selectedPayment=e,this.paymentMethods=e.payment_methods,console.log(this.paymentMethods),this.loadingModal=!1}).catch(e=>{console.error("Error fetching payment details:",e),this.loadingModal=!1})},generatePaginationButtons(){this.paginationButtons=V(this.currentPage,this.totalPages)},goToPage(s){s!=="..."&&this.fetchPayments(s)},perPageChanged(){this.fetchPayments()},formatAmount(s,e){return N(s,e,this.settings.currency_position)},showToast(s,e){O(this.toast,s,e)},closePaymentModal(){this.showPaymentModal=!1},confirmDeletePayment(s){this.selectedPayment=s,modal_remove.showModal(),this.showRemoveModal=!0},deletePayment(s){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/payments/${s}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?(this.fetchPayments(),this.showToast(e.message,"alert-success")):(this.showToast(e.message,"alert-error"),console.error("Error deleting payment:",e.statusText))}).catch(e=>{console.error("Error deleting payment:",e)})},async loadSettings(){try{this.loadingPrice=!0;const{settings:s,currencySymbol:e,vatData:o}=await U();this.settings=s,this.default_currency_symbol=e,this.default_vat=o,this.loadingPrice=!1}catch(s){this.showToast(s.message,"alert-error"),this.loadingPrice=!1}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}}},de={class:"pt-2 pr-4"},re={class:"flex justify-between items-center"},me={class:"card-title"},ce=t("div",{class:"divider mt-2"},null,-1),he={class:"flex items-center mb-4"},ue={for:"perPageSelect",class:"mr-2"},pe=["value"],ye={class:"overflow-x-auto"},_e={key:0,class:"table w-full"},ge={class:"flex justify-center"},fe={key:0},be={key:1},ve=t("span",{class:"loading loading-bars loading-sm"},null,-1),xe=[ve],we={class:"flex justify-end"},Pe=["data-tip"],ke=["onClick"],Me=t("i",{class:"fas fa-pencil-alt"},null,-1),Ce=[Me],Te=["data-tip"],Ee=["onClick"],Be=t("i",{class:"far fa-trash-alt"},null,-1),je=[Be],Ie={key:1},Ae=t("div",{class:"flex gap-4 items-center"},[t("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),t("div",{class:"flex flex-col gap-4 w-full"},[t("div",{class:"skeleton h-4 w-full"}),t("div",{class:"skeleton h-4 w-full"})])],-1),Se=t("div",{class:"divider my-1"},null,-1),De=[Ae,Se],Re={class:"join ecwp_pagination mt-6 pt-4"},Ve=["onClick"];function Ne(s,e,o,c,n,a){const m=v("payment-edit-modal"),h=v("remove-modal"),u=v("Card");return i(),d("div",de,[n.toast.visible?(i(),d("div",{key:0,class:p(["toast",n.toast.position]),style:{zIndex:9999}},[t("div",{class:p(["alert",n.toast.type,"text-white"])},[t("span",null,r(n.toast.message),1)],2)],2)):w("",!0),x(m,{loading:n.loadingModal,"show-modal":n.editPaymentModal,"modal-id":"modal_payment_edit","modal-title":a.translations.edit_payment,payment:n.selectedPayment,methods:n.paymentMethods,onClose:e[0]||(e[0]=l=>n.editPaymentModal=!1),onPaymentEdited:a.fetchPayments},null,8,["loading","show-modal","modal-title","payment","methods","onPaymentEdited"]),x(h,{"show-modal":n.showRemoveModal,title:a.translations.are_you_sure,message:a.translations.no_turning_back,confirmText:a.translations.yes_delete_it,cancelText:a.translations.cancel,onConfirm:e[1]||(e[1]=l=>this.deletePayment(n.selectedPayment)),onCancel:e[2]||(e[2]=l=>n.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),x(u,{topMargin:"mt-8"},{default:I(()=>[t("div",re,[t("h2",me,r(a.translations.payments),1)]),ce,t("div",he,[t("label",ue,r(a.translations.display_per_page),1),g(t("select",{id:"perPageSelect","onUpdate:modelValue":e[3]||(e[3]=l=>n.perPage=l),onChange:e[4]||(e[4]=(...l)=>a.perPageChanged&&a.perPageChanged(...l))},[(i(!0),d(y,null,_(n.perPageOptions,l=>(i(),d("option",{key:l,value:l},r(l),9,pe))),128))],544),[[C,n.perPage]])]),t("div",ye,[n.loading?(i(),d("div",Ie,[(i(!0),d(y,null,_(n.skeletonRows,l=>(i(),d("div",{key:l,class:"flex flex-col gap-4 w-full"},De))),128))])):(i(),d("table",_e,[t("thead",null,[t("tr",null,[t("th",null,r(a.translations.invoice_number),1),t("th",null,r(a.translations.client),1),t("th",null,r(a.translations.payment_date),1),t("th",null,r(a.translations.amount),1),t("th",null,r(a.translations.payment_method),1),t("th",null,r(a.translations.note),1),t("th",ge,r(a.translations.actions),1)])]),t("tbody",null,[(i(!0),d(y,null,_(n.payments,l=>(i(),d("tr",{key:l.id},[t("td",null,r(l.invoice_number),1),t("td",null,r(l.company_name),1),t("td",null,r(l.payment_date),1),t("td",null,[n.loadingPrice?(i(),d("div",be,xe)):(i(),d("div",fe,[t("span",null,r(a.formatAmount(l.amount,n.default_currency_symbol)),1)]))]),t("td",null,r(l.method_name),1),t("td",null,r(l.notes),1),t("td",we,[t("span",{class:"lg:tooltip","data-tip":a.translations.edit},[t("button",{class:"btn btn-circle mx-1",onClick:P=>a.editPayment(l.id)},Ce,8,ke)],8,Pe),t("span",{class:"lg:tooltip","data-tip":a.translations.delete},[t("button",{onClick:P=>a.confirmDeletePayment(l.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},je,8,Ee)],8,Te)])]))),128))])])),t("div",Re,[(i(!0),d(y,null,_(n.paginationButtons,l=>(i(),d("button",{key:l,class:p(["join-item btn",{"btn-disabled":l==="..."||l===n.currentPage}]),onClick:P=>a.goToPage(l)},r(l),11,Ve))),128))])])]),_:1})])}var Oe=M(ie,[["render",Ne]]);const k=b;(function(s,e){const o=b,c=s();for(;[];)try{if(parseInt(o(304))/1*(-parseInt(o(306))/2)+parseInt(o(298))/3*(parseInt(o(300))/4)+-parseInt(o(308))/5*(parseInt(o(303))/6)+parseInt(o(302))/7*(-parseInt(o(296))/8)+-parseInt(o(307))/9+parseInt(o(299))/10*(parseInt(o(297))/11)+parseInt(o(309))/12===e)break;c.push(c.shift())}catch{c.push(c.shift())}})(f,405038);function f(){const s=["88mtkwmq","4684724pAgrOS","6DmlCTN","10RzDkbU","229728dwwtpT","#my-easy-compta-payments-app","17906yLnWcl","30jjqLuB","2kViOir","mount","211326RCLoMg","1593810qMNMsu","340860vQmvnO","7460448TLnWYl"];return f=function(){return s},f()}function b(s,e){const o=f();return b=function(c,n){return c=c-296,o[c]},b(s,e)}const Ue=A({render:()=>S(Oe)});Ue[k(305)](k(301));
