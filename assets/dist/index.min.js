import{s as Ps,u as ut,q as Ds,x as js,y as Gn,z as qs,A as yt,B as Ce,h as Yn,C as Yt,D as Ms,E as Rs,_ as he,d as Q,o as m,c as f,e as B,p as le,a as i,t as c,g as y,i as q,v as L,j as ye,F,r as W,m as T,w as re,n as G,G as Kn,H as Os}from"./plugin-vue_export-helper.min.js";import{C as Qe,R as xt}from"./RemoveAlert.min.js";import{f as Qt,c as Jn,a as Zn,g as $n,b as es,s as ts,p as ns}from"./api.min.js";import{v as Ut}from"./vue3-editor.common.min.js";/*!
  * vue-router v4.4.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Je=typeof document!="undefined";function Ns(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const X=Object.assign;function Kt(t,e){const s={};for(const a in e){const n=e[a];s[a]=Ie(n)?n.map(t):t(n)}return s}const ht=()=>{},Ie=Array.isArray,ss=/#/g,Bs=/&/g,Vs=/\//g,Fs=/=/g,Ws=/\?/g,os=/\+/g,Xs=/%5B/g,Qs=/%5D/g,is=/%5E/g,Us=/%60/g,as=/%7B/g,Ls=/%7C/g,ls=/%7D/g,zs=/%20/g;function gn(t){return encodeURI(""+t).replace(Ls,"|").replace(Xs,"[").replace(Qs,"]")}function Hs(t){return gn(t).replace(as,"{").replace(ls,"}").replace(is,"^")}function cn(t){return gn(t).replace(os,"%2B").replace(zs,"+").replace(ss,"%23").replace(Bs,"%26").replace(Us,"`").replace(as,"{").replace(ls,"}").replace(is,"^")}function Gs(t){return cn(t).replace(Fs,"%3D")}function Ys(t){return gn(t).replace(ss,"%23").replace(Ws,"%3F")}function Ks(t){return t==null?"":Ys(t).replace(Vs,"%2F")}function bt(t){try{return decodeURIComponent(""+t)}catch{}return""+t}const Js=/\/$/,Zs=t=>t.replace(Js,"");function Jt(t,e,s="/"){let a,n={},o="",h="";const r=e.indexOf("#");let d=e.indexOf("?");return r<d&&r>=0&&(d=-1),d>-1&&(a=e.slice(0,d),o=e.slice(d+1,r>-1?r:e.length),n=t(o)),r>-1&&(a=a||e.slice(0,r),h=e.slice(r,e.length)),a=no(a!=null?a:e,s),{fullPath:a+(o&&"?")+o+h,path:a,query:n,hash:bt(h)}}function $s(t,e){const s=e.query?t(e.query):"";return e.path+(s&&"?")+s+(e.hash||"")}function En(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function eo(t,e,s){const a=e.matched.length-1,n=s.matched.length-1;return a>-1&&a===n&&tt(e.matched[a],s.matched[n])&&rs(e.params,s.params)&&t(e.query)===t(s.query)&&e.hash===s.hash}function tt(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function rs(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(!to(t[s],e[s]))return!1;return!0}function to(t,e){return Ie(t)?In(t,e):Ie(e)?In(e,t):t===e}function In(t,e){return Ie(e)?t.length===e.length&&t.every((s,a)=>s===e[a]):t.length===1&&t[0]===e}function no(t,e){if(t.startsWith("/"))return t;if(!t)return e;const s=e.split("/"),a=t.split("/"),n=a[a.length-1];(n===".."||n===".")&&a.push("");let o=s.length-1,h,r;for(h=0;h<a.length;h++)if(r=a[h],r!==".")if(r==="..")o>1&&o--;else break;return s.slice(0,o).join("/")+"/"+a.slice(h).join("/")}const Be={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var wt;(function(t){t.pop="pop",t.push="push"})(wt||(wt={}));var mt;(function(t){t.back="back",t.forward="forward",t.unknown=""})(mt||(mt={}));function so(t){if(!t)if(Je){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),Zs(t)}const oo=/^[^#]+#/;function io(t,e){return t.replace(oo,"#")+e}function ao(t,e){const s=document.documentElement.getBoundingClientRect(),a=t.getBoundingClientRect();return{behavior:e.behavior,left:a.left-s.left-(e.left||0),top:a.top-s.top-(e.top||0)}}const Lt=()=>({left:window.scrollX,top:window.scrollY});function lo(t){let e;if("el"in t){const s=t.el,a=typeof s=="string"&&s.startsWith("#"),n=typeof s=="string"?a?document.getElementById(s.slice(1)):document.querySelector(s):s;if(!n)return;e=ao(n,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Cn(t,e){return(history.state?history.state.position-e:-1)+t}const dn=new Map;function ro(t,e){dn.set(t,e)}function co(t){const e=dn.get(t);return dn.delete(t),e}let uo=()=>location.protocol+"//"+location.host;function cs(t,e){const{pathname:s,search:a,hash:n}=e,o=t.indexOf("#");if(o>-1){let r=n.includes(t.slice(o))?t.slice(o).length:1,d=n.slice(r);return d[0]!=="/"&&(d="/"+d),En(d,"")}return En(s,t)+a+n}function ho(t,e,s,a){let n=[],o=[],h=null;const r=({state:g})=>{const _=cs(t,location),x=s.value,I=e.value;let M=0;if(g){if(s.value=_,e.value=g,h&&h===x){h=null;return}M=I?g.position-I.position:0}else a(_);n.forEach(N=>{N(s.value,x,{delta:M,type:wt.pop,direction:M?M>0?mt.forward:mt.back:mt.unknown})})};function d(){h=s.value}function u(g){n.push(g);const _=()=>{const x=n.indexOf(g);x>-1&&n.splice(x,1)};return o.push(_),_}function l(){const{history:g}=window;!g.state||g.replaceState(X({},g.state,{scroll:Lt()}),"")}function p(){for(const g of o)g();o=[],window.removeEventListener("popstate",r),window.removeEventListener("beforeunload",l)}return window.addEventListener("popstate",r),window.addEventListener("beforeunload",l,{passive:!0}),{pauseListeners:d,listen:u,destroy:p}}function Tn(t,e,s,a=!1,n=!1){return{back:t,current:e,forward:s,replaced:a,position:window.history.length,scroll:n?Lt():null}}function mo(t){const{history:e,location:s}=window,a={value:cs(t,s)},n={value:e.state};n.value||o(a.value,{back:null,current:a.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function o(d,u,l){const p=t.indexOf("#"),g=p>-1?(s.host&&document.querySelector("base")?t:t.slice(p))+d:uo()+t+d;try{e[l?"replaceState":"pushState"](u,"",g),n.value=u}catch(_){console.error(_),s[l?"replace":"assign"](g)}}function h(d,u){const l=X({},e.state,Tn(n.value.back,d,n.value.forward,!0),u,{position:n.value.position});o(d,l,!0),a.value=d}function r(d,u){const l=X({},n.value,e.state,{forward:d,scroll:Lt()});o(l.current,l,!0);const p=X({},Tn(a.value,d,null),{position:l.position+1},u);o(d,p,!1),a.value=d}return{location:a,state:n,push:r,replace:h}}function fo(t){t=so(t);const e=mo(t),s=ho(t,e.state,e.location,e.replace);function a(o,h=!0){h||s.pauseListeners(),history.go(o)}const n=X({location:"",base:t,go:a,createHref:io.bind(null,t)},e,s);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>e.state.value}),n}function po(t){return t=location.host?t||location.pathname+location.search:"",t.includes("#")||(t+="#"),fo(t)}function go(t){return typeof t=="string"||t&&typeof t=="object"}function ds(t){return typeof t=="string"||typeof t=="symbol"}const us=Symbol("");var kn;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(kn||(kn={}));function nt(t,e){return X(new Error,{type:t,[us]:!0},e)}function je(t,e){return t instanceof Error&&us in t&&(e==null||!!(t.type&e))}const An="[^/]+?",_o={sensitive:!1,strict:!1,start:!0,end:!0},vo=/[.+*?^${}()[\]/\\]/g;function yo(t,e){const s=X({},_o,e),a=[];let n=s.start?"^":"";const o=[];for(const u of t){const l=u.length?[]:[90];s.strict&&!u.length&&(n+="/");for(let p=0;p<u.length;p++){const g=u[p];let _=40+(s.sensitive?.25:0);if(g.type===0)p||(n+="/"),n+=g.value.replace(vo,"\\$&"),_+=40;else if(g.type===1){const{value:x,repeatable:I,optional:M,regexp:N}=g;o.push({name:x,repeatable:I,optional:M});const S=N||An;if(S!==An){_+=10;try{new RegExp(`(${S})`)}catch(z){throw new Error(`Invalid custom RegExp for param "${x}" (${S}): `+z.message)}}let D=I?`((?:${S})(?:/(?:${S}))*)`:`(${S})`;p||(D=M&&u.length<2?`(?:/${D})`:"/"+D),M&&(D+="?"),n+=D,_+=20,M&&(_+=-8),I&&(_+=-20),S===".*"&&(_+=-50)}l.push(_)}a.push(l)}if(s.strict&&s.end){const u=a.length-1;a[u][a[u].length-1]+=.7000000000000001}s.strict||(n+="/?"),s.end?n+="$":s.strict&&(n+="(?:/|$)");const h=new RegExp(n,s.sensitive?"":"i");function r(u){const l=u.match(h),p={};if(!l)return null;for(let g=1;g<l.length;g++){const _=l[g]||"",x=o[g-1];p[x.name]=_&&x.repeatable?_.split("/"):_}return p}function d(u){let l="",p=!1;for(const g of t){(!p||!l.endsWith("/"))&&(l+="/"),p=!1;for(const _ of g)if(_.type===0)l+=_.value;else if(_.type===1){const{value:x,repeatable:I,optional:M}=_,N=x in u?u[x]:"";if(Ie(N)&&!I)throw new Error(`Provided param "${x}" is an array but it is not repeatable (* or + modifiers)`);const S=Ie(N)?N.join("/"):N;if(!S)if(M)g.length<2&&(l.endsWith("/")?l=l.slice(0,-1):p=!0);else throw new Error(`Missing required param "${x}"`);l+=S}}return l||"/"}return{re:h,score:a,keys:o,parse:r,stringify:d}}function bo(t,e){let s=0;for(;s<t.length&&s<e.length;){const a=e[s]-t[s];if(a)return a;s++}return t.length<e.length?t.length===1&&t[0]===40+40?-1:1:t.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function hs(t,e){let s=0;const a=t.score,n=e.score;for(;s<a.length&&s<n.length;){const o=bo(a[s],n[s]);if(o)return o;s++}if(Math.abs(n.length-a.length)===1){if(Sn(a))return 1;if(Sn(n))return-1}return n.length-a.length}function Sn(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const wo={type:0,value:""},xo=/[a-zA-Z0-9_]/;function Eo(t){if(!t)return[[]];if(t==="/")return[[wo]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(_){throw new Error(`ERR (${s})/"${u}": ${_}`)}let s=0,a=s;const n=[];let o;function h(){o&&n.push(o),o=[]}let r=0,d,u="",l="";function p(){!u||(s===0?o.push({type:0,value:u}):s===1||s===2||s===3?(o.length>1&&(d==="*"||d==="+")&&e(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:u,regexp:l,repeatable:d==="*"||d==="+",optional:d==="*"||d==="?"})):e("Invalid state to consume buffer"),u="")}function g(){u+=d}for(;r<t.length;){if(d=t[r++],d==="\\"&&s!==2){a=s,s=4;continue}switch(s){case 0:d==="/"?(u&&p(),h()):d===":"?(p(),s=1):g();break;case 4:g(),s=a;break;case 1:d==="("?s=2:xo.test(d)?g():(p(),s=0,d!=="*"&&d!=="?"&&d!=="+"&&r--);break;case 2:d===")"?l[l.length-1]=="\\"?l=l.slice(0,-1)+d:s=3:l+=d;break;case 3:p(),s=0,d!=="*"&&d!=="?"&&d!=="+"&&r--,l="";break;default:e("Unknown state");break}}return s===2&&e(`Unfinished custom RegExp for param "${u}"`),p(),h(),n}function Io(t,e,s){const a=yo(Eo(t.path),s),n=X(a,{record:t,parent:e,children:[],alias:[]});return e&&!n.record.aliasOf==!e.record.aliasOf&&e.children.push(n),n}function Co(t,e){const s=[],a=new Map;e=jn({strict:!1,end:!0,sensitive:!1},e);function n(p){return a.get(p)}function o(p,g,_){const x=!_,I=To(p);I.aliasOf=_&&_.record;const M=jn(e,p),N=[I];if("alias"in p){const z=typeof p.alias=="string"?[p.alias]:p.alias;for(const ce of z)N.push(X({},I,{components:_?_.record.components:I.components,path:ce,aliasOf:_?_.record:I}))}let S,D;for(const z of N){const{path:ce}=z;if(g&&ce[0]!=="/"){const te=g.record.path,J=te[te.length-1]==="/"?"":"/";z.path=g.record.path+(ce&&J+ce)}if(S=Io(z,g,M),_?_.alias.push(S):(D=D||S,D!==S&&D.alias.push(S),x&&p.name&&!Dn(S)&&h(p.name)),ms(S)&&d(S),I.children){const te=I.children;for(let J=0;J<te.length;J++)o(te[J],S,_&&_.children[J])}_=_||S}return D?()=>{h(D)}:ht}function h(p){if(ds(p)){const g=a.get(p);g&&(a.delete(p),s.splice(s.indexOf(g),1),g.children.forEach(h),g.alias.forEach(h))}else{const g=s.indexOf(p);g>-1&&(s.splice(g,1),p.record.name&&a.delete(p.record.name),p.children.forEach(h),p.alias.forEach(h))}}function r(){return s}function d(p){const g=So(p,s);s.splice(g,0,p),p.record.name&&!Dn(p)&&a.set(p.record.name,p)}function u(p,g){let _,x={},I,M;if("name"in p&&p.name){if(_=a.get(p.name),!_)throw nt(1,{location:p});M=_.record.name,x=X(Pn(g.params,_.keys.filter(D=>!D.optional).concat(_.parent?_.parent.keys.filter(D=>D.optional):[]).map(D=>D.name)),p.params&&Pn(p.params,_.keys.map(D=>D.name))),I=_.stringify(x)}else if(p.path!=null)I=p.path,_=s.find(D=>D.re.test(I)),_&&(x=_.parse(I),M=_.record.name);else{if(_=g.name?a.get(g.name):s.find(D=>D.re.test(g.path)),!_)throw nt(1,{location:p,currentLocation:g});M=_.record.name,x=X({},g.params,p.params),I=_.stringify(x)}const N=[];let S=_;for(;S;)N.unshift(S.record),S=S.parent;return{name:M,path:I,params:x,matched:N,meta:Ao(N)}}t.forEach(p=>o(p));function l(){s.length=0,a.clear()}return{addRoute:o,resolve:u,removeRoute:h,clearRoutes:l,getRoutes:r,getRecordMatcher:n}}function Pn(t,e){const s={};for(const a of e)a in t&&(s[a]=t[a]);return s}function To(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:ko(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function ko(t){const e={},s=t.props||!1;if("component"in t)e.default=s;else for(const a in t.components)e[a]=typeof s=="object"?s[a]:s;return e}function Dn(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function Ao(t){return t.reduce((e,s)=>X(e,s.meta),{})}function jn(t,e){const s={};for(const a in t)s[a]=a in e?e[a]:t[a];return s}function So(t,e){let s=0,a=e.length;for(;s!==a;){const o=s+a>>1;hs(t,e[o])<0?a=o:s=o+1}const n=Po(t);return n&&(a=e.lastIndexOf(n,a-1)),a}function Po(t){let e=t;for(;e=e.parent;)if(ms(e)&&hs(t,e)===0)return e}function ms({record:t}){return!!(t.name||t.components&&Object.keys(t.components).length||t.redirect)}function Do(t){const e={};if(t===""||t==="?")return e;const a=(t[0]==="?"?t.slice(1):t).split("&");for(let n=0;n<a.length;++n){const o=a[n].replace(os," "),h=o.indexOf("="),r=bt(h<0?o:o.slice(0,h)),d=h<0?null:bt(o.slice(h+1));if(r in e){let u=e[r];Ie(u)||(u=e[r]=[u]),u.push(d)}else e[r]=d}return e}function qn(t){let e="";for(let s in t){const a=t[s];if(s=Gs(s),a==null){a!==void 0&&(e+=(e.length?"&":"")+s);continue}(Ie(a)?a.map(o=>o&&cn(o)):[a&&cn(a)]).forEach(o=>{o!==void 0&&(e+=(e.length?"&":"")+s,o!=null&&(e+="="+o))})}return e}function jo(t){const e={};for(const s in t){const a=t[s];a!==void 0&&(e[s]=Ie(a)?a.map(n=>n==null?null:""+n):a==null?a:""+a)}return e}const qo=Symbol(""),Mn=Symbol(""),_n=Symbol(""),fs=Symbol(""),un=Symbol("");function lt(){let t=[];function e(a){return t.push(a),()=>{const n=t.indexOf(a);n>-1&&t.splice(n,1)}}function s(){t=[]}return{add:e,list:()=>t.slice(),reset:s}}function Ve(t,e,s,a,n,o=h=>h()){const h=a&&(a.enterCallbacks[n]=a.enterCallbacks[n]||[]);return()=>new Promise((r,d)=>{const u=g=>{g===!1?d(nt(4,{from:s,to:e})):g instanceof Error?d(g):go(g)?d(nt(2,{from:e,to:g})):(h&&a.enterCallbacks[n]===h&&typeof g=="function"&&h.push(g),r())},l=o(()=>t.call(a&&a.instances[n],e,s,u));let p=Promise.resolve(l);t.length<3&&(p=p.then(u)),p.catch(g=>d(g))})}function Zt(t,e,s,a,n=o=>o()){const o=[];for(const h of t)for(const r in h.components){let d=h.components[r];if(!(e!=="beforeRouteEnter"&&!h.instances[r]))if(Mo(d)){const l=(d.__vccOpts||d)[e];l&&o.push(Ve(l,s,a,h,r,n))}else{let u=d();o.push(()=>u.then(l=>{if(!l)return Promise.reject(new Error(`Couldn't resolve component "${r}" at "${h.path}"`));const p=Ns(l)?l.default:l;h.components[r]=p;const _=(p.__vccOpts||p)[e];return _&&Ve(_,s,a,h,r,n)()}))}}return o}function Mo(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function Rn(t){const e=yt(_n),s=yt(fs),a=Ce(()=>{const d=ut(t.to);return e.resolve(d)}),n=Ce(()=>{const{matched:d}=a.value,{length:u}=d,l=d[u-1],p=s.matched;if(!l||!p.length)return-1;const g=p.findIndex(tt.bind(null,l));if(g>-1)return g;const _=On(d[u-2]);return u>1&&On(l)===_&&p[p.length-1].path!==_?p.findIndex(tt.bind(null,d[u-2])):g}),o=Ce(()=>n.value>-1&&Bo(s.params,a.value.params)),h=Ce(()=>n.value>-1&&n.value===s.matched.length-1&&rs(s.params,a.value.params));function r(d={}){return No(d)?e[ut(t.replace)?"replace":"push"](ut(t.to)).catch(ht):Promise.resolve()}return{route:a,href:Ce(()=>a.value.href),isActive:o,isExactActive:h,navigate:r}}const Ro=Gn({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Rn,setup(t,{slots:e}){const s=qs(Rn(t)),{options:a}=yt(_n),n=Ce(()=>({[Nn(t.activeClass,a.linkActiveClass,"router-link-active")]:s.isActive,[Nn(t.exactActiveClass,a.linkExactActiveClass,"router-link-exact-active")]:s.isExactActive}));return()=>{const o=e.default&&e.default(s);return t.custom?o:Yn("a",{"aria-current":s.isExactActive?t.ariaCurrentValue:null,href:s.href,onClick:s.navigate,class:n.value},o)}}}),Oo=Ro;function No(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function Bo(t,e){for(const s in e){const a=e[s],n=t[s];if(typeof a=="string"){if(a!==n)return!1}else if(!Ie(n)||n.length!==a.length||a.some((o,h)=>o!==n[h]))return!1}return!0}function On(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const Nn=(t,e,s)=>t!=null?t:e!=null?e:s,Vo=Gn({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:s}){const a=yt(un),n=Ce(()=>t.route||a.value),o=yt(Mn,0),h=Ce(()=>{let u=ut(o);const{matched:l}=n.value;let p;for(;(p=l[u])&&!p.components;)u++;return u}),r=Ce(()=>n.value.matched[h.value]);Yt(Mn,Ce(()=>h.value+1)),Yt(qo,r),Yt(un,n);const d=Ms();return Rs(()=>[d.value,r.value,t.name],([u,l,p],[g,_,x])=>{l&&(l.instances[p]=u,_&&_!==l&&u&&u===g&&(l.leaveGuards.size||(l.leaveGuards=_.leaveGuards),l.updateGuards.size||(l.updateGuards=_.updateGuards))),u&&l&&(!_||!tt(l,_)||!g)&&(l.enterCallbacks[p]||[]).forEach(I=>I(u))},{flush:"post"}),()=>{const u=n.value,l=t.name,p=r.value,g=p&&p.components[l];if(!g)return Bn(s.default,{Component:g,route:u});const _=p.props[l],x=_?_===!0?u.params:typeof _=="function"?_(u):_:null,M=Yn(g,X({},x,e,{onVnodeUnmounted:N=>{N.component.isUnmounted&&(p.instances[l]=null)},ref:d}));return Bn(s.default,{Component:M,route:u})||M}}});function Bn(t,e){if(!t)return null;const s=t(e);return s.length===1?s[0]:s}const Fo=Vo;function Wo(t){const e=Co(t.routes,t),s=t.parseQuery||Do,a=t.stringifyQuery||qn,n=t.history,o=lt(),h=lt(),r=lt(),d=Ps(Be);let u=Be;Je&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const l=Kt.bind(null,v=>""+v),p=Kt.bind(null,Ks),g=Kt.bind(null,bt);function _(v,E){let w,C;return ds(v)?(w=e.getRecordMatcher(v),C=E):C=v,e.addRoute(C,w)}function x(v){const E=e.getRecordMatcher(v);E&&e.removeRoute(E)}function I(){return e.getRoutes().map(v=>v.record)}function M(v){return!!e.getRecordMatcher(v)}function N(v,E){if(E=X({},E||d.value),typeof v=="string"){const j=Jt(s,v,E.path),ne=e.resolve({path:j.path},E),at=n.createHref(j.fullPath);return X(j,ne,{params:g(ne.params),hash:bt(j.hash),redirectedFrom:void 0,href:at})}let w;if(v.path!=null)w=X({},v,{path:Jt(s,v.path,E.path).path});else{const j=X({},v.params);for(const ne in j)j[ne]==null&&delete j[ne];w=X({},v,{params:p(j)}),E.params=p(E.params)}const C=e.resolve(w,E),U=v.hash||"";C.params=l(g(C.params));const Z=$s(a,X({},v,{hash:Hs(U),path:C.path})),R=n.createHref(Z);return X({fullPath:Z,hash:U,query:a===qn?jo(v.query):v.query||{}},C,{redirectedFrom:void 0,href:R})}function S(v){return typeof v=="string"?Jt(s,v,d.value.path):X({},v)}function D(v,E){if(u!==v)return nt(8,{from:E,to:v})}function z(v){return J(v)}function ce(v){return z(X(S(v),{replace:!0}))}function te(v){const E=v.matched[v.matched.length-1];if(E&&E.redirect){const{redirect:w}=E;let C=typeof w=="function"?w(v):w;return typeof C=="string"&&(C=C.includes("?")||C.includes("#")?C=S(C):{path:C},C.params={}),X({query:v.query,hash:v.hash,params:C.path!=null?{}:v.params},C)}}function J(v,E){const w=u=N(v),C=d.value,U=v.state,Z=v.force,R=v.replace===!0,j=te(w);if(j)return J(X(S(j),{state:typeof j=="object"?X({},U,j.state):U,force:Z,replace:R}),E||w);const ne=w;ne.redirectedFrom=E;let at;return!Z&&eo(a,C,w)&&(at=nt(16,{to:ne,from:C}),ot(C,C,!0,!1)),(at?Promise.resolve(at):Oe(ne,C)).catch(me=>je(me)?je(me,2)?me:Ct(me):De(me,ne,C)).then(me=>{if(me){if(je(me,2))return J(X({replace:R},S(me.to),{state:typeof me.to=="object"?X({},U,me.to.state):U,force:Z}),E||ne)}else me=Ne(ne,C,!0,R,U);return be(ne,C,me),me})}function Ue(v,E){const w=D(v,E);return w?Promise.reject(w):Promise.resolve()}function se(v){const E=Tt.values().next().value;return E&&typeof E.runWithContext=="function"?E.runWithContext(v):v()}function Oe(v,E){let w;const[C,U,Z]=Xo(v,E);w=Zt(C.reverse(),"beforeRouteLeave",v,E);for(const j of C)j.leaveGuards.forEach(ne=>{w.push(Ve(ne,v,E))});const R=Ue.bind(null,v,E);return w.push(R),Ge(w).then(()=>{w=[];for(const j of o.list())w.push(Ve(j,v,E));return w.push(R),Ge(w)}).then(()=>{w=Zt(U,"beforeRouteUpdate",v,E);for(const j of U)j.updateGuards.forEach(ne=>{w.push(Ve(ne,v,E))});return w.push(R),Ge(w)}).then(()=>{w=[];for(const j of Z)if(j.beforeEnter)if(Ie(j.beforeEnter))for(const ne of j.beforeEnter)w.push(Ve(ne,v,E));else w.push(Ve(j.beforeEnter,v,E));return w.push(R),Ge(w)}).then(()=>(v.matched.forEach(j=>j.enterCallbacks={}),w=Zt(Z,"beforeRouteEnter",v,E,se),w.push(R),Ge(w))).then(()=>{w=[];for(const j of h.list())w.push(Ve(j,v,E));return w.push(R),Ge(w)}).catch(j=>je(j,8)?j:Promise.reject(j))}function be(v,E,w){r.list().forEach(C=>se(()=>C(v,E,w)))}function Ne(v,E,w,C,U){const Z=D(v,E);if(Z)return Z;const R=E===Be,j=Je?history.state:{};w&&(C||R?n.replace(v.fullPath,X({scroll:R&&j&&j.scroll},U)):n.push(v.fullPath,U)),d.value=v,ot(v,E,w,R),Ct()}let de;function Ae(){de||(de=n.listen((v,E,w)=>{if(!xn.listening)return;const C=N(v),U=te(C);if(U){J(X(U,{replace:!0}),C).catch(ht);return}u=C;const Z=d.value;Je&&ro(Cn(Z.fullPath,w.delta),Lt()),Oe(C,Z).catch(R=>je(R,12)?R:je(R,2)?(J(R.to,C).then(j=>{je(j,20)&&!w.delta&&w.type===wt.pop&&n.go(-1,!1)}).catch(ht),Promise.reject()):(w.delta&&n.go(-w.delta,!1),De(R,C,Z))).then(R=>{R=R||Ne(C,Z,!1),R&&(w.delta&&!je(R,8)?n.go(-w.delta,!1):w.type===wt.pop&&je(R,20)&&n.go(-1,!1)),be(C,Z,R)}).catch(ht)}))}let Se=lt(),we=lt(),Pe;function De(v,E,w){Ct(v);const C=we.list();return C.length?C.forEach(U=>U(v,E,w)):console.error(v),Promise.reject(v)}function Ht(){return Pe&&d.value!==Be?Promise.resolve():new Promise((v,E)=>{Se.add([v,E])})}function Ct(v){return Pe||(Pe=!v,Ae(),Se.list().forEach(([E,w])=>v?w(v):E()),Se.reset()),v}function ot(v,E,w,C){const{scrollBehavior:U}=t;if(!Je||!U)return Promise.resolve();const Z=!w&&co(Cn(v.fullPath,0))||(C||!w)&&history.state&&history.state.scroll||null;return js().then(()=>U(v,E,Z)).then(R=>R&&lo(R)).catch(R=>De(R,v,E))}const it=v=>n.go(v);let Gt;const Tt=new Set,xn={currentRoute:d,listening:!0,addRoute:_,removeRoute:x,clearRoutes:e.clearRoutes,hasRoute:M,getRoutes:I,resolve:N,options:t,push:z,replace:ce,go:it,back:()=>it(-1),forward:()=>it(1),beforeEach:o.add,beforeResolve:h.add,afterEach:r.add,onError:we.add,isReady:Ht,install(v){const E=this;v.component("RouterLink",Oo),v.component("RouterView",Fo),v.config.globalProperties.$router=E,Object.defineProperty(v.config.globalProperties,"$route",{enumerable:!0,get:()=>ut(d)}),Je&&!Gt&&d.value===Be&&(Gt=!0,z(n.location).catch(U=>{}));const w={};for(const U in Be)Object.defineProperty(w,U,{get:()=>d.value[U],enumerable:!0});v.provide(_n,E),v.provide(fs,Ds(w)),v.provide(un,d);const C=v.unmount;Tt.add(v),v.unmount=function(){Tt.delete(v),Tt.size<1&&(u=Be,de&&de(),de=null,d.value=Be,Gt=!1,Pe=!1),C()}}};function Ge(v){return v.reduce((E,w)=>E.then(()=>se(w)),Promise.resolve())}return xn}function Xo(t,e){const s=[],a=[],n=[],o=Math.max(e.matched.length,t.matched.length);for(let h=0;h<o;h++){const r=e.matched[h];r&&(t.matched.find(u=>tt(u,r))?a.push(r):s.push(r));const d=t.matched[h];d&&(e.matched.find(u=>tt(u,d))||n.push(d))}return[s,a,n]}const Qo={name:"QuoteEdit",components:{Card:Qe},data(){return{quote:{quote_number:"",due_date:"",provisional_start_date:"",client_id:"",client:null,status:"pending"},loading:!1,loadingBtn:!1,clients:[],settings:[],toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},mounted(){this.fetchClients(),this.fetchSettings(),this.fetchQuoteDetails()},methods:{cancelAction(){this.$router.push("/quotes")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients,this.quote.client_id&&this.setClientById(this.quote.client_id)}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e}else{const e=await t.json();console.error("Error fetching settings:",e)}}catch(t){this.loading=!1,console.error("Error fetching settings:",t)}},fetchQuoteDetails(){const t=this.$route.params.id;!t||(this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{e?(this.quote=e,this.setClientById(this.quote.client_id)):(console.error("Error fetching quote details:",e.message),this.showToast(e.message,"alert-error"))}).catch(e=>{console.error("Error fetching quote details:",e),this.showToast(e,"alert-error")}).finally(()=>{this.loading=!1}))},setClientById(t){this.quote.client=this.clients.find(e=>e.id===t)||null},submitQuote(){this.loadingBtn=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${this.$route.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.quote)}).then(t=>{if(!t.ok)throw this.loadingBtn=!1,new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"QuoteViewDetail",params:{id:t.id}})):(console.error("Error submitting quote:",t.message),this.showToast(t.message,"alert-error"),this.loadingBtn=!1)}).catch(t=>{console.error("Error submitting quote:",t),this.showToast(t,"alert-error"),this.loadingBtn=!1})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Uo={class:"pt-2 pr-4"},Lo={class:"flex justify-between items-center mb-4"},zo={class:"card-title"},Ho=i("div",{class:"divider mt-2"},null,-1),Go={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},Yo={class:"grid grid-cols-3 gap-4"},Ko={class:"ecwp-group form-group mb-4"},Jo={for:"quoteNumber",class:"ecwp-label"},Zo={class:"ecwp-group form-group mb-4"},$o={for:"quoteDate",class:"ecwp-label"},ei=["value"],ti={class:"ecwp-group form-group mb-4"},ni={for:"quoteProvisanalDate",class:"ecwp-label"},si={class:"grid grid-cols-2 gap-4"},oi={class:"ecwp-group form-group mb-4"},ii={for:"client",class:"ecwp-label"},ai=["value","selected"],li={class:"ecwp-group form-group mb-4"},ri={for:"status",class:"ecwp-label"},ci={value:"draft"},di={value:"pending"},ui={value:"approved"},hi={value:"rejected"},mi={class:"flex justify-between"},fi=["disabled"],pi={key:0,class:"loading loading-spinner loading-sm"};function gi(t,e,s,a,n,o){const h=Q("Card");return m(),f("div",Uo,[B(h,{topMargin:"mt-8",modalType:"modal_quote_new"},{default:le(()=>[i("div",Lo,[i("h2",zo,c(o.translations.edit_quote),1)]),Ho,n.loading?(m(),f("div",Go)):y("",!0),i("form",{onSubmit:e[6]||(e[6]=re((...r)=>o.submitQuote&&o.submitQuote(...r),["prevent"]))},[i("div",Yo,[i("div",Ko,[i("label",Jo,c(o.translations.quote_number),1),q(i("input",{type:"text",id:"quoteNumber","onUpdate:modelValue":e[0]||(e[0]=r=>n.quote.quote_number=r),class:"ecwp-input input input-bordered w-full",disabled:"true"},null,512),[[L,n.quote.quote_number]])]),i("div",Zo,[i("label",$o,c(o.translations.due_date),1),q(i("input",{type:"date",id:"quoteDate","onUpdate:modelValue":e[1]||(e[1]=r=>n.quote.due_date=r),value:n.quote.due_date,class:"ecwp-input input input-bordered w-full",required:""},null,8,ei),[[L,n.quote.due_date]])]),i("div",ti,[i("label",ni,c(o.translations.provisional_date),1),q(i("input",{type:"date",id:"quoteProvisanalDate","onUpdate:modelValue":e[2]||(e[2]=r=>n.quote.provisional_start_date=r),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[L,n.quote.provisional_start_date]])])]),i("div",si,[i("div",oi,[i("label",ii,c(o.translations.company_name),1),q(i("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>n.quote.client_id=r),class:"ecwp-input input input-bordered w-full"},[(m(!0),f(F,null,W(n.clients,r=>(m(),f("option",{value:r.id,key:r.id,selected:r.id===n.quote.client_id},c(r.company_name)+" - "+c(r.email)+" ( "+c(r.currency_symbol)+" ) ",9,ai))),128))],512),[[ye,n.quote.client_id]])]),i("div",li,[i("label",ri,c(o.translations.status),1),q(i("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=r=>n.quote.status=r),class:"ecwp-input select select-bordered w-full"},[i("option",ci,c(o.translations.draft),1),i("option",di,c(o.translations.pending),1),i("option",ui,c(o.translations.approved),1),i("option",hi,c(o.translations.rejected),1)],512),[[ye,n.quote.status]])])]),i("div",mi,[i("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[5]||(e[5]=(...r)=>o.cancelAction&&o.cancelAction(...r))},c(o.translations.cancel),1),i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",pi)):y("",!0)],8,fi)])],32)]),_:1})])}var ps=he(Qo,[["render",gi]]);const _i={props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"Confirmation"},message:{type:String,default:"Are you sure?"},confirmText:{type:String,default:"Confirm"},cancelText:{type:String,default:"Cancel"},status:{type:String}},data(){return{selectedPaymentMethod:""}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{onConfirm(){this.$emit("confirm",this.selectedPaymentMethod),this.closeModal()},onCancel(){this.$emit("cancel"),this.closeModal()},closeModal(){document.getElementById("modal_confirm").close()}}},vi=["open"],yi={class:"modal-box"},bi={class:"font-bold text-lg"},wi=i("div",{class:"text-center text-red-400 mb-2"},[i("i",{class:"fas fa-exclamation-triangle text-4xl"})],-1),xi={class:"text-lg font-semibold text-center"},Ei={class:"my-4 text-center text-xl"},Ii={class:"flex justify-between space-x-4"};function Ci(t,e,s,a,n,o){return m(),f("div",null,[i("dialog",{id:"modal_confirm",class:"modal",open:t.showModal},[i("div",yi,[i("h3",bi,c(t.modalTitle),1),i("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=(...h)=>o.closeModal&&o.closeModal(...h))}," \u2715 "),wi,i("h2",xi,c(s.title),1),i("p",Ei,c(s.message),1),i("div",Ii,[i("button",{onClick:e[1]||(e[1]=(...h)=>o.onCancel&&o.onCancel(...h)),class:"btn btn-secondary rounded-full"},c(s.cancelText),1),i("button",{onClick:e[2]||(e[2]=(...h)=>o.onConfirm&&o.onConfirm(...h)),class:"btn rounded-full btn-error text-white"},c(s.confirmText),1)])])],8,vi)])}var vn=he(_i,[["render",Ci]]);const Ti={name:"QuotesList",components:{Card:Qe,QuoteEditModal:ps,ConfirmModal:vn,RemoveModal:xt},data(){return{quotes:[],showQuoteDetailsModal:!1,editQuoteModal:!1,selectedQuote:null,currentPage:1,totalCount:0,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,loadingModal:!1,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",settings:{},toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},created(){this.fetchQuotes(),this.loadSettings()},methods:{fetchQuotes(t=1){this.loading=!0;const{perPage:e}=this;fetch(`/wp-json/my-easy-compta/v1/quotes?page=${t}&per_page=${e}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>s.json()).then(s=>{this.quotes=s.quotes,this.totalCount=s.total_count,this.totalPages=s.total_pages,this.currentPage=t,this.perPage=e,this.generatePaginationButtons()}).catch(s=>{console.error("Error fetching quotes:",s)}).finally(()=>{this.loading=!1})},async loadSettings(){try{this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s}=await Qt();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.loadingPrice=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1}},calculateVAT(t){return Jn(t,this.default_vat.rate)},calculateWithoutVAT(t){return Zn(t)},generatePaginationButtons(){this.paginationButtons=$n(this.currentPage,this.totalPages)},goToPage(t){t!=="..."&&this.fetchQuotes(t)},perPageChanged(){this.fetchQuotes()},formatAmount(t,e){return es(t,e,this.settings.currency_position)},confirmDuplicateQuote(t){this.selectedQuote=t,modal_confirm.showModal(),this.showRemoveModal=!0},duplicateQuote(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/duplicate/${t}`,{method:"POST",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?(this.fetchQuotes(),this.showToast(e.message,"alert-success")):(this.showToast(e.message,"alert-error"),console.error("Error duplicate quote:",e.statusText))}).catch(e=>{console.log(e.message),this.showToast(e.message,"alert-error")})},confirmDeleteQuote(t){this.selectedQuote=t,modal_remove.showModal(),this.showRemoveModal=!0},deleteQuote(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/delete/${t}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?(this.fetchQuotes(),this.showToast(e.message,"alert-success")):(this.showToast(e.message,"alert-error"),console.error("Error deleting quote:",e.statusText))}).catch(e=>{console.log(e.message),this.showToast(e.message,"alert-error")})},showToast(t,e){ts(this.toast,t,e)}},computed:{skeletonItems(){return Array.from({length:5},(t,e)=>e)},totalPages(){return Math.ceil(this.totalCount/this.perPage)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}}},ki={class:"pt-2 pr-4"},Ai={class:"flex justify-between items-center"},Si={class:"card-title"},Pi={class:"btn btn-primary rounded-full"},Di=i("i",{class:"fas fa-plus-circle"},null,-1),ji=i("div",{class:"divider mt-2"},null,-1),qi={class:"overflow-x-auto"},Mi={key:0,class:"table w-full"},Ri={class:"flex justify-center"},Oi={key:0,class:"badge badge-warning badge-outline badge-sm"},Ni={key:1,class:"badge badge-secondary badge-outline badge-sm"},Bi={key:2,class:"badge badge-success badge-outline badge-sm"},Vi={key:3,class:"badge badge-error badge-outline badge-sm"},Fi={key:0},Wi={key:0},Xi={key:0},Qi={key:1},Ui={key:1},Li={key:0},zi={key:1},Hi={key:1},Gi=i("span",{class:"loading loading-bars loading-sm"},null,-1),Yi=[Gi],Ki={key:0},Ji={key:1},Zi=i("span",{class:"loading loading-bars loading-sm"},null,-1),$i=[Zi],ea={key:0},ta={key:1},na=i("span",{class:"loading loading-bars loading-sm"},null,-1),sa=[na],oa={class:"flex justify-end"},ia=["data-tip"],aa=i("button",{class:"btn btn-circle mx-1"},[i("i",{class:"far fa-eye"})],-1),la=["data-tip"],ra=i("button",{class:"btn btn-circle mx-1"},[i("i",{class:"fas fa-pencil-alt"})],-1),ca=["data-tip"],da=["onClick"],ua=i("i",{class:"far fa-copy"},null,-1),ha=[ua],ma=["data-tip"],fa=["onClick"],pa=i("i",{class:"far fa-trash-alt"},null,-1),ga=[pa],_a={key:1},va=i("div",{class:"flex gap-4 items-center"},[i("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),i("div",{class:"flex flex-col gap-4 w-full"},[i("div",{class:"skeleton h-4 w-full"}),i("div",{class:"skeleton h-4 w-full"})])],-1),ya=i("div",{class:"divider my-1"},null,-1),ba=[va,ya],wa={class:"join ecwp_pagination mt-6 pt-4"},xa=["onClick"];function Ea(t,e,s,a,n,o){const h=Q("confirm-modal"),r=Q("remove-modal"),d=Q("router-link"),u=Q("Card");return m(),f("div",ki,[n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),B(h,{"show-modal":t.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=l=>this.duplicateQuote(n.selectedQuote)),onCancel:e[1]||(e[1]=l=>t.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),B(r,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[2]||(e[2]=l=>this.deleteQuote(n.selectedQuote)),onCancel:e[3]||(e[3]=l=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),B(u,{topMargin:"mt-8"},{default:le(()=>[i("div",Ai,[i("h2",Si,c(o.translations.quotes),1),B(d,{to:{name:"QuoteNew"}},{default:le(()=>[i("button",Pi,[T(c(o.translations.add)+" ",1),Di])]),_:1})]),ji,i("div",qi,[n.loading?(m(),f("div",_a,[(m(!0),f(F,null,W(n.skeletonRows,l=>(m(),f("div",{key:l,class:"flex flex-col gap-4 w-full"},ba))),128))])):(m(),f("table",Mi,[i("thead",null,[i("tr",null,[i("th",null,c(o.translations.quote_number),1),i("th",null,c(o.translations.client),1),i("th",null,c(o.translations.status),1),i("th",null,c(o.translations.total),1),i("th",null,c(o.translations.due_date),1),i("th",null,c(o.translations.created_at),1),i("th",Ri,c(o.translations.actions),1)])]),i("tbody",null,[(m(!0),f(F,null,W(n.quotes,l=>(m(),f("tr",{key:l.id},[i("td",null,c(l.quote_number),1),i("td",null,c(l.client_name),1),i("td",null,[l.status=="draft"?(m(),f("span",Oi,c(o.translations.draft),1)):y("",!0),l.status=="pending"?(m(),f("span",Ni,c(o.translations.pending),1)):y("",!0),l.status=="approved"?(m(),f("span",Bi,c(o.translations.approved),1)):y("",!0),l.status=="rejected"?(m(),f("span",Vi,c(o.translations.rejected),1)):y("",!0)]),i("td",null,[n.loadingPrice?(m(),f("div",Hi,Yi)):(m(),f("div",Fi,[n.settings.vat_active==1?(m(),f("div",Wi,[n.default_currency_symbol==l.client_currency||l.client_currency==null?(m(),f("span",Xi,c(o.formatAmount(l.total_amount,n.default_currency_symbol)),1)):(m(),f("span",Qi,c(o.formatAmount(l.total_amount,l.client_currency)),1))])):(m(),f("div",Ui,[n.default_currency_symbol==l.client_currency||l.client_currency==null?(m(),f("span",Li,c(o.formatAmount(l.total_amount,n.default_currency_symbol)),1)):(m(),f("span",zi,c(o.formatAmount(l.total_amount,l.client_currency)),1))]))]))]),i("td",null,[n.loadingPrice?(m(),f("div",Ji,$i)):(m(),f("div",Ki,c(l.due_date),1))]),i("td",null,[n.loadingPrice?(m(),f("div",ta,sa)):(m(),f("div",ea,c(l.created),1))]),i("td",oa,[i("span",{class:"lg:tooltip","data-tip":o.translations.view},[B(d,{to:{name:"QuoteViewDetail",params:{id:l.id}}},{default:le(()=>[aa]),_:2},1032,["to"])],8,ia),i("span",{class:"lg:tooltip","data-tip":o.translations.edit},[B(d,{to:{name:"QuoteEdit",params:{id:l.id}}},{default:le(()=>[ra]),_:2},1032,["to"])],8,la),i("span",{class:"lg:tooltip","data-tip":o.translations.duplicate},[i("button",{onClick:p=>o.confirmDuplicateQuote(l.id),class:"btn btn-circle text-purple-600 hover:text-purple-900 mx-1"},ha,8,da)],8,ca),i("span",{class:"lg:tooltip","data-tip":o.translations.delete},[i("button",{onClick:p=>o.confirmDeleteQuote(l.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},ga,8,fa)],8,ma)])]))),128))])]))]),i("div",wa,[(m(!0),f(F,null,W(n.paginationButtons,l=>(m(),f("button",{key:l,class:G(["join-item btn",{"btn-disabled":l==="..."||l===n.currentPage}]),onClick:p=>o.goToPage(l)},c(l),11,xa))),128))])]),_:1})])}var Ia=he(Ti,[["render",Ea]]);const Ca={name:"sendQuote",components:{VueEditor:Ut.exports.VueEditor},props:{showModal:Boolean,modalId:String,client:Object,quoteId:Number,loading:Boolean,subject:String,content:String},data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{loading:!1,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},toolbarOptions:[["bold","italic","underline","strike"],["link"],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],[{align:"right"},{align:"center"},{align:"justify"}],["clean"]],fields:{client_email:{label:t.client,value:"",disabled:!0},email_subject:{label:t.email_subject,value:""},email_message:{label:t.email_content,value:"",type:"textarea"}}}},watch:{client:{immediate:!0,handler(t){this.fields.client_email.value=(t==null?void 0:t.email)||""}},subject:{immediate:!0,handler(t){this.fields.email_subject.value=t||""}},content:{immediate:!0,handler(t){this.fields.email_message.value=t||""}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch("/wp-json/my-easy-compta/v1/emails/send-email",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({type:"quote",id:this.quoteId,client_email:this.client.email,email_subject:this.fields.email_subject.value,email_message:this.fields.email_message.value})});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success")}else{const e=`Error sending email: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error sending email";this.showToast(e,"alert-error"),console.error("Error sending email:",t),this.loadingBtn=!1}},updateFieldValue(t,e){this.fields[t].value=e},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Ta=["id","open"],ka={class:"modal-box"},Aa={class:"font-bold text-lg"},Sa={key:0},Pa={class:"grid grid-cols-1 gap-4"},Da=i("div",{class:"skeleton h-4 w-full mb-2"},null,-1),ja=i("div",{class:"skeleton h-4 w-full"},null,-1),qa=[Da,ja],Ma={class:"grid grid-cols-1 gap-4"},Ra=["type"],Oa=["for"],Na=["id","value","disabled","onInput"],Ba={key:1},Va=["for"],Fa={class:"form-group mt-4 flex justify-end"},Wa=["disabled"],Xa={key:0,class:"loading loading-spinner loading-sm"};function Qa(t,e,s,a,n,o){const h=Q("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),i("dialog",{id:s.modalId,class:"modal",open:s.showModal},[i("div",ka,[i("h3",Aa,c(o.translations.send_quote),1),i("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=r=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",Sa,[i("div",Pa,[(m(!0),f(F,null,W(o.skeletonItems,r=>(m(),f("div",{key:r,class:"py-2"},qa))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=re((...r)=>o.submitForm&&o.submitForm(...r),["prevent"])),class:"form"},[i("div",Ma,[(m(!0),f(F,null,W(n.fields,(r,d)=>(m(),f("div",{key:d,class:"ecwp-group form-group"},[r.type!=="textarea"?(m(),f("div",{key:0,type:r.type||"text"},[i("label",{for:d,class:"ecwp-label form-label"},c(r.label),9,Oa),i("input",{id:d,class:G(["ecwp-input input input-bordered",r.class||"w-full"]),value:r.value,disabled:r.disabled,onInput:u=>o.updateFieldValue(d,u.target.value)},null,42,Na)],8,Ra)):(m(),f("div",Ba,[i("label",{for:d,class:"form-label"},c(r.label),9,Va),B(h,{modelValue:r.value,"onUpdate:modelValue":u=>r.value=u,editorToolbar:n.toolbarOptions},null,8,["modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),i("div",Fa,[i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.send)+" ",1),n.loadingBtn?(m(),f("span",Xa)):y("",!0)],8,Wa)])],32))])],8,Ta)])}var Ua=he(Ca,[["render",Qa]]);const La={name:"QuoteNavBar",components:{SendQuoteModal:Ua,ConfirmModal:vn},props:{quoteInfo:Object,emailActive:String},data(){return{selectedQuote:null,sendQuoteModal:!1,loadingModal:!1,loadingPdf:!1,client_detail:null,subject:"",content:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{async changeQuoteStatus(t){try{const s=await(await fetch("/wp-json/my-easy-compta/v1/quotes/update-status",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({id:this.quoteInfo.id,status:t})})).json();s.success?(this.quoteInfo.status=t,this.showToast(s.message,"alert-success")):(console.error("Failed to update quote status:",s.message),this.showToast(s.message,"alert-error"))}catch(e){console.error("An error occurred while updating quote status:",e),this.showToast(e,"alert-error")}},convertToInvoice(t){fetch(`/wp-json/my-easy-compta/v1/quotes/convert-quote/${t}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{e.success?(this.showToast(e.message,"alert-success"),this.$router.push({name:"InvoiceViewDetail",params:{id:e.id}})):this.showToast(e.message,"alert-error")}).catch(e=>{console.error("Error converting quote:",e),this.showToast(e.message,"alert-error")})},confirmConvertQuote(t){this.selectedQuote=t,modal_confirm.showModal(),this.showRemoveModal=!0},exportToPDF(){this.loadingPdf=!0;const t=this.quoteInfo.id;fetch(`/wp-json/my-easy-compta/v1/quotes/pdf/${t}`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw this.loadingPdf=!1,new Error("Network response was not ok");return this.loadingPdf=!1,e.blob()}).then(e=>{const s=URL.createObjectURL(e);window.open(s),this.loadingPdf=!1}).catch(e=>{console.error("There was a problem with the fetch operation:",e),this.loadingPdf=!1})},sendQuote(t){this.loadingModal=!0,this.sendQuoteModal=!0,modal_send_quote.showModal(),this.fetchClient(t),this.fetchSettings()},fetchClient(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e,this.loading=!1}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.subject=e.email_quote_subject,this.content=e.email_quote_content}else{const e=await t.json();this.showToast(e.message,"alert-error")}}catch(t){this.loading=!1,this.showToast(t.message,"alert-error")}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},za={class:"navbar bg-base-100 mb-4 shadow-xl rounded-box flex justify-between"},Ha=i("div",{class:"dropdown"},[i("div",{tabindex:"0",role:"button",class:"btn btn-ghost lg:hidden"},[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h8m-8 6h16"})])]),i("ul",{tabindex:"0",class:"menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52"},[i("li",null,[i("a",null,"Item 1")]),i("li",null,[i("a",null,"Parent"),i("ul",{class:"p-2"},[i("li",null,[i("a",null,"Submenu 1")]),i("li",null,[i("a",null,"Submenu 2")])])]),i("li",null,[i("a",null,"Item 3")])])],-1),Ga={class:"hidden lg:flex gap-2"},Ya={class:"btn btn-sm"},Ka=i("i",{class:"far fa-edit"},null,-1),Ja=i("i",{class:"fa fa-check"},null,-1),Za=i("i",{class:"fa fa-check"},null,-1),$a=i("i",{class:"fa fa-times"},null,-1),el=i("i",{class:"fas fa-exchange-alt"},null,-1),tl={class:"flex gap-2"},nl=i("i",{class:"fas fa-paper-plane"},null,-1),sl={key:0,class:"far fa-envelope"},ol=["disabled"],il=i("i",{class:"far fa-file-pdf"},null,-1),al={key:0,class:"loading loading-spinner loading-sm"};function ll(t,e,s,a,n,o){const h=Q("send-quote-modal"),r=Q("confirm-modal"),d=Q("router-link");return m(),f("div",null,[i("div",null,[B(h,{loading:n.loadingModal,"show-modal":n.sendQuoteModal,"modal-id":"modal_send_quote",client:n.client_detail,"quote-id":s.quoteInfo.id,subject:n.subject,content:n.content,onClose:e[0]||(e[0]=u=>n.sendQuoteModal=!1)},null,8,["loading","show-modal","client","quote-id","subject","content"])]),B(r,{"show-modal":t.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,onConfirm:e[1]||(e[1]=u=>this.convertToInvoice(n.selectedQuote)),onCancel:e[2]||(e[2]=u=>t.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),i("div",za,[i("div",null,[Ha,i("div",Ga,[B(d,{to:{name:"QuoteEdit",params:{id:s.quoteInfo.id}}},{default:le(()=>[i("button",Ya,[Ka,T(c(o.translations.edit_quote),1)])]),_:1},8,["to"]),s.quoteInfo.status=="draft"?(m(),f("button",{key:0,class:"btn btn-outline btn-success btn-sm",onClick:e[3]||(e[3]=u=>o.changeQuoteStatus("pending"))},[Ja,T(" "+c(o.translations.validate_quote),1)])):y("",!0),s.quoteInfo.status=="pending"||s.quoteInfo.status=="rejected"?(m(),f("button",{key:1,class:"btn btn-outline btn-success btn-sm",onClick:e[4]||(e[4]=u=>o.changeQuoteStatus("approved"))},[Za,T(" "+c(o.translations.mark_as_accepted),1)])):y("",!0),s.quoteInfo.status=="pending"||s.quoteInfo.status=="approved"?(m(),f("button",{key:2,class:"btn btn-outline btn-error btn-sm",onClick:e[5]||(e[5]=u=>o.changeQuoteStatus("rejected"))},[$a,T(" "+c(o.translations.mark_as_rejected),1)])):y("",!0),s.quoteInfo.converted!=1&&s.quoteInfo.status!="draft"?(m(),f("button",{key:3,onClick:e[6]||(e[6]=u=>o.confirmConvertQuote(s.quoteInfo.id)),class:"btn btn-sm"},[el,T(" "+c(o.translations.convertToInvoice),1)])):y("",!0)])]),i("div",tl,[s.emailActive==1?(m(),f("button",{key:0,onClick:e[7]||(e[7]=re(u=>o.sendQuote(s.quoteInfo.client_id),["prevent"])),class:"btn btn-outline btn-primary btn-sm hover:text-white"},[nl,T(" "+c(o.translations.send_quote)+" ",1),s.quoteInfo.sent==1?(m(),f("i",sl)):y("",!0)])):y("",!0),i("button",{onClick:e[8]||(e[8]=(...u)=>o.exportToPDF&&o.exportToPDF(...u)),class:"btn btn-outline btn-success btn-sm",disabled:n.loadingPdf},[il,T(" "+c(o.translations.exportToPDF)+" ",1),n.loadingPdf?(m(),f("span",al)):y("",!0)],8,ol)])])])}var rl=he(La,[["render",ll]]);const cl={components:{VueEditor:Ut.exports.VueEditor},props:{loading:Boolean,showModal:Boolean,modalId:String,modalTitle:String,item:Object},data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{editedItem:{...this.item},loading:this.loading,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{item_name:{label:t.item_name},item_description:{label:t.description,type:"textarea"},quantity:{label:t.quantity,type:"number"},vat_rate:{label:"Taux de TVA",type:"number"},unit_price:{label:t.unit_price,type:"number"},discount:{label:t.discount,type:"number"}}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch(`/wp-json/my-easy-compta/v1/quotes/edit-item/${this.editedItem.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedItem)});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success"),this.$emit("itemEdited")}else{const e=`Error editing item: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error editing item";this.showToast(e,"alert-error"),console.error("Error editing item:",t),this.loadingBtn=!1}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)},resize(){let t=this.$refs.textarea;t.style.height="auto",t.style.height=t.scrollHeight+"px"},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--}},watch:{item:{handler(t){this.editedItem={...t}},immediate:!0}}},dl=["id","open"],ul={class:"modal-box"},hl={class:"font-bold text-lg"},ml={key:0},fl={class:"grid grid-cols-1 gap-4"},pl=i("div",{class:"skeleton h-4 w-full mb-2"},null,-1),gl=i("div",{class:"skeleton h-4 w-full"},null,-1),_l=[pl,gl],vl={class:"grid grid-cols-1 gap-4"},yl=["type"],bl=["for"],wl=["id","onUpdate:modelValue"],xl={key:1},El=["for"],Il={class:"form-group mt-4 flex justify-end"},Cl=["disabled"],Tl={key:0,class:"loading loading-spinner loading-sm"};function kl(t,e,s,a,n,o){const h=Q("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),i("dialog",{id:s.modalId,class:"modal",open:s.showModal},[i("div",ul,[i("h3",hl,c(s.modalTitle),1),i("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=r=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",ml,[i("div",fl,[(m(!0),f(F,null,W(o.skeletonItems,r=>(m(),f("div",{key:r,class:"py-2"},_l))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=re((...r)=>o.submitForm&&o.submitForm(...r),["prevent"])),class:"form"},[i("div",vl,[(m(!0),f(F,null,W(n.fields,(r,d)=>(m(),f("div",{key:d,class:"ecwp-group form-group"},[r.type!=="textarea"?(m(),f("div",{key:0,type:r.type||"text"},[i("label",{for:d,class:"ecwp-label form-label"},c(r.label),9,bl),q(i("input",{id:d,"onUpdate:modelValue":u=>n.editedItem[d]=u,class:G(["ecwp-input input input-bordered",r.class||"w-full"])},null,10,wl),[[L,n.editedItem[d]]])],8,yl)):(m(),f("div",xl,[i("label",{for:d,class:"form-label"},c(r.label),9,El),B(h,{id:d,modelValue:n.editedItem[d],"onUpdate:modelValue":u=>n.editedItem[d]=u,editorToolbar:t.toolbarOptions},null,8,["id","modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),i("div",Il,[i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",Tl)):y("",!0)],8,Cl)])],32))])],8,dl)])}var Al=he(cl,[["render",kl]]);/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Vn(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function ke(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?Vn(Object(s),!0).forEach(function(a){Sl(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Vn(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Dt(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Dt=function(e){return typeof e}:Dt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(t)}function Sl(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Me(){return Me=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},Me.apply(this,arguments)}function Pl(t,e){if(t==null)return{};var s={},a=Object.keys(t),n,o;for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&(s[n]=t[n]);return s}function Dl(t,e){if(t==null)return{};var s=Pl(t,e),a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],!(e.indexOf(a)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,a)||(s[a]=t[a]))}return s}var jl="1.15.2";function qe(t){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(t)}var Re=qe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Et=qe(/Edge/i),Fn=qe(/firefox/i),ft=qe(/safari/i)&&!qe(/chrome/i)&&!qe(/android/i),gs=qe(/iP(ad|od|hone)/i),_s=qe(/chrome/i)&&qe(/android/i),vs={capture:!1,passive:!1};function V(t,e,s){t.addEventListener(e,s,!Re&&vs)}function O(t,e,s){t.removeEventListener(e,s,!Re&&vs)}function Ot(t,e){if(!!e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function ql(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Ee(t,e,s,a){if(t){s=s||document;do{if(e!=null&&(e[0]===">"?t.parentNode===s&&Ot(t,e):Ot(t,e))||a&&t===s)return t;if(t===s)break}while(t=ql(t))}return null}var Wn=/\s+/g;function pe(t,e,s){if(t&&e)if(t.classList)t.classList[s?"add":"remove"](e);else{var a=(" "+t.className+" ").replace(Wn," ").replace(" "+e+" "," ");t.className=(a+(s?" "+e:"")).replace(Wn," ")}}function A(t,e,s){var a=t&&t.style;if(a){if(s===void 0)return document.defaultView&&document.defaultView.getComputedStyle?s=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(s=t.currentStyle),e===void 0?s:s[e];!(e in a)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),a[e]=s+(typeof s=="string"?"":"px")}}function et(t,e){var s="";if(typeof t=="string")s=t;else do{var a=A(t,"transform");a&&a!=="none"&&(s=a+" "+s)}while(!e&&(t=t.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(s)}function ys(t,e,s){if(t){var a=t.getElementsByTagName(e),n=0,o=a.length;if(s)for(;n<o;n++)s(a[n],n);return a}return[]}function Te(){var t=document.scrollingElement;return t||document.documentElement}function ee(t,e,s,a,n){if(!(!t.getBoundingClientRect&&t!==window)){var o,h,r,d,u,l,p;if(t!==window&&t.parentNode&&t!==Te()?(o=t.getBoundingClientRect(),h=o.top,r=o.left,d=o.bottom,u=o.right,l=o.height,p=o.width):(h=0,r=0,d=window.innerHeight,u=window.innerWidth,l=window.innerHeight,p=window.innerWidth),(e||s)&&t!==window&&(n=n||t.parentNode,!Re))do if(n&&n.getBoundingClientRect&&(A(n,"transform")!=="none"||s&&A(n,"position")!=="static")){var g=n.getBoundingClientRect();h-=g.top+parseInt(A(n,"border-top-width")),r-=g.left+parseInt(A(n,"border-left-width")),d=h+o.height,u=r+o.width;break}while(n=n.parentNode);if(a&&t!==window){var _=et(n||t),x=_&&_.a,I=_&&_.d;_&&(h/=I,r/=x,p/=x,l/=I,d=h+l,u=r+p)}return{top:h,left:r,bottom:d,right:u,width:p,height:l}}}function Xn(t,e,s){for(var a=Xe(t,!0),n=ee(t)[e];a;){var o=ee(a)[s],h=void 0;if(s==="top"||s==="left"?h=n>=o:h=n<=o,!h)return a;if(a===Te())break;a=Xe(a,!1)}return!1}function st(t,e,s,a){for(var n=0,o=0,h=t.children;o<h.length;){if(h[o].style.display!=="none"&&h[o]!==k.ghost&&(a||h[o]!==k.dragged)&&Ee(h[o],s.draggable,t,!1)){if(n===e)return h[o];n++}o++}return null}function yn(t,e){for(var s=t.lastElementChild;s&&(s===k.ghost||A(s,"display")==="none"||e&&!Ot(s,e));)s=s.previousElementSibling;return s||null}function ve(t,e){var s=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==k.clone&&(!e||Ot(t,e))&&s++;return s}function Qn(t){var e=0,s=0,a=Te();if(t)do{var n=et(t),o=n.a,h=n.d;e+=t.scrollLeft*o,s+=t.scrollTop*h}while(t!==a&&(t=t.parentNode));return[e,s]}function Ml(t,e){for(var s in t)if(!!t.hasOwnProperty(s)){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t[s][a])return Number(s)}return-1}function Xe(t,e){if(!t||!t.getBoundingClientRect)return Te();var s=t,a=!1;do if(s.clientWidth<s.scrollWidth||s.clientHeight<s.scrollHeight){var n=A(s);if(s.clientWidth<s.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||s.clientHeight<s.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!s.getBoundingClientRect||s===document.body)return Te();if(a||e)return s;a=!0}}while(s=s.parentNode);return Te()}function Rl(t,e){if(t&&e)for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}function $t(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var pt;function bs(t,e){return function(){if(!pt){var s=arguments,a=this;s.length===1?t.call(a,s[0]):t.apply(a,s),pt=setTimeout(function(){pt=void 0},e)}}}function Ol(){clearTimeout(pt),pt=void 0}function ws(t,e,s){t.scrollLeft+=e,t.scrollTop+=s}function xs(t){var e=window.Polymer,s=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):s?s(t).clone(!0)[0]:t.cloneNode(!0)}function Es(t,e,s){var a={};return Array.from(t.children).forEach(function(n){var o,h,r,d;if(!(!Ee(n,e.draggable,t,!1)||n.animated||n===s)){var u=ee(n);a.left=Math.min((o=a.left)!==null&&o!==void 0?o:1/0,u.left),a.top=Math.min((h=a.top)!==null&&h!==void 0?h:1/0,u.top),a.right=Math.max((r=a.right)!==null&&r!==void 0?r:-1/0,u.right),a.bottom=Math.max((d=a.bottom)!==null&&d!==void 0?d:-1/0,u.bottom)}}),a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}var _e="Sortable"+new Date().getTime();function Nl(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var a=[].slice.call(this.el.children);a.forEach(function(n){if(!(A(n,"display")==="none"||n===k.ghost)){t.push({target:n,rect:ee(n)});var o=ke({},t[t.length-1].rect);if(n.thisAnimationDuration){var h=et(n,!0);h&&(o.top-=h.f,o.left-=h.e)}n.fromRect=o}})}},addAnimationState:function(a){t.push(a)},removeAnimationState:function(a){t.splice(Ml(t,{target:a}),1)},animateAll:function(a){var n=this;if(!this.options.animation){clearTimeout(e),typeof a=="function"&&a();return}var o=!1,h=0;t.forEach(function(r){var d=0,u=r.target,l=u.fromRect,p=ee(u),g=u.prevFromRect,_=u.prevToRect,x=r.rect,I=et(u,!0);I&&(p.top-=I.f,p.left-=I.e),u.toRect=p,u.thisAnimationDuration&&$t(g,p)&&!$t(l,p)&&(x.top-p.top)/(x.left-p.left)===(l.top-p.top)/(l.left-p.left)&&(d=Vl(x,g,_,n.options)),$t(p,l)||(u.prevFromRect=l,u.prevToRect=p,d||(d=n.options.animation),n.animate(u,x,p,d)),d&&(o=!0,h=Math.max(h,d),clearTimeout(u.animationResetTimer),u.animationResetTimer=setTimeout(function(){u.animationTime=0,u.prevFromRect=null,u.fromRect=null,u.prevToRect=null,u.thisAnimationDuration=null},d),u.thisAnimationDuration=d)}),clearTimeout(e),o?e=setTimeout(function(){typeof a=="function"&&a()},h):typeof a=="function"&&a(),t=[]},animate:function(a,n,o,h){if(h){A(a,"transition",""),A(a,"transform","");var r=et(this.el),d=r&&r.a,u=r&&r.d,l=(n.left-o.left)/(d||1),p=(n.top-o.top)/(u||1);a.animatingX=!!l,a.animatingY=!!p,A(a,"transform","translate3d("+l+"px,"+p+"px,0)"),this.forRepaintDummy=Bl(a),A(a,"transition","transform "+h+"ms"+(this.options.easing?" "+this.options.easing:"")),A(a,"transform","translate3d(0,0,0)"),typeof a.animated=="number"&&clearTimeout(a.animated),a.animated=setTimeout(function(){A(a,"transition",""),A(a,"transform",""),a.animated=!1,a.animatingX=!1,a.animatingY=!1},h)}}}}function Bl(t){return t.offsetWidth}function Vl(t,e,s,a){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-s.top,2)+Math.pow(e.left-s.left,2))*a.animation}var Ye=[],en={initializeByDefault:!0},It={mount:function(e){for(var s in en)en.hasOwnProperty(s)&&!(s in e)&&(e[s]=en[s]);Ye.forEach(function(a){if(a.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Ye.push(e)},pluginEvent:function(e,s,a){var n=this;this.eventCanceled=!1,a.cancel=function(){n.eventCanceled=!0};var o=e+"Global";Ye.forEach(function(h){!s[h.pluginName]||(s[h.pluginName][o]&&s[h.pluginName][o](ke({sortable:s},a)),s.options[h.pluginName]&&s[h.pluginName][e]&&s[h.pluginName][e](ke({sortable:s},a)))})},initializePlugins:function(e,s,a,n){Ye.forEach(function(r){var d=r.pluginName;if(!(!e.options[d]&&!r.initializeByDefault)){var u=new r(e,s,e.options);u.sortable=e,u.options=e.options,e[d]=u,Me(a,u.defaults)}});for(var o in e.options)if(!!e.options.hasOwnProperty(o)){var h=this.modifyOption(e,o,e.options[o]);typeof h!="undefined"&&(e.options[o]=h)}},getEventProperties:function(e,s){var a={};return Ye.forEach(function(n){typeof n.eventProperties=="function"&&Me(a,n.eventProperties.call(s[n.pluginName],e))}),a},modifyOption:function(e,s,a){var n;return Ye.forEach(function(o){!e[o.pluginName]||o.optionListeners&&typeof o.optionListeners[s]=="function"&&(n=o.optionListeners[s].call(e[o.pluginName],a))}),n}};function Fl(t){var e=t.sortable,s=t.rootEl,a=t.name,n=t.targetEl,o=t.cloneEl,h=t.toEl,r=t.fromEl,d=t.oldIndex,u=t.newIndex,l=t.oldDraggableIndex,p=t.newDraggableIndex,g=t.originalEvent,_=t.putSortable,x=t.extraEventProperties;if(e=e||s&&s[_e],!!e){var I,M=e.options,N="on"+a.charAt(0).toUpperCase()+a.substr(1);window.CustomEvent&&!Re&&!Et?I=new CustomEvent(a,{bubbles:!0,cancelable:!0}):(I=document.createEvent("Event"),I.initEvent(a,!0,!0)),I.to=h||s,I.from=r||s,I.item=n||s,I.clone=o,I.oldIndex=d,I.newIndex=u,I.oldDraggableIndex=l,I.newDraggableIndex=p,I.originalEvent=g,I.pullMode=_?_.lastPutMode:void 0;var S=ke(ke({},x),It.getEventProperties(a,e));for(var D in S)I[D]=S[D];s&&s.dispatchEvent(I),M[N]&&M[N].call(e,I)}}var Wl=["evt"],fe=function(e,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=a.evt,o=Dl(a,Wl);It.pluginEvent.bind(k)(e,s,ke({dragEl:b,parentEl:K,ghostEl:P,rootEl:H,nextEl:He,lastDownEl:jt,cloneEl:Y,cloneHidden:We,dragStarted:rt,putSortable:oe,activeSortable:k.active,originalEvent:n,oldIndex:$e,oldDraggableIndex:gt,newIndex:ge,newDraggableIndex:Fe,hideGhostForTarget:ks,unhideGhostForTarget:As,cloneNowHidden:function(){We=!0},cloneNowShown:function(){We=!1},dispatchSortableEvent:function(r){ue({sortable:s,name:r,originalEvent:n})}},o))};function ue(t){Fl(ke({putSortable:oe,cloneEl:Y,targetEl:b,rootEl:H,oldIndex:$e,oldDraggableIndex:gt,newIndex:ge,newDraggableIndex:Fe},t))}var b,K,P,H,He,jt,Y,We,$e,ge,gt,Fe,kt,oe,Ze=!1,Nt=!1,Bt=[],Le,xe,tn,nn,Un,Ln,rt,Ke,_t,vt=!1,At=!1,qt,ie,sn=[],hn=!1,Vt=[],zt=typeof document!="undefined",St=gs,zn=Et||Re?"cssFloat":"float",Xl=zt&&!_s&&!gs&&"draggable"in document.createElement("div"),Is=function(){if(!!zt){if(Re)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),Cs=function(e,s){var a=A(e),n=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),o=st(e,0,s),h=st(e,1,s),r=o&&A(o),d=h&&A(h),u=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+ee(o).width,l=d&&parseInt(d.marginLeft)+parseInt(d.marginRight)+ee(h).width;if(a.display==="flex")return a.flexDirection==="column"||a.flexDirection==="column-reverse"?"vertical":"horizontal";if(a.display==="grid")return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&r.float&&r.float!=="none"){var p=r.float==="left"?"left":"right";return h&&(d.clear==="both"||d.clear===p)?"vertical":"horizontal"}return o&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||u>=n&&a[zn]==="none"||h&&a[zn]==="none"&&u+l>n)?"vertical":"horizontal"},Ql=function(e,s,a){var n=a?e.left:e.top,o=a?e.right:e.bottom,h=a?e.width:e.height,r=a?s.left:s.top,d=a?s.right:s.bottom,u=a?s.width:s.height;return n===r||o===d||n+h/2===r+u/2},Ul=function(e,s){var a;return Bt.some(function(n){var o=n[_e].options.emptyInsertThreshold;if(!(!o||yn(n))){var h=ee(n),r=e>=h.left-o&&e<=h.right+o,d=s>=h.top-o&&s<=h.bottom+o;if(r&&d)return a=n}}),a},Ts=function(e){function s(o,h){return function(r,d,u,l){var p=r.options.group.name&&d.options.group.name&&r.options.group.name===d.options.group.name;if(o==null&&(h||p))return!0;if(o==null||o===!1)return!1;if(h&&o==="clone")return o;if(typeof o=="function")return s(o(r,d,u,l),h)(r,d,u,l);var g=(h?r:d).options.group.name;return o===!0||typeof o=="string"&&o===g||o.join&&o.indexOf(g)>-1}}var a={},n=e.group;(!n||Dt(n)!="object")&&(n={name:n}),a.name=n.name,a.checkPull=s(n.pull,!0),a.checkPut=s(n.put),a.revertClone=n.revertClone,e.group=a},ks=function(){!Is&&P&&A(P,"display","none")},As=function(){!Is&&P&&A(P,"display","")};zt&&!_s&&document.addEventListener("click",function(t){if(Nt)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),Nt=!1,!1},!0);var ze=function(e){if(b){e=e.touches?e.touches[0]:e;var s=Ul(e.clientX,e.clientY);if(s){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);a.target=a.rootEl=s,a.preventDefault=void 0,a.stopPropagation=void 0,s[_e]._onDragOver(a)}}},Ll=function(e){b&&b.parentNode[_e]._isOutsideThisEl(e.target)};function k(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Me({},e),t[_e]=this;var s={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Cs(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(h,r){h.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&!ft,emptyInsertThreshold:5};It.initializePlugins(this,t,s);for(var a in s)!(a in e)&&(e[a]=s[a]);Ts(e);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=e.forceFallback?!1:Xl,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?V(t,"pointerdown",this._onTapStart):(V(t,"mousedown",this._onTapStart),V(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(V(t,"dragover",this),V(t,"dragenter",this)),Bt.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Me(this,Nl())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Ke=null)},_getDirection:function(e,s){return typeof this.options.direction=="function"?this.options.direction.call(this,e,s,b):this.options.direction},_onTapStart:function(e){if(!!e.cancelable){var s=this,a=this.el,n=this.options,o=n.preventOnFilter,h=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,d=(r||e).target,u=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||d,l=n.filter;if($l(a),!b&&!(/mousedown|pointerdown/.test(h)&&e.button!==0||n.disabled)&&!u.isContentEditable&&!(!this.nativeDraggable&&ft&&d&&d.tagName.toUpperCase()==="SELECT")&&(d=Ee(d,n.draggable,a,!1),!(d&&d.animated)&&jt!==d)){if($e=ve(d),gt=ve(d,n.draggable),typeof l=="function"){if(l.call(this,e,d,this)){ue({sortable:s,rootEl:u,name:"filter",targetEl:d,toEl:a,fromEl:a}),fe("filter",s,{evt:e}),o&&e.cancelable&&e.preventDefault();return}}else if(l&&(l=l.split(",").some(function(p){if(p=Ee(u,p.trim(),a,!1),p)return ue({sortable:s,rootEl:p,name:"filter",targetEl:d,fromEl:a,toEl:a}),fe("filter",s,{evt:e}),!0}),l)){o&&e.cancelable&&e.preventDefault();return}n.handle&&!Ee(u,n.handle,a,!1)||this._prepareDragStart(e,r,d)}}},_prepareDragStart:function(e,s,a){var n=this,o=n.el,h=n.options,r=o.ownerDocument,d;if(a&&!b&&a.parentNode===o){var u=ee(a);if(H=o,b=a,K=b.parentNode,He=b.nextSibling,jt=a,kt=h.group,k.dragged=b,Le={target:b,clientX:(s||e).clientX,clientY:(s||e).clientY},Un=Le.clientX-u.left,Ln=Le.clientY-u.top,this._lastX=(s||e).clientX,this._lastY=(s||e).clientY,b.style["will-change"]="all",d=function(){if(fe("delayEnded",n,{evt:e}),k.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Fn&&n.nativeDraggable&&(b.draggable=!0),n._triggerDragStart(e,s),ue({sortable:n,name:"choose",originalEvent:e}),pe(b,h.chosenClass,!0)},h.ignore.split(",").forEach(function(l){ys(b,l.trim(),on)}),V(r,"dragover",ze),V(r,"mousemove",ze),V(r,"touchmove",ze),V(r,"mouseup",n._onDrop),V(r,"touchend",n._onDrop),V(r,"touchcancel",n._onDrop),Fn&&this.nativeDraggable&&(this.options.touchStartThreshold=4,b.draggable=!0),fe("delayStart",this,{evt:e}),h.delay&&(!h.delayOnTouchOnly||s)&&(!this.nativeDraggable||!(Et||Re))){if(k.eventCanceled){this._onDrop();return}V(r,"mouseup",n._disableDelayedDrag),V(r,"touchend",n._disableDelayedDrag),V(r,"touchcancel",n._disableDelayedDrag),V(r,"mousemove",n._delayedDragTouchMoveHandler),V(r,"touchmove",n._delayedDragTouchMoveHandler),h.supportPointer&&V(r,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(d,h.delay)}else d()}},_delayedDragTouchMoveHandler:function(e){var s=e.touches?e.touches[0]:e;Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){b&&on(b),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._disableDelayedDrag),O(e,"touchend",this._disableDelayedDrag),O(e,"touchcancel",this._disableDelayedDrag),O(e,"mousemove",this._delayedDragTouchMoveHandler),O(e,"touchmove",this._delayedDragTouchMoveHandler),O(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,s){s=s||e.pointerType=="touch"&&e,!this.nativeDraggable||s?this.options.supportPointer?V(document,"pointermove",this._onTouchMove):s?V(document,"touchmove",this._onTouchMove):V(document,"mousemove",this._onTouchMove):(V(b,"dragend",this),V(H,"dragstart",this._onDragStart));try{document.selection?Mt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,s){if(Ze=!1,H&&b){fe("dragStarted",this,{evt:s}),this.nativeDraggable&&V(document,"dragover",Ll);var a=this.options;!e&&pe(b,a.dragClass,!1),pe(b,a.ghostClass,!0),k.active=this,e&&this._appendGhost(),ue({sortable:this,name:"start",originalEvent:s})}else this._nulling()},_emulateDragOver:function(){if(xe){this._lastX=xe.clientX,this._lastY=xe.clientY,ks();for(var e=document.elementFromPoint(xe.clientX,xe.clientY),s=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(xe.clientX,xe.clientY),e!==s);)s=e;if(b.parentNode[_e]._isOutsideThisEl(e),s)do{if(s[_e]){var a=void 0;if(a=s[_e]._onDragOver({clientX:xe.clientX,clientY:xe.clientY,target:e,rootEl:s}),a&&!this.options.dragoverBubble)break}e=s}while(s=s.parentNode);As()}},_onTouchMove:function(e){if(Le){var s=this.options,a=s.fallbackTolerance,n=s.fallbackOffset,o=e.touches?e.touches[0]:e,h=P&&et(P,!0),r=P&&h&&h.a,d=P&&h&&h.d,u=St&&ie&&Qn(ie),l=(o.clientX-Le.clientX+n.x)/(r||1)+(u?u[0]-sn[0]:0)/(r||1),p=(o.clientY-Le.clientY+n.y)/(d||1)+(u?u[1]-sn[1]:0)/(d||1);if(!k.active&&!Ze){if(a&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<a)return;this._onDragStart(e,!0)}if(P){h?(h.e+=l-(tn||0),h.f+=p-(nn||0)):h={a:1,b:0,c:0,d:1,e:l,f:p};var g="matrix(".concat(h.a,",").concat(h.b,",").concat(h.c,",").concat(h.d,",").concat(h.e,",").concat(h.f,")");A(P,"webkitTransform",g),A(P,"mozTransform",g),A(P,"msTransform",g),A(P,"transform",g),tn=l,nn=p,xe=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!P){var e=this.options.fallbackOnBody?document.body:H,s=ee(b,!0,St,!0,e),a=this.options;if(St){for(ie=e;A(ie,"position")==="static"&&A(ie,"transform")==="none"&&ie!==document;)ie=ie.parentNode;ie!==document.body&&ie!==document.documentElement?(ie===document&&(ie=Te()),s.top+=ie.scrollTop,s.left+=ie.scrollLeft):ie=Te(),sn=Qn(ie)}P=b.cloneNode(!0),pe(P,a.ghostClass,!1),pe(P,a.fallbackClass,!0),pe(P,a.dragClass,!0),A(P,"transition",""),A(P,"transform",""),A(P,"box-sizing","border-box"),A(P,"margin",0),A(P,"top",s.top),A(P,"left",s.left),A(P,"width",s.width),A(P,"height",s.height),A(P,"opacity","0.8"),A(P,"position",St?"absolute":"fixed"),A(P,"zIndex","100000"),A(P,"pointerEvents","none"),k.ghost=P,e.appendChild(P),A(P,"transform-origin",Un/parseInt(P.style.width)*100+"% "+Ln/parseInt(P.style.height)*100+"%")}},_onDragStart:function(e,s){var a=this,n=e.dataTransfer,o=a.options;if(fe("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}fe("setupClone",this),k.eventCanceled||(Y=xs(b),Y.removeAttribute("id"),Y.draggable=!1,Y.style["will-change"]="",this._hideClone(),pe(Y,this.options.chosenClass,!1),k.clone=Y),a.cloneId=Mt(function(){fe("clone",a),!k.eventCanceled&&(a.options.removeCloneOnHide||H.insertBefore(Y,b),a._hideClone(),ue({sortable:a,name:"clone"}))}),!s&&pe(b,o.dragClass,!0),s?(Nt=!0,a._loopId=setInterval(a._emulateDragOver,50)):(O(document,"mouseup",a._onDrop),O(document,"touchend",a._onDrop),O(document,"touchcancel",a._onDrop),n&&(n.effectAllowed="move",o.setData&&o.setData.call(a,n,b)),V(document,"drop",a),A(b,"transform","translateZ(0)")),Ze=!0,a._dragStartId=Mt(a._dragStarted.bind(a,s,e)),V(document,"selectstart",a),rt=!0,ft&&A(document.body,"user-select","none")},_onDragOver:function(e){var s=this.el,a=e.target,n,o,h,r=this.options,d=r.group,u=k.active,l=kt===d,p=r.sort,g=oe||u,_,x=this,I=!1;if(hn)return;function M(De,Ht){fe(De,x,ke({evt:e,isOwner:l,axis:_?"vertical":"horizontal",revert:h,dragRect:n,targetRect:o,canSort:p,fromSortable:g,target:a,completed:S,onMove:function(ot,it){return Pt(H,s,b,n,ot,ee(ot),e,it)},changed:D},Ht))}function N(){M("dragOverAnimationCapture"),x.captureAnimationState(),x!==g&&g.captureAnimationState()}function S(De){return M("dragOverCompleted",{insertion:De}),De&&(l?u._hideClone():u._showClone(x),x!==g&&(pe(b,oe?oe.options.ghostClass:u.options.ghostClass,!1),pe(b,r.ghostClass,!0)),oe!==x&&x!==k.active?oe=x:x===k.active&&oe&&(oe=null),g===x&&(x._ignoreWhileAnimating=a),x.animateAll(function(){M("dragOverAnimationComplete"),x._ignoreWhileAnimating=null}),x!==g&&(g.animateAll(),g._ignoreWhileAnimating=null)),(a===b&&!b.animated||a===s&&!a.animated)&&(Ke=null),!r.dragoverBubble&&!e.rootEl&&a!==document&&(b.parentNode[_e]._isOutsideThisEl(e.target),!De&&ze(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),I=!0}function D(){ge=ve(b),Fe=ve(b,r.draggable),ue({sortable:x,name:"change",toEl:s,newIndex:ge,newDraggableIndex:Fe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),a=Ee(a,r.draggable,s,!0),M("dragOver"),k.eventCanceled)return I;if(b.contains(e.target)||a.animated&&a.animatingX&&a.animatingY||x._ignoreWhileAnimating===a)return S(!1);if(Nt=!1,u&&!r.disabled&&(l?p||(h=K!==H):oe===this||(this.lastPutMode=kt.checkPull(this,u,b,e))&&d.checkPut(this,u,b,e))){if(_=this._getDirection(e,a)==="vertical",n=ee(b),M("dragOverValid"),k.eventCanceled)return I;if(h)return K=H,N(),this._hideClone(),M("revert"),k.eventCanceled||(He?H.insertBefore(b,He):H.appendChild(b)),S(!0);var z=yn(s,r.draggable);if(!z||Yl(e,_,this)&&!z.animated){if(z===b)return S(!1);if(z&&s===e.target&&(a=z),a&&(o=ee(a)),Pt(H,s,b,n,a,o,e,!!a)!==!1)return N(),z&&z.nextSibling?s.insertBefore(b,z.nextSibling):s.appendChild(b),K=s,D(),S(!0)}else if(z&&Gl(e,_,this)){var ce=st(s,0,r,!0);if(ce===b)return S(!1);if(a=ce,o=ee(a),Pt(H,s,b,n,a,o,e,!1)!==!1)return N(),s.insertBefore(b,ce),K=s,D(),S(!0)}else if(a.parentNode===s){o=ee(a);var te=0,J,Ue=b.parentNode!==s,se=!Ql(b.animated&&b.toRect||n,a.animated&&a.toRect||o,_),Oe=_?"top":"left",be=Xn(a,"top","top")||Xn(b,"top","top"),Ne=be?be.scrollTop:void 0;Ke!==a&&(J=o[Oe],vt=!1,At=!se&&r.invertSwap||Ue),te=Kl(e,a,o,_,se?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,At,Ke===a);var de;if(te!==0){var Ae=ve(b);do Ae-=te,de=K.children[Ae];while(de&&(A(de,"display")==="none"||de===P))}if(te===0||de===a)return S(!1);Ke=a,_t=te;var Se=a.nextElementSibling,we=!1;we=te===1;var Pe=Pt(H,s,b,n,a,o,e,we);if(Pe!==!1)return(Pe===1||Pe===-1)&&(we=Pe===1),hn=!0,setTimeout(Hl,30),N(),we&&!Se?s.appendChild(b):a.parentNode.insertBefore(b,we?Se:a),be&&ws(be,0,Ne-be.scrollTop),K=b.parentNode,J!==void 0&&!At&&(qt=Math.abs(J-ee(a)[Oe])),D(),S(!0)}if(s.contains(b))return S(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){O(document,"mousemove",this._onTouchMove),O(document,"touchmove",this._onTouchMove),O(document,"pointermove",this._onTouchMove),O(document,"dragover",ze),O(document,"mousemove",ze),O(document,"touchmove",ze)},_offUpEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._onDrop),O(e,"touchend",this._onDrop),O(e,"pointerup",this._onDrop),O(e,"touchcancel",this._onDrop),O(document,"selectstart",this)},_onDrop:function(e){var s=this.el,a=this.options;if(ge=ve(b),Fe=ve(b,a.draggable),fe("drop",this,{evt:e}),K=b&&b.parentNode,ge=ve(b),Fe=ve(b,a.draggable),k.eventCanceled){this._nulling();return}Ze=!1,At=!1,vt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),mn(this.cloneId),mn(this._dragStartId),this.nativeDraggable&&(O(document,"drop",this),O(s,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ft&&A(document.body,"user-select",""),A(b,"transform",""),e&&(rt&&(e.cancelable&&e.preventDefault(),!a.dropBubble&&e.stopPropagation()),P&&P.parentNode&&P.parentNode.removeChild(P),(H===K||oe&&oe.lastPutMode!=="clone")&&Y&&Y.parentNode&&Y.parentNode.removeChild(Y),b&&(this.nativeDraggable&&O(b,"dragend",this),on(b),b.style["will-change"]="",rt&&!Ze&&pe(b,oe?oe.options.ghostClass:this.options.ghostClass,!1),pe(b,this.options.chosenClass,!1),ue({sortable:this,name:"unchoose",toEl:K,newIndex:null,newDraggableIndex:null,originalEvent:e}),H!==K?(ge>=0&&(ue({rootEl:K,name:"add",toEl:K,fromEl:H,originalEvent:e}),ue({sortable:this,name:"remove",toEl:K,originalEvent:e}),ue({rootEl:K,name:"sort",toEl:K,fromEl:H,originalEvent:e}),ue({sortable:this,name:"sort",toEl:K,originalEvent:e})),oe&&oe.save()):ge!==$e&&ge>=0&&(ue({sortable:this,name:"update",toEl:K,originalEvent:e}),ue({sortable:this,name:"sort",toEl:K,originalEvent:e})),k.active&&((ge==null||ge===-1)&&(ge=$e,Fe=gt),ue({sortable:this,name:"end",toEl:K,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){fe("nulling",this),H=b=K=P=He=Y=jt=We=Le=xe=rt=ge=Fe=$e=gt=Ke=_t=oe=kt=k.dragged=k.ghost=k.clone=k.active=null,Vt.forEach(function(e){e.checked=!0}),Vt.length=tn=nn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":b&&(this._onDragOver(e),zl(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],s,a=this.el.children,n=0,o=a.length,h=this.options;n<o;n++)s=a[n],Ee(s,h.draggable,this.el,!1)&&e.push(s.getAttribute(h.dataIdAttr)||Zl(s));return e},sort:function(e,s){var a={},n=this.el;this.toArray().forEach(function(o,h){var r=n.children[h];Ee(r,this.options.draggable,n,!1)&&(a[o]=r)},this),s&&this.captureAnimationState(),e.forEach(function(o){a[o]&&(n.removeChild(a[o]),n.appendChild(a[o]))}),s&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,s){return Ee(e,s||this.options.draggable,this.el,!1)},option:function(e,s){var a=this.options;if(s===void 0)return a[e];var n=It.modifyOption(this,e,s);typeof n!="undefined"?a[e]=n:a[e]=s,e==="group"&&Ts(a)},destroy:function(){fe("destroy",this);var e=this.el;e[_e]=null,O(e,"mousedown",this._onTapStart),O(e,"touchstart",this._onTapStart),O(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(O(e,"dragover",this),O(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(s){s.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Bt.splice(Bt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!We){if(fe("hideClone",this),k.eventCanceled)return;A(Y,"display","none"),this.options.removeCloneOnHide&&Y.parentNode&&Y.parentNode.removeChild(Y),We=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(We){if(fe("showClone",this),k.eventCanceled)return;b.parentNode==H&&!this.options.group.revertClone?H.insertBefore(Y,b):He?H.insertBefore(Y,He):H.appendChild(Y),this.options.group.revertClone&&this.animate(b,Y),A(Y,"display",""),We=!1}}};function zl(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function Pt(t,e,s,a,n,o,h,r){var d,u=t[_e],l=u.options.onMove,p;return window.CustomEvent&&!Re&&!Et?d=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(d=document.createEvent("Event"),d.initEvent("move",!0,!0)),d.to=e,d.from=t,d.dragged=s,d.draggedRect=a,d.related=n||e,d.relatedRect=o||ee(e),d.willInsertAfter=r,d.originalEvent=h,t.dispatchEvent(d),l&&(p=l.call(u,d,h)),p}function on(t){t.draggable=!1}function Hl(){hn=!1}function Gl(t,e,s){var a=ee(st(s.el,0,s.options,!0)),n=Es(s.el,s.options,P),o=10;return e?t.clientX<n.left-o||t.clientY<a.top&&t.clientX<a.right:t.clientY<n.top-o||t.clientY<a.bottom&&t.clientX<a.left}function Yl(t,e,s){var a=ee(yn(s.el,s.options.draggable)),n=Es(s.el,s.options,P),o=10;return e?t.clientX>n.right+o||t.clientY>a.bottom&&t.clientX>a.left:t.clientY>n.bottom+o||t.clientX>a.right&&t.clientY>a.top}function Kl(t,e,s,a,n,o,h,r){var d=a?t.clientY:t.clientX,u=a?s.height:s.width,l=a?s.top:s.left,p=a?s.bottom:s.right,g=!1;if(!h){if(r&&qt<u*n){if(!vt&&(_t===1?d>l+u*o/2:d<p-u*o/2)&&(vt=!0),vt)g=!0;else if(_t===1?d<l+qt:d>p-qt)return-_t}else if(d>l+u*(1-n)/2&&d<p-u*(1-n)/2)return Jl(e)}return g=g||h,g&&(d<l+u*o/2||d>p-u*o/2)?d>l+u/2?1:-1:0}function Jl(t){return ve(b)<ve(t)?1:-1}function Zl(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,s=e.length,a=0;s--;)a+=e.charCodeAt(s);return a.toString(36)}function $l(t){Vt.length=0;for(var e=t.getElementsByTagName("input"),s=e.length;s--;){var a=e[s];a.checked&&Vt.push(a)}}function Mt(t){return setTimeout(t,0)}function mn(t){return clearTimeout(t)}zt&&V(document,"touchmove",function(t){(k.active||Ze)&&t.cancelable&&t.preventDefault()});k.utils={on:V,off:O,css:A,find:ys,is:function(e,s){return!!Ee(e,s,e,!1)},extend:Rl,throttle:bs,closest:Ee,toggleClass:pe,clone:xs,index:ve,nextTick:Mt,cancelNextTick:mn,detectDirection:Cs,getChild:st};k.get=function(t){return t[_e]};k.mount=function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];e[0].constructor===Array&&(e=e[0]),e.forEach(function(a){if(!a.prototype||!a.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(a));a.utils&&(k.utils=ke(ke({},k.utils),a.utils)),It.mount(a)})};k.create=function(t,e){return new k(t,e)};k.version=jl;var $=[],ct,fn,pn=!1,an,ln,Ft,dt;function er(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(s){var a=s.originalEvent;this.sortable.nativeDraggable?V(document,"dragover",this._handleAutoScroll):this.options.supportPointer?V(document,"pointermove",this._handleFallbackAutoScroll):a.touches?V(document,"touchmove",this._handleFallbackAutoScroll):V(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(s){var a=s.originalEvent;!this.options.dragOverBubble&&!a.rootEl&&this._handleAutoScroll(a)},drop:function(){this.sortable.nativeDraggable?O(document,"dragover",this._handleAutoScroll):(O(document,"pointermove",this._handleFallbackAutoScroll),O(document,"touchmove",this._handleFallbackAutoScroll),O(document,"mousemove",this._handleFallbackAutoScroll)),Hn(),Rt(),Ol()},nulling:function(){Ft=fn=ct=pn=dt=an=ln=null,$.length=0},_handleFallbackAutoScroll:function(s){this._handleAutoScroll(s,!0)},_handleAutoScroll:function(s,a){var n=this,o=(s.touches?s.touches[0]:s).clientX,h=(s.touches?s.touches[0]:s).clientY,r=document.elementFromPoint(o,h);if(Ft=s,a||this.options.forceAutoScrollFallback||Et||Re||ft){rn(s,this.options,r,a);var d=Xe(r,!0);pn&&(!dt||o!==an||h!==ln)&&(dt&&Hn(),dt=setInterval(function(){var u=Xe(document.elementFromPoint(o,h),!0);u!==d&&(d=u,Rt()),rn(s,n.options,u,a)},10),an=o,ln=h)}else{if(!this.options.bubbleScroll||Xe(r,!0)===Te()){Rt();return}rn(s,this.options,Xe(r,!1),!1)}}},Me(t,{pluginName:"scroll",initializeByDefault:!0})}function Rt(){$.forEach(function(t){clearInterval(t.pid)}),$=[]}function Hn(){clearInterval(dt)}var rn=bs(function(t,e,s,a){if(!!e.scroll){var n=(t.touches?t.touches[0]:t).clientX,o=(t.touches?t.touches[0]:t).clientY,h=e.scrollSensitivity,r=e.scrollSpeed,d=Te(),u=!1,l;fn!==s&&(fn=s,Rt(),ct=e.scroll,l=e.scrollFn,ct===!0&&(ct=Xe(s,!0)));var p=0,g=ct;do{var _=g,x=ee(_),I=x.top,M=x.bottom,N=x.left,S=x.right,D=x.width,z=x.height,ce=void 0,te=void 0,J=_.scrollWidth,Ue=_.scrollHeight,se=A(_),Oe=_.scrollLeft,be=_.scrollTop;_===d?(ce=D<J&&(se.overflowX==="auto"||se.overflowX==="scroll"||se.overflowX==="visible"),te=z<Ue&&(se.overflowY==="auto"||se.overflowY==="scroll"||se.overflowY==="visible")):(ce=D<J&&(se.overflowX==="auto"||se.overflowX==="scroll"),te=z<Ue&&(se.overflowY==="auto"||se.overflowY==="scroll"));var Ne=ce&&(Math.abs(S-n)<=h&&Oe+D<J)-(Math.abs(N-n)<=h&&!!Oe),de=te&&(Math.abs(M-o)<=h&&be+z<Ue)-(Math.abs(I-o)<=h&&!!be);if(!$[p])for(var Ae=0;Ae<=p;Ae++)$[Ae]||($[Ae]={});($[p].vx!=Ne||$[p].vy!=de||$[p].el!==_)&&($[p].el=_,$[p].vx=Ne,$[p].vy=de,clearInterval($[p].pid),(Ne!=0||de!=0)&&(u=!0,$[p].pid=setInterval(function(){a&&this.layer===0&&k.active._onTouchMove(Ft);var Se=$[this.layer].vy?$[this.layer].vy*r:0,we=$[this.layer].vx?$[this.layer].vx*r:0;typeof l=="function"&&l.call(k.dragged.parentNode[_e],we,Se,t,Ft,$[this.layer].el)!=="continue"||ws($[this.layer].el,we,Se)}.bind({layer:p}),24))),p++}while(e.bubbleScroll&&g!==d&&(g=Xe(g,!1)));pn=u}},30),Ss=function(e){var s=e.originalEvent,a=e.putSortable,n=e.dragEl,o=e.activeSortable,h=e.dispatchSortableEvent,r=e.hideGhostForTarget,d=e.unhideGhostForTarget;if(!!s){var u=a||o;r();var l=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:s,p=document.elementFromPoint(l.clientX,l.clientY);d(),u&&!u.el.contains(p)&&(h("spill"),this.onSpill({dragEl:n,putSortable:a}))}};function bn(){}bn.prototype={startIndex:null,dragStart:function(e){var s=e.oldDraggableIndex;this.startIndex=s},onSpill:function(e){var s=e.dragEl,a=e.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var n=st(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(s,n):this.sortable.el.appendChild(s),this.sortable.animateAll(),a&&a.animateAll()},drop:Ss};Me(bn,{pluginName:"revertOnSpill"});function wn(){}wn.prototype={onSpill:function(e){var s=e.dragEl,a=e.putSortable,n=a||this.sortable;n.captureAnimationState(),s.parentNode&&s.parentNode.removeChild(s),n.animateAll()},drop:Ss};Me(wn,{pluginName:"removeOnSpill"});k.mount(new er);k.mount(wn,bn);const tr={name:"QuoteViewDetail",components:{Card:Qe,QuoteNavBar:rl,EditItemModal:Al,RemoveModal:xt},data(){return{selectedItem:null,selectedInvoiceId:null,editItemsModal:!1,loading:!1,loading_add:!1,quote:[],quoteItems:[],newItem:{loading_del:!1,item_ref:"",item_name:"",item_category:"Type",item_description:"",quantity:1,vat_rate:0,unit_price:0,discount:0,total_price:0,total_amount:0},vatRate:0,settings:[],list_vats:[],client_detail:[],client_email:null,client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},articles:[],categories:[],showDropdown:!1,refs:[],showDropdownRef:!1}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},isQuoteExpired(){const t=ns(this.quote.due_date,this.settings.date_format),e=new Date;return t&&t<e},totalAmountWithoutDiscount(){const t=this.quoteItems.reduce((e,s)=>{const a=s.quantity*s.unit_price;return e+a},0);return this.formatCurrency(t)},totalAmount(){const t=this.quoteItems.reduce((e,s)=>e+parseFloat(s.total_price),0);return this.formatCurrency(t)},totalAmountDefaultCurrency(){return(this.quoteItems.reduce((a,n)=>a+parseFloat(n.total_amount),0)*this.quote.exchange_rate).toFixed(2)},totalAmountWithVAT(){const t=parseFloat(this.totalAmount);if(this.settings.vat_active==1){const e=parseFloat(this.calculateVAT());return this.formatCurrency(t+e)}else return this.formatCurrency(t)},signatureImageUrl(){const t="/wp-json/my-easy-compta/v1/signature-image/",e=myEasyComptaAdmin.nonce;return`${t}${this.quote.file_sign}?_wpnonce=${e}`}},methods:{getUniqueVATRates(){const t=new Set;return this.quoteItems.forEach(e=>{e.vat_rate&&t.add(e.vat_rate)}),Array.from(t)},calculateVATForRate(t){let e=0;return this.quoteItems.forEach(s=>{if(s.vat_rate===t){const a=s.quantity*s.unit_price,n=a*s.discount/100;e+=(a-n)*t/100}}),this.formatCurrency(e)},calculateTotalAmountWithVAT(){let t=this.quoteItems.reduce((e,s)=>e+parseFloat(s.total_amount),0);return this.formatCurrency(t)},fetchQuote(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${this.$route.params.id}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t?(this.quote=t,this.fetchClientInfo(t.client_id)):console.error("Quote not found")}).catch(t=>{console.error("Error fetching quote:",t),this.loading=!1})},fetchClientInfo(t){fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e,this.client_email=e.email;const s=e.currency_id;s&&this.fetchCurrencyDetails(s)}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},fetchItems(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${this.$route.params.id}/items`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t.code=="no_items_found"?(console.error("No items found"),this.quoteItems=[],this.loading=!1):(this.quoteItems=t,this.loading=!1)}).catch(t=>{console.error("Error fetching items:",t),this.loading=!1})},fetchCurrencyDetails(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/settings/currency/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Currency details not found");return this.loading=!1,e.json()}).then(e=>{this.client_currency=e.symbol,this.loading=!1}).catch(e=>{this.loading=!1,console.error("Error fetching currency details:",e)})},updateTotal(){const t=this.newItem.quantity*this.newItem.unit_price,e=t*this.newItem.discount/100,s=t-e,a=s*this.newItem.vat_rate/100,n=s+a;this.newItem.total_price=this.formatCurrency(s),this.newItem.total_amount=this.formatCurrency(n)},calculateTotal(t,e,s,a){const n=t*e,o=n*a/100,h=n-o,r=h*s/100,d=h+r;return this.formatCurrency(d)},submitItems(){this.updateTotal();const t={...this.newItem,quote_id:this.$route.params.id};this.loading_add=!0,fetch("/wp-json/my-easy-compta/v1/quotes/element-add",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e.success?(this.loading_add=!1,this.fetchItems(),this.newItem={item_name:"",item_ref:"",item_category:"",item_description:"",quantity:1,vat_rate:this.default_vat.rate,unit_price:0,discount:0,total_price:0,total_amount:0}):(this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e.message),this.loading_add=!1)}).catch(e=>{this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e),this.loading_add=!1})},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--},confirmremoveItem(t,e){this.selectedItem=t,this.selectedInvoiceId=e,modal_remove.showModal(),this.showRemoveModal=!0},removeItem(t,e){const s=this.quoteItems.find(a=>a.id===t);s.loading_del=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/element-delete/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({quote_id:e})}).then(a=>a.json()).then(a=>{a.success?(s.loading_del=!1,this.fetchItems()):(this.showToast(a.message,"alert-error"),console.error("Error removing item:",a.message),s.loading_del=!1)}).catch(a=>{this.showToast(a.message,"alert-error"),console.error("Error removing item:",a),s.loading_del=!1})},editItem(t){this.loadingModal=!0,this.editItemsModal=!0,modal_edit_item.showModal(),this.fetchItemDetails(t)},fetchItemDetails(t){fetch(`/wp-json/my-easy-compta/v1/quotes/item-details/${t}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{this.selectedItem=e,this.loading=!1}).catch(e=>{console.error("Error fetching item details:",e),this.loading=!1})},formatCurrency(t){const e=t.toFixed(2),s=this.client_currency!==this.default_currency_symbol?this.client_currency:this.default_currency_symbol;return`${e}${s}`},calculateDiscountAmount(t,e,s,a){const o=t*e*a/100,h=o*s/100,r=o+h;return this.formatCurrency(r)},calculateVAT(){const t=parseFloat(this.totalAmount),e=parseFloat(this.default_vat.rate),s=t*(e/100);return this.formatCurrency(s)},onDragEnd(t){const e=this.quoteItems[t.oldIndex];this.quoteItems.splice(t.oldIndex,1),this.quoteItems.splice(t.newIndex,0,e);const s=this.quoteItems.map(a=>a.id);this.saveOrderToDatabase(s)},nl2br(t){return t?t.replace(/\n/g,"<br>"):""},resize(){let t=this.$refs.textarea;t.style.height="auto",t.style.height=t.scrollHeight+"px"},saveOrderToDatabase(t){fetch("/wp-json/my-easy-compta/v1/quotes/update-quote-items-order",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({order:t})}).then(e=>{e.ok?console.log("Order saved successfully."):console.error("Failed to save order:",e.statusText)}).catch(e=>{console.error("Error saving order:",e)})},fetchCategoriesArticles(){fetch("/wp-json/my-easy-compta/v1/categories-articles",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.categories=t}).catch(t=>console.error("Error fetching categories:",t))},fetchArticles(){if(this.newItem.item_name.length<1){this.articles=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_name}&method=name`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.articles=t}).catch(t=>console.error("Error fetching articles:",t))},selectItem(t){this.newItem.item_ref=t.ref,this.newItem.item_name=t.name,this.newItem.item_description=t.description,this.newItem.unit_price=t.unit_price,this.showDropdown=!1,this.showDropdownRef=!1},fetchRefs(){if(this.newItem.item_ref.length<1){this.refs=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_ref}&method=ref`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.refs=t}).catch(t=>console.error("Error fetching refrences:",t))},async loadSettings(){try{this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s,listVatData:a}=await Qt();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.list_vats=a,this.newItem.vat_rate=this.default_vat.rate,this.loadingPrice=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)},highlightMatch(t){if(!this.newItem.item_name)return t;const e=new RegExp(`(${this.escapeRegExp(this.newItem.item_name)})`,"gi");return t.replace(e,"<b>$1</b>")},escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},handleClickOutside(t){this.$el.contains(t.target)||(this.showDropdown=!1,this.showDropdownRef=!1)}},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},mounted(){this.fetchQuote(),this.fetchItems(),this.loadSettings(),this.fetchCategoriesArticles(),document.addEventListener("click",this.handleClickOutside);const t=document.querySelector("tbody");k.create(t,{animation:150,handle:".drag-handle",onEnd:this.onDragEnd})}},nr={class:"pt-2 pr-4"},sr={key:1,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},or=i("span",{class:"loading loading-spinner text-primary loading-lg"},null,-1),ir=[or],ar={key:2},lr={role:"alert",class:"alert alert-warning"},rr=i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),cr={key:0,class:"relative"},dr={class:"ecwp-watermark"},ur={class:"grid grid-cols-2"},hr={class:"md:col-span-1"},mr=["src"],fr={class:"md:col-span-1 text-right"},pr={class:"text-lg font-semibold"},gr={key:0,class:"badge badge-warning text-white"},_r={key:1,class:"badge badge-secondary text-white"},vr={key:2,class:"badge badge-success text-white"},yr={key:3,class:"badge badge-error text-white"},br={class:"bg-base-300 rounded-lg shadow-md flex justify-between p-4 mt-4 gap-4"},wr=i("br",null,null,-1),xr=i("br",null,null,-1),Er=i("br",null,null,-1),Ir={key:0,href:"tel:{{ client_detail.phone }}"},Cr=i("br",null,null,-1),Tr=i("br",null,null,-1),kr=i("br",null,null,-1),Ar={key:0,href:"tel:{{ settings.company_phone }}"},Sr=i("br",null,null,-1),Pr={key:1,href:"tel:{{ settings.mobile_phone }}"},Dr={class:"table mt-8"},jr=i("th",null,null,-1),qr={width:"5%"},Mr={width:"19%"},Rr={width:"21%"},Or={width:"10%",class:"text-center"},Nr={width:"8%",class:"text-center"},Br={width:"5%",class:"text-center"},Vr={width:"10%",class:"text-center"},Fr={width:"10%",class:"text-right"},Wr=i("th",{width:"18%",class:"text-right inv-actions"},null,-1),Xr=i("td",{class:"draggable-item drag-handle px-2"},[i("i",{class:"fas fa-bars"})],-1),Qr={key:0,class:"badge badge-ghost badge-xs"},Ur=["innerHTML"],Lr={class:"text-center"},zr={class:"text-center"},Hr={key:0},Gr={key:1},Yr={class:"text-center"},Kr={class:"text-center"},Jr=i("br",null,null,-1),Zr={class:"text-right"},$r={key:0},ec={key:1},tc=["data-tip"],nc=["onClick"],sc=i("i",{class:"far fa-edit"},null,-1),oc=[sc],ic=["data-tip"],ac=["onClick"],lc={key:0,class:"far fa-trash-alt"},rc={key:1,class:"loading loading-spinner loading-xs"},cc={key:0},dc=i("td",{class:"px-2"},null,-1),uc={class:"align-top px-2"},hc={class:"flex items-center border rounded-md relative"},mc=["placeholder"],fc={key:0,class:"autocomplete-dropdown bg-base-300"},pc=["onClick","innerHTML"],gc={class:"align-top px-2"},_c=i("option",{disabled:"",selected:""},"Type",-1),vc=["value"],yc={class:"flex items-center border rounded-md relative"},bc=["placeholder"],wc={key:0,class:"autocomplete-dropdown bg-base-300"},xc=["onClick","innerHTML"],Ec={class:"align-top"},Ic={class:"flex items-center rounded-md"},Cc=["placeholder"],Tc={class:"align-top"},kc={class:"flex items-center border rounded-lg"},Ac={class:"inline-flex"},Sc=["placeholder"],Pc={class:"align-top"},Dc={class:"flex items-center border rounded-md"},jc=["placeholder"],qc={class:"align-top"},Mc=["value"],Rc={class:"align-top"},Oc={class:"flex items-center border rounded-md"},Nc=["placeholder"],Bc=i("div",{class:"px-3 py-2.5 rounded-l-md bg-base-300 border-r"}," % ",-1),Vc={class:"text-right"},Fc=["data-tip"],Wc={type:"submit",class:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"},Xc={key:0,class:"fa fa-plus"},Qc={key:1,class:"loading loading-spinner loading-xs"},Uc={colspan:"8",class:"text-right no-border"},Lc={class:"text-right"},zc={key:0,class:"line-through"},Hc=i("td",null,null,-1),Gc={colspan:"8",class:"text-right no-border"},Yc={class:"text-right"},Kc=i("td",null,null,-1),Jc={colspan:"8",class:"text-right no-border font-bold text-xl"},Zc={class:"text-right no-border font-bold text-xl"},$c=i("td",null,null,-1),ed={key:2},td={colspan:"8",class:"text-right no-border"},nd={class:"text-right no-border"},sd={key:3},od={colspan:"8",class:"text-right no-border"},id={class:"text-right no-border font-bold text-xl"},ad={key:1,class:"relative"},ld={class:"flex justify-end mt-4"},rd={class:"border-2 border-slate-300 max-w-md"},cd=["src"];function dd(t,e,s,a,n,o){const h=Q("QuoteNavBar"),r=Q("remove-modal"),d=Q("edit-item-modal"),u=Q("Card");return m(),f("div",nr,[B(h,{quoteInfo:n.quote,emailActive:n.settings.easy_compta_email_addon_active},null,8,["quoteInfo","emailActive"]),n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),B(r,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=l=>this.removeItem(n.selectedItem,n.selectedInvoiceId)),onCancel:e[1]||(e[1]=l=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),n.loading?(m(),f("div",sr,ir)):y("",!0),o.isQuoteExpired&&n.quote.status=="pending"?(m(),f("div",ar,[i("div",lr,[rr,i("span",null,c(o.translations.quote_expired),1)])])):y("",!0),B(u,{topMargin:"mt-8",id:"quote-content"},{default:le(()=>[n.settings.easy_compta_signature_addon_active&&n.quote.signed==1?(m(),f("div",cr,[i("span",dr,c(o.translations.signed),1)])):y("",!0),i("div",ur,[i("div",hr,[i("div",null,[i("img",{src:n.settings.logo_url,style:Kn({width:n.settings.logo_width+"px"}),alt:"Logo"},null,12,mr)])]),i("div",fr,[i("p",pr,c(n.quote.quote_number),1),i("div",null,[T(c(o.translations.created_at)+": ",1),i("strong",null,c(n.quote.created_at),1)]),i("div",null,[T(c(o.translations.due_date)+": ",1),i("strong",null,c(n.quote.due_date),1)]),i("div",null,[T(c(o.translations.provisional_date)+": ",1),i("strong",null,c(n.quote.provisional_start_date),1)]),i("div",null,[T(c(o.translations.status)+": ",1),n.quote.status=="draft"?(m(),f("span",gr,c(o.translations.draft),1)):y("",!0),n.quote.status=="pending"?(m(),f("span",_r,c(o.translations.pending),1)):y("",!0),n.quote.status=="approved"?(m(),f("span",vr,c(o.translations.approved),1)):y("",!0),n.quote.status=="rejected"?(m(),f("span",yr,c(o.translations.rejected),1)):y("",!0)])])]),i("div",br,[i("div",null,[i("strong",null,c(o.translations.bill_to)+":",1),i("h4",null,[i("strong",null,c(n.client_detail.company_name),1)]),i("p",null,[T(c(n.client_detail.address),1),wr,T(" "+c(n.client_detail.postal_code)+", "+c(n.client_detail.city)+" ",1),xr,T(" "+c(n.client_detail.country),1),Er,n.client_detail.phone?(m(),f("a",Ir,c(n.client_detail.phone),1)):y("",!0)])]),i("div",null,[i("strong",null,c(o.translations.received_from)+":",1),i("h4",null,[i("strong",null,c(n.settings.company_name),1)]),i("p",null,[T(c(n.settings.company_address),1),Cr,T(" "+c(n.settings.postal_code)+", "+c(n.settings.city)+" ",1),Tr,T(" "+c(n.settings.country),1),kr,n.settings.company_phone?(m(),f("a",Ar,c(n.settings.company_phone),1)):y("",!0),Sr,n.settings.mobile_phone?(m(),f("a",Pr,c(n.settings.mobile_phone),1)):y("",!0)])])]),B(d,{loading:t.loadingModal,"show-modal":n.editItemsModal,"modal-id":"modal_edit_item","modal-title":o.translations.edit_item,item:n.selectedItem,onClose:e[2]||(e[2]=l=>n.editItemsModal=!1),onItemEdited:o.fetchItems},null,8,["loading","show-modal","modal-title","item","onItemEdited"]),i("form",{onSubmit:e[22]||(e[22]=re((...l)=>o.submitItems&&o.submitItems(...l),["prevent"]))},[i("table",Dr,[i("thead",null,[i("tr",null,[jr,i("th",qr,c(o.translations.item_ref),1),i("th",Mr,c(o.translations.item_name),1),i("th",Rr,c(o.translations.description),1),i("th",Or,c(o.translations.quantity),1),i("th",Nr,c(o.translations.unit_price),1),i("th",Br,c(o.translations.vat),1),i("th",Vr,c(o.translations.discount),1),i("th",Fr,c(o.translations.total),1),Wr])]),i("tbody",null,[(m(!0),f(F,null,W(n.quoteItems,(l,p)=>(m(),f("tr",{key:l.id||p},[Xr,i("td",null,c(l.item_ref),1),i("td",null,[l.category_name?(m(),f("div",Qr,c(l.category_name),1)):y("",!0),i("div",null,c(l.item_name),1)]),i("td",{innerHTML:o.nl2br(l.item_description)},null,8,Ur),i("td",Lr,c(l.quantity),1),i("td",zr,[T(c(l.unit_price),1),n.default_currency_symbol==n.client_currency?(m(),f("span",Hr,c(n.default_currency_symbol),1)):(m(),f("span",Gr,c(n.client_currency),1))]),i("td",Yr,c(l.vat_rate)+"%",1),i("td",Kr,[T(c(l.discount)+"% ",1),Jr,T(" "+c(o.calculateDiscountAmount(l.quantity,l.unit_price,l.vat_rate,l.discount)),1)]),i("td",Zr,[T(c(l.total_amount)+" ",1),n.default_currency_symbol==n.client_currency?(m(),f("span",$r,c(n.default_currency_symbol),1)):(m(),f("span",ec,c(n.client_currency),1))]),i("td",null,[n.quote.status=="draft"||n.quote.status=="pending"?(m(),f("span",{key:0,class:"lg:tooltip","data-tip":o.translations.edit},[i("button",{onClick:re(g=>o.editItem(l.id),["prevent"]),class:"bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded"},oc,8,nc)],8,tc)):y("",!0),n.quote.status=="draft"||n.quote.status=="pending"?(m(),f("span",{key:1,class:"lg:tooltip","data-tip":o.translations.delete},[i("button",{onClick:re(g=>o.confirmremoveItem(l.id,n.quote.id),["prevent"]),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-3 mx-2 rounded"},[l.loading_del?y("",!0):(m(),f("i",lc)),l.loading_del?(m(),f("span",rc)):y("",!0)],8,ac)],8,ic)):y("",!0)])]))),128)),n.quote.status=="draft"||n.quote.status=="pending"?(m(),f("tr",cc,[dc,i("td",uc,[i("div",hc,[q(i("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>n.newItem.item_ref=l),onInput:e[4]||(e[4]=(...l)=>o.fetchRefs&&o.fetchRefs(...l)),onFocus:e[5]||(e[5]=l=>n.showDropdownRef=!0),placeholder:o.translations.item_ref,class:"w-full p-2.5 bg-transparent input-xs outline-none"},null,40,mc),[[L,n.newItem.item_ref]]),n.showDropdownRef&&n.refs.length?(m(),f("ul",fc,[(m(!0),f(F,null,W(n.refs,l=>(m(),f("li",{key:l.ref,onClick:p=>o.selectItem(l),class:"autocomplete-item hover:bg-base-200",innerHTML:o.highlightMatch(l.ref)},null,8,pc))),128))])):y("",!0)])]),i("td",gc,[q(i("select",{class:"select select-xs w-full mb-1 ecwp-select","onUpdate:modelValue":e[6]||(e[6]=l=>n.newItem.item_category=l)},[_c,(m(!0),f(F,null,W(n.categories,l=>(m(),f("option",{key:l.id,value:l.id},c(l.name),9,vc))),128))],512),[[ye,n.newItem.item_category]]),i("div",yc,[q(i("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=l=>n.newItem.item_name=l),onInput:e[8]||(e[8]=(...l)=>o.fetchArticles&&o.fetchArticles(...l)),onFocus:e[9]||(e[9]=l=>n.showDropdown=!0),placeholder:o.translations.item_name,class:"w-full p-2.5 bg-transparent input-xs outline-none"},null,40,bc),[[L,n.newItem.item_name]]),n.showDropdown&&n.articles.length?(m(),f("ul",wc,[(m(!0),f(F,null,W(n.articles,l=>(m(),f("li",{key:l.name,onClick:p=>o.selectItem(l),class:"autocomplete-item hover:bg-base-200",innerHTML:o.highlightMatch(l.name)},null,8,xc))),128))])):y("",!0)])]),i("td",Ec,[i("div",Ic,[q(i("textarea",{"onUpdate:modelValue":e[10]||(e[10]=l=>n.newItem.item_description=l),placeholder:o.translations.item_description,class:"textarea textarea-bordered input-xs w-full",onInput:e[11]||(e[11]=l=>o.resize()),ref:"textarea"},null,40,Cc),[[L,n.newItem.item_description]])])]),i("td",Tc,[i("div",kc,[i("div",Ac,[i("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-l",onClick:e[12]||(e[12]=(...l)=>o.decrease&&o.decrease(...l))}," - "),q(i("input",{type:"number",min:"1","onUpdate:modelValue":e[13]||(e[13]=l=>n.newItem.quantity=l),placeholder:o.translations.quantity,class:"w-full p-2.5 bg-transparent outline-none max-w-40",onInput:e[14]||(e[14]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Sc),[[L,n.newItem.quantity]]),i("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-r",onClick:e[15]||(e[15]=(...l)=>o.increase&&o.increase(...l))}," + ")])])]),i("td",Pc,[i("div",Dc,[q(i("input",{type:"number","onUpdate:modelValue":e[16]||(e[16]=l=>n.newItem.unit_price=l),placeholder:o.translations.unit_price,class:"w-full p-2.5 bg-transparent outline-none max-w-40",onInput:e[17]||(e[17]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,jc),[[L,n.newItem.unit_price]])])]),i("td",qc,[q(i("select",{"onUpdate:modelValue":e[18]||(e[18]=l=>n.newItem.vat_rate=l),onChange:e[19]||(e[19]=(...l)=>o.updateTotal&&o.updateTotal(...l)),class:"select select-sm w-full mb-1 ecwp-select min-w-20"},[(m(!0),f(F,null,W(n.list_vats,l=>(m(),f("option",{key:l,value:l.rate},c(l.rate)+"% ",9,Mc))),128))],544),[[ye,n.newItem.vat_rate]])]),i("td",Rc,[i("div",Oc,[q(i("input",{type:"number",min:"0",max:"100","onUpdate:modelValue":e[20]||(e[20]=l=>n.newItem.discount=l),placeholder:o.translations.discount,class:"w-full p-2.5 bg-transparent outline-none max-w-40",onInput:e[21]||(e[21]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Nc),[[L,n.newItem.discount]]),Bc])]),i("td",Vc,c(o.calculateTotal(n.newItem.quantity,n.newItem.unit_price,n.newItem.vat_rate,n.newItem.discount)),1),i("td",null,[i("span",{class:"lg:tooltip","data-tip":o.translations.add},[i("button",Wc,[n.loading_add?y("",!0):(m(),f("i",Xc)),n.loading_add?(m(),f("span",Qc)):y("",!0)])],8,Fc)])])):y("",!0),i("tr",null,[i("td",Uc,[i("strong",null,c(o.translations.subtotal),1)]),i("td",Lc,[o.totalAmount!==o.totalAmountWithoutDiscount?(m(),f("span",zc,c(o.totalAmountWithoutDiscount),1)):y("",!0),T(" "+c(o.totalAmount),1)]),Hc]),n.settings.vat_active==1?(m(!0),f(F,{key:1},W(o.getUniqueVATRates(),(l,p)=>(m(),f("tr",{key:p},[i("td",Gc,[i("strong",null,c(o.translations.tax)+" ("+c(l)+"%) ",1)]),i("td",Yc,c(o.calculateVATForRate(l)),1),Kc]))),128)):y("",!0),i("tr",null,[i("td",Jc,[i("strong",null,c(o.translations.total),1)]),i("td",Zc,c(o.calculateTotalAmountWithVAT()),1),$c]),n.client_currency!=n.default_currency_symbol?(m(),f("tr",ed,[i("td",td,[i("strong",null,c(o.translations.exchange_rate),1)]),i("td",nd,c(n.quote.exchange_rate),1)])):y("",!0),n.client_currency!=n.default_currency_symbol?(m(),f("tr",sd,[i("td",od,[i("strong",null,c(o.translations.total)+" "+c(n.default_currency_symbol),1)]),i("td",id,c(o.totalAmountDefaultCurrency)+c(n.default_currency_symbol),1)])):y("",!0)])])],32),n.settings.easy_compta_signature_addon_active&&n.quote.signed==1&&n.quote.file_sign?(m(),f("div",ad,[i("div",ld,[i("span",rd,[i("img",{src:o.signatureImageUrl,alt:"Signature"},null,8,cd)])])])):y("",!0)]),_:1})])}var ud=he(tr,[["render",dd]]);const hd={name:"QuoteNew",components:{Card:Qe},data(){return{quote:{number:"",due_date:"",provisional_start_date:"",client:"",status:"pending"},loading:!1,loadingBtn:!1,clients:[],settings:[],last_quote_number:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},mounted(){this.fetchClients(),this.fetchSettings()},methods:{cancelAction(){this.$router.push("/quotes")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e;const s=`${this.settings.quote_prefix}_${String(this.settings.last_quote_id).padStart(4,"0")}`;this.quote.number=s}else{const e=await t.json()}}catch{this.loading=!1}},submitQuote(){this.loadingBtn=!0,fetch("/wp-json/my-easy-compta/v1/quotes",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.quote)}).then(t=>{if(!t.ok)throw this.loadingBtn=!1,new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"QuoteViewDetail",params:{id:t.id}})):(this.loadingBtn=!1,console.error("Error submitting quote:",t.message),this.showToast(t.message,"alert-error"))}).catch(t=>{this.loadingBtn=!1,console.error("Error submitting quote:",t),this.showToast(t,"alert-error")})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},md={class:"pt-2 pr-4"},fd={class:"flex justify-between items-center mb-4"},pd={class:"card-title"},gd=i("div",{class:"divider mt-2"},null,-1),_d={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},vd={class:"grid grid-cols-3 gap-4"},yd={class:"ecwp-group form-group mb-4"},bd={for:"quoteNumber",class:"ecwp-label"},wd={class:"ecwp-group form-group mb-4"},xd={for:"quoteDate",class:"ecwp-label"},Ed={class:"ecwp-group form-group mb-4"},Id={for:"quoteDate",class:"ecwp-label"},Cd={class:"grid grid-cols-2 gap-4"},Td={class:"ecwp-group form-group mb-4"},kd={for:"client",class:"ecwp-label"},Ad=["value","selected"],Sd={class:"ecwp-group form-group mb-4"},Pd={for:"status",class:"ecwp-label"},Dd={value:"draft",selected:""},jd={value:"pending"},qd={value:"approved"},Md={value:"rejected"},Rd={class:"flex justify-between"},Od=["disabled"],Nd={key:0,class:"loading loading-spinner loading-sm"};function Bd(t,e,s,a,n,o){const h=Q("Card");return m(),f("div",md,[B(h,{topMargin:"mt-8",modalType:"modal_quote_new"},{default:le(()=>[i("div",fd,[i("h2",pd,c(o.translations.new_quote),1)]),gd,n.loading?(m(),f("div",_d)):y("",!0),i("form",{onSubmit:e[6]||(e[6]=re((...r)=>o.submitQuote&&o.submitQuote(...r),["prevent"]))},[i("div",vd,[i("div",yd,[i("label",bd,c(o.translations.quote_number),1),q(i("input",{type:"text",id:"quoteNumber","onUpdate:modelValue":e[0]||(e[0]=r=>n.quote.number=r),class:"ecwp-input input input-bordered w-full",disabled:"disabled"},null,512),[[L,n.quote.number]])]),i("div",wd,[i("label",xd,c(o.translations.due_date),1),q(i("input",{type:"date",id:"quoteDate","onUpdate:modelValue":e[1]||(e[1]=r=>n.quote.due_date=r),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[L,n.quote.due_date]])]),i("div",Ed,[i("label",Id,c(o.translations.provisional_date),1),q(i("input",{type:"date",id:"quoteDate","onUpdate:modelValue":e[2]||(e[2]=r=>n.quote.provisional_start_date=r),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[L,n.quote.provisional_start_date]])])]),i("div",Cd,[i("div",Td,[i("label",kd,c(o.translations.company_name),1),q(i("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>n.quote.client_id=r),class:"ecwp-input input input-bordered w-full"},[(m(!0),f(F,null,W(n.clients,r=>(m(),f("option",{value:r.id,key:r.id,selected:r.id===n.quote.client_id},c(r.company_name)+" - "+c(r.email)+" ( "+c(r.currency_symbol)+" ) ",9,Ad))),128))],512),[[ye,n.quote.client_id]])]),i("div",Sd,[i("label",Pd,c(o.translations.status),1),q(i("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=r=>n.quote.status=r),class:"ecwp-input select select-bordered w-full"},[i("option",Dd,c(o.translations.draft),1),i("option",jd,c(o.translations.pending),1),i("option",qd,c(o.translations.approved),1),i("option",Md,c(o.translations.rejected),1)],512),[[ye,n.quote.status]])])]),i("div",Rd,[i("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[5]||(e[5]=(...r)=>o.cancelAction&&o.cancelAction(...r))},c(o.translations.cancel),1),i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.submit)+" ",1),n.loadingBtn?(m(),f("span",Nd)):y("",!0)],8,Od)])],32)]),_:1})])}var Vd=he(hd,[["render",Bd]]);const Fd={name:"InvoicesList",components:{Card:Qe,RemoveModal:xt},data(){return{invoices:[],showInvoiceDetailsModal:!1,editInvoiceModal:!1,selectedInvoice:null,currentPage:1,totalCount:0,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,loadingModal:!1,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",settings:{},toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},created(){this.fetchInvoices(),this.loadSettings()},methods:{fetchInvoices(t=1){this.loading=!0;const{perPage:e}=this;fetch(`/wp-json/my-easy-compta/v1/invoices?page=${t}&per_page=${e}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>s.json()).then(s=>{this.invoices=s.invoices,this.totalCount=s.total_count,this.totalPages=s.total_pages,this.currentPage=t,this.perPage=e,this.generatePaginationButtons()}).catch(s=>{console.error("Error fetching invoices:",s)}).finally(()=>{this.loading=!1})},async loadSettings(){try{this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s}=await Qt();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.loadingPrice=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1}},calculateVAT(t){return Jn(t,this.default_vat.rate)},calculateWithoutVAT(t){return Zn(t)},generatePaginationButtons(){this.paginationButtons=$n(this.currentPage,this.totalPages)},goToPage(t){t!=="..."&&this.fetchInvoices(t)},perPageChanged(){this.fetchInvoices()},formatAmount(t,e){return es(t,e,this.settings.currency_position)},showToast(t,e){ts(this.toast,t,e)},confirmDeleteInvoice(t){this.selectedInvoice=t,modal_remove.showModal(),this.showRemoveModal=!0},deleteInvoice(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/delete/${t}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?(this.fetchInvoices(),this.showToast(e.message,"alert-success")):(this.showToast(e.message,"alert-error"),console.error("Error deleting invoice:",e.statusText))}).catch(e=>{console.log(e.message);const s=e&&e.message?e.message:"Error deleting client";s==="This client cannot be deleted because it has associated data."?this.showToast(s,"alert-error"):console.error("Error deleting client:",e)})}},computed:{skeletonItems(){return Array.from({length:5},(t,e)=>e)},totalPages(){return Math.ceil(this.totalCount/this.perPage)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}}},Wd={class:"pt-2 pr-4"},Xd={class:"flex justify-between items-center"},Qd={class:"card-title"},Ud={class:"btn btn-primary rounded-full"},Ld=i("i",{class:"fas fa-plus-circle"},null,-1),zd=i("div",{class:"divider mt-2"},null,-1),Hd={class:"overflow-x-auto"},Gd={key:0,class:"table w-full"},Yd={class:"flex justify-center"},Kd={key:0,class:"badge badge-scondary badge-outline badge-sm"},Jd={key:1,class:"badge badge-warning badge-outline badge-sm"},Zd={key:2,class:"badge badge-success badge-outline badge-sm"},$d={key:3,class:"badge badge-secondary badge-outline badge-sm"},eu={key:0},tu={key:0},nu={key:0},su={key:1},ou={key:1},iu={key:0},au={key:1},lu={key:1},ru=i("span",{class:"loading loading-bars loading-sm"},null,-1),cu=[ru],du={key:0},uu={key:1},hu=i("span",{class:"loading loading-bars loading-sm"},null,-1),mu=[hu],fu={key:0},pu={key:1},gu=i("span",{class:"loading loading-bars loading-sm"},null,-1),_u=[gu],vu={class:"flex justify-end"},yu=["data-tip"],bu=i("button",{class:"btn btn-circle mx-1"},[i("i",{class:"far fa-eye"})],-1),wu=["data-tip"],xu=i("button",{class:"btn btn-circle mx-1"},[i("i",{class:"fas fa-pencil-alt"})],-1),Eu=["data-tip"],Iu=["onClick"],Cu=i("i",{class:"far fa-trash-alt"},null,-1),Tu=[Cu],ku={key:1},Au=i("div",{class:"flex gap-4 items-center"},[i("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),i("div",{class:"flex flex-col gap-4 w-full"},[i("div",{class:"skeleton h-4 w-full"}),i("div",{class:"skeleton h-4 w-full"})])],-1),Su=i("div",{class:"divider my-1"},null,-1),Pu=[Au,Su],Du={class:"join ecwp_pagination mt-6 pt-4"},ju=["onClick"];function qu(t,e,s,a,n,o){const h=Q("remove-modal"),r=Q("router-link"),d=Q("Card");return m(),f("div",Wd,[n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),B(h,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=u=>this.deleteInvoice(n.selectedInvoice)),onCancel:e[1]||(e[1]=u=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),B(d,{topMargin:"mt-8"},{default:le(()=>[i("div",Xd,[i("h2",Qd,c(o.translations.invoices),1),B(r,{to:{name:"InvoiceNew"}},{default:le(()=>[i("button",Ud,[T(c(o.translations.add)+" ",1),Ld])]),_:1})]),zd,i("div",Hd,[n.loading?(m(),f("div",ku,[(m(!0),f(F,null,W(n.skeletonRows,u=>(m(),f("div",{key:u,class:"flex flex-col gap-4 w-full"},Pu))),128))])):(m(),f("table",Gd,[i("thead",null,[i("tr",null,[i("th",null,c(o.translations.invoice_number),1),i("th",null,c(o.translations.client),1),i("th",null,c(o.translations.status),1),i("th",null,c(o.translations.total),1),i("th",null,c(o.translations.due_date),1),i("th",null,c(o.translations.created_at),1),i("th",Yd,c(o.translations.actions),1)])]),i("tbody",null,[(m(!0),f(F,null,W(n.invoices,u=>(m(),f("tr",{key:u.id},[i("td",null,c(u.invoice_number),1),i("td",null,c(u.client_name),1),i("td",null,[u.status=="draft"?(m(),f("span",Kd,c(o.translations.draft),1)):y("",!0),u.status=="unpaid"?(m(),f("span",Jd,c(o.translations.unpaid),1)):y("",!0),u.status=="paid"?(m(),f("span",Zd,c(o.translations.paid),1)):y("",!0),u.status=="cancelled"?(m(),f("span",$d,c(o.translations.cancelled),1)):y("",!0)]),i("td",null,[n.loadingPrice?(m(),f("div",lu,cu)):(m(),f("div",eu,[n.settings.vat_active==1?(m(),f("div",tu,[n.default_currency_symbol==u.client_currency||u.client_currency==null?(m(),f("span",nu,c(o.formatAmount(u.total_amount,n.default_currency_symbol)),1)):(m(),f("span",su,c(o.formatAmount(u.total_amount,u.client_currency)),1))])):(m(),f("div",ou,[n.default_currency_symbol==u.client_currency||u.client_currency==null?(m(),f("span",iu,c(o.formatAmount(u.total_amount,n.default_currency_symbol)),1)):(m(),f("span",au,c(o.formatAmount(u.total_amount,u.client_currency)),1))]))]))]),i("td",null,[n.loadingPrice?(m(),f("div",uu,mu)):(m(),f("div",du,c(u.due_date),1))]),i("td",null,[n.loadingPrice?(m(),f("div",pu,_u)):(m(),f("div",fu,c(u.created),1))]),i("td",vu,[i("span",{class:"lg:tooltip","data-tip":o.translations.view},[B(r,{to:{name:"InvoiceViewDetail",params:{id:u.id}}},{default:le(()=>[bu]),_:2},1032,["to"])],8,yu),u.status=="draft"?(m(),f("span",{key:0,class:"lg:tooltip","data-tip":o.translations.edit},[B(r,{to:{name:"InvoiceEdit",params:{id:u.id}}},{default:le(()=>[xu]),_:2},1032,["to"])],8,wu)):y("",!0),u.status=="draft"?(m(),f("span",{key:1,class:"lg:tooltip","data-tip":o.translations.delete},[i("button",{onClick:l=>o.confirmDeleteInvoice(u.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},Tu,8,Iu)],8,Eu)):y("",!0)])]))),128))])]))]),i("div",Du,[(m(!0),f(F,null,W(n.paginationButtons,u=>(m(),f("button",{key:u,class:G(["join-item btn",{"btn-disabled":u==="..."||u===n.currentPage}]),onClick:l=>o.goToPage(u)},c(u),11,ju))),128))])]),_:1})])}var Mu=he(Fd,[["render",qu]]);const Ru={name:"sendInvoice",components:{VueEditor:Ut.exports.VueEditor},props:{showModal:Boolean,modalId:String,client:Object,invoiceId:Number,loading:Boolean,subject:String,content:String},data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{loading:!1,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},toolbarOptions:[["bold","italic","underline","strike"],["link"],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],[{align:"right"},{align:"center"},{align:"justify"}],["clean"]],fields:{client_email:{label:t.client,value:"",disabled:!0},email_subject:{label:t.email_subject,value:""},email_message:{label:t.email_content,value:"",type:"textarea"}}}},watch:{client:{immediate:!0,handler(t){this.fields.client_email.value=(t==null?void 0:t.email)||""}},subject:{immediate:!0,handler(t){this.fields.email_subject.value=t||""}},content:{immediate:!0,handler(t){this.fields.email_message.value=t||""}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch("/wp-json/my-easy-compta/v1/emails/send-email",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({type:"invoice",id:this.invoiceId,client_email:this.client.email,email_subject:this.fields.email_subject.value,email_message:this.fields.email_message.value})});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success")}else{const e=`Error sending email: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error sending email";this.showToast(e,"alert-error"),console.error("Error sending email:",t),this.loadingBtn=!1}},updateFieldValue(t,e){this.fields[t].value=e},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Ou=["id","open"],Nu={class:"modal-box"},Bu={class:"font-bold text-lg"},Vu={key:0},Fu={class:"grid grid-cols-1 gap-4"},Wu=i("div",{class:"skeleton h-4 w-full mb-2"},null,-1),Xu=i("div",{class:"skeleton h-4 w-full"},null,-1),Qu=[Wu,Xu],Uu={class:"grid grid-cols-1 gap-4"},Lu=["type"],zu=["for"],Hu=["id","value","disabled","onInput"],Gu={key:1},Yu=["for"],Ku={class:"form-group mt-4 flex justify-end"},Ju=["disabled"],Zu={key:0,class:"loading loading-spinner loading-sm"};function $u(t,e,s,a,n,o){const h=Q("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),i("dialog",{id:s.modalId,class:"modal",open:s.showModal},[i("div",Nu,[i("h3",Bu,c(o.translations.send_invoice),1),i("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=r=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",Vu,[i("div",Fu,[(m(!0),f(F,null,W(o.skeletonItems,r=>(m(),f("div",{key:r,class:"py-2"},Qu))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=re((...r)=>o.submitForm&&o.submitForm(...r),["prevent"])),class:"form"},[i("div",Uu,[(m(!0),f(F,null,W(n.fields,(r,d)=>(m(),f("div",{key:d,class:"ecwp-group form-group"},[r.type!=="textarea"?(m(),f("div",{key:0,type:r.type||"text"},[i("label",{for:d,class:"ecwp-label form-label"},c(r.label),9,zu),i("input",{id:d,class:G(["ecwp-input input input-bordered",r.class||"w-full"]),value:r.value,disabled:r.disabled,onInput:u=>o.updateFieldValue(d,u.target.value)},null,42,Hu)],8,Lu)):(m(),f("div",Gu,[i("label",{for:d,class:"form-label"},c(r.label),9,Yu),B(h,{modelValue:r.value,"onUpdate:modelValue":u=>r.value=u,editorToolbar:n.toolbarOptions},null,8,["modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),i("div",Ku,[i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.send)+" ",1),n.loadingBtn?(m(),f("span",Zu)):y("",!0)],8,Ju)])],32))])],8,Ou)])}var eh=he(Ru,[["render",$u]]);const th={name:"InvoiceNavBar",components:{SendInvoiceModal:eh,RemoveModal:xt,ConfirmModal:vn},props:{invoiceInfo:Object,currencyDefault:Object,currencyClient:Object,emailActive:String},data(){return{loading:!1,sendInvoiceModal:!1,loadingModal:!1,loadingPdf:!1,client_detail:null,selectedStatus:null,subject:"",content:""}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{async changeInvoiceStatus(t,e){this.loading=!0;try{const a=await(await fetch("/wp-json/my-easy-compta/v1/invoices/update-status",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({id:this.invoiceInfo.id,status:t,method:e})})).json();a.success?(this.invoiceInfo.status=t,this.loading=!1):(console.error("Failed to update invoice status:",a.message),this.loading=!1)}catch(s){console.error("An error occurred while updating invoice status:",s)}},exportToPDF(t){this.loadingPdf=!0;let s=`/wp-json/my-easy-compta/v1/invoices/pdf/${this.invoiceInfo.id}?currency_id=${t}`;fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(a=>{if(!a.ok)throw this.loadingPdf=!1,new Error("Network response was not ok");return a.blob()}).then(a=>{const n=URL.createObjectURL(a);window.open(n),this.loadingPdf=!1}).catch(a=>{console.error("There was a problem with the fetch operation:",a),this.loadingPdf=!1})},sendInvoice(t){this.loadingModal=!0,this.sendInvoiceModal=!0,modal_send_invoice.showModal(),this.fetchClient(t),this.fetchSettings()},fetchClient(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e,this.loading=!1}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.subject=e.email_invoice_subject,this.content=e.email_invoice_content}else{const e=await t.json();this.showToast(e.message,"alert-error")}}catch(t){this.loading=!1,this.showToast(t.message,"alert-error")}},confirmValidateInvoice(t){this.selectedStatus=t,modal_confirm.showModal(),this.showConfirmModal=!0},confirmPaidPayment(t){}}},nh={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},sh=i("span",{class:"loading loading-spinner text-primary loading-lg"},null,-1),oh=[sh],ih={class:"navbar bg-base-100 mb-4 shadow-xl rounded-box flex justify-between"},ah=i("div",{class:"dropdown"},[i("div",{tabindex:"0",role:"button",class:"btn btn-ghost lg:hidden"},[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h8m-8 6h16"})])]),i("ul",{tabindex:"0",class:"menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52"},[i("li",null,[i("a",null,"Item")]),i("li",null,[i("a",null,"Parent"),i("ul",{class:"p-2"},[i("li",null,[i("a",null,"Submenu")]),i("li",null,[i("a",null,"Submenu")])])]),i("li",null,[i("a",null,"Item")])])],-1),lh={class:"hidden lg:flex gap-2"},rh={class:"btn btn-sm"},ch=i("i",{class:"far fa-edit"},null,-1),dh=i("i",{class:"fa fa-check"},null,-1),uh=i("i",{class:"fa fa-times"},null,-1),hh=["disabled"],mh=i("i",{class:"far fa-file-pdf"},null,-1),fh={key:0,class:"loading loading-spinner loading-sm"},ph={class:"flex gap-2"},gh=i("i",{class:"fas fa-paper-plane"},null,-1),_h={key:0},vh={key:1},yh={key:2,class:"far fa-envelope"},bh={key:1},wh={key:0,class:"dropdown dropdown-end"},xh={tabindex:"0",role:"button",class:"btn btn-outline btn-success btn-sm"},Eh=i("i",{class:"far fa-file-pdf"},null,-1),Ih={key:0,class:"loading loading-spinner loading-sm"},Ch={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow"},Th=["disabled"],kh=["disabled"],Ah={key:2},Sh=["disabled"],Ph=i("i",{class:"far fa-file-pdf"},null,-1),Dh={key:0},jh={key:1},qh={key:2,class:"loading loading-spinner loading-sm"},Mh=i("i",{class:"fas fa-check"},null,-1);function Rh(t,e,s,a,n,o){const h=Q("send-invoice-modal"),r=Q("confirm-modal"),d=Q("router-link");return m(),f("div",null,[i("div",null,[B(h,{loading:n.loadingModal,"show-modal":n.sendInvoiceModal,"modal-id":"modal_send_invoice",client:n.client_detail,"invoice-id":s.invoiceInfo.id,subject:n.subject,content:n.content,onClose:e[0]||(e[0]=u=>n.sendInvoiceModal=!1)},null,8,["loading","show-modal","client","invoice-id","subject","content"])]),B(r,{"show-modal":t.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,status:n.selectedStatus,onConfirm:e[1]||(e[1]=u=>this.changeInvoiceStatus(n.selectedStatus)),onCancel:e[2]||(e[2]=u=>t.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText","status"]),n.loading?(m(),f("div",nh,oh)):y("",!0),i("div",ih,[i("div",null,[ah,i("div",lh,[s.invoiceInfo.status=="draft"?(m(),Os(d,{key:0,to:{name:"InvoiceEdit",params:{id:s.invoiceInfo.id}}},{default:le(()=>[i("button",rh,[ch,T(" "+c(o.translations.edit_invoice),1)])]),_:1},8,["to"])):y("",!0),s.invoiceInfo.status=="unpaid"||s.invoiceInfo.status=="cancelled"?(m(),f("button",{key:1,class:"btn btn-outline btn-success btn-sm hover:text-white",onClick:e[3]||(e[3]=u=>o.confirmValidateInvoice("paid"))},[dh,T(" "+c(o.translations.mark_as_paid),1)])):y("",!0),s.invoiceInfo.status=="unpaid"||s.invoiceInfo.status=="paid"?(m(),f("button",{key:2,class:"btn btn-outline btn-secondary btn-sm hover:text-white",onClick:e[4]||(e[4]=u=>o.confirmValidateInvoice("cancelled"))},[uh,T(" "+c(o.translations.mark_as_cancelled),1)])):y("",!0)])]),s.invoiceInfo.status=="draft"?(m(),f("button",{key:0,onClick:e[5]||(e[5]=u=>o.exportToPDF(s.currencyDefault.currency_id)),class:"btn btn-outline btn-secondary btn-sm",disabled:n.loadingPdf},[mh,i("span",null,c(o.translations.previewPDF),1),n.loadingPdf?(m(),f("span",fh)):y("",!0)],8,hh)):y("",!0),i("div",ph,[s.emailActive==1&&s.invoiceInfo.status!="draft"?(m(),f("button",{key:0,onClick:e[6]||(e[6]=re(u=>o.sendInvoice(s.invoiceInfo.client_id),["prevent"])),class:"btn btn-outline btn-primary btn-sm hover:text-white"},[gh,s.invoiceInfo.sent==1?(m(),f("span",_h,c(o.translations.resend_invoice),1)):(m(),f("span",vh,c(o.translations.send_invoice),1)),s.invoiceInfo.sent==1?(m(),f("i",yh)):y("",!0)])):y("",!0),s.currencyDefault.currency_id!==s.currencyClient.currency_id?(m(),f("div",bh,[s.invoiceInfo.status!="draft"?(m(),f("div",wh,[i("div",xh,[Eh,T(" "+c(o.translations.exportToPDF)+" ",1),n.loadingPdf?(m(),f("span",Ih)):y("",!0)]),i("ul",Ch,[i("li",null,[i("a",{onClick:e[7]||(e[7]=u=>o.exportToPDF(s.currencyDefault.currency_id)),disabled:n.loadingPdf},c(o.translations.invoice_in)+" "+c(s.currencyDefault.currency_symbol),9,Th)]),i("li",null,[i("a",{onClick:e[8]||(e[8]=u=>o.exportToPDF(s.currencyClient.currency_id)),disabled:n.loadingPdf},c(o.translations.invoice_in)+" "+c(s.currencyClient.currency_symbol),9,kh)])])])):y("",!0)])):(m(),f("div",Ah,[s.invoiceInfo.status!="draft"?(m(),f("button",{key:0,onClick:e[9]||(e[9]=u=>o.exportToPDF(s.currencyDefault.currency_id)),class:"btn btn-outline btn-success btn-sm",disabled:n.loadingPdf},[Ph,s.invoiceInfo.status!="draft"?(m(),f("span",Dh,c(o.translations.exportToPDF),1)):(m(),f("span",jh,c(o.translations.previewPDF),1)),n.loadingPdf?(m(),f("span",qh)):y("",!0)],8,Sh)):y("",!0)])),s.invoiceInfo.status=="draft"?(m(),f("button",{key:3,class:"btn btn-outline btn-success btn-sm hover:text-white",onClick:e[10]||(e[10]=u=>o.confirmValidateInvoice("unpaid"))},[Mh,T(" "+c(o.translations.validateInvoice),1)])):y("",!0)])])])}var Oh=he(th,[["render",Rh]]);const Nh={components:{VueEditor:Ut.exports.VueEditor},props:{loading:Boolean,showModal:Boolean,modalId:String,modalTitle:String,item:Object},data(){return{editedItem:{...this.item},loading:this.loading,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{item_name:{label:"Nom de l'item"},item_description:{label:"Description de l'item",type:"textarea"},quantity:{label:"Quantit\xE9",type:"number"},vat_rate:{label:"Taux de TVA",type:"number"},unit_price:{label:"Prix unitaire",type:"number"},discount:{label:"Remise",type:"number"}}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch(`/wp-json/my-easy-compta/v1/invoices/edit-item/${this.editedItem.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedItem)});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success"),this.$emit("itemEdited")}else{const e=`Error editing item: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error editing item";this.showToast(e,"alert-error"),console.error("Error editing item:",t),this.loadingBtn=!1}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--}},watch:{item:{handler(t){this.editedItem={...t}},immediate:!0}}},Bh=["id","open"],Vh={class:"modal-box"},Fh={class:"font-bold text-lg"},Wh={key:0},Xh={class:"grid grid-cols-1 gap-4"},Qh=i("div",{class:"skeleton h-4 w-full mb-2"},null,-1),Uh=i("div",{class:"skeleton h-4 w-full"},null,-1),Lh=[Qh,Uh],zh={class:"grid grid-cols-1 gap-4"},Hh=["type"],Gh=["for"],Yh=["id","onUpdate:modelValue"],Kh={key:1},Jh=["for"],Zh={class:"form-group mt-4 flex justify-end"},$h=["disabled"],em={key:0,class:"loading loading-spinner loading-sm"};function tm(t,e,s,a,n,o){const h=Q("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),i("dialog",{id:s.modalId,class:"modal",open:s.showModal},[i("div",Vh,[i("h3",Fh,c(s.modalTitle),1),i("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=r=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",Wh,[i("div",Xh,[(m(!0),f(F,null,W(o.skeletonItems,r=>(m(),f("div",{key:r,class:"py-2"},Lh))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=re((...r)=>o.submitForm&&o.submitForm(...r),["prevent"])),class:"form"},[i("div",zh,[(m(!0),f(F,null,W(n.fields,(r,d)=>(m(),f("div",{key:d,class:"ecwp-group form-group"},[r.type!=="textarea"?(m(),f("div",{key:0,type:r.type||"text"},[i("label",{for:d,class:"ecwp-label form-label"},c(r.label),9,Gh),q(i("input",{id:d,"onUpdate:modelValue":u=>n.editedItem[d]=u,class:G(["ecwp-input input input-bordered",r.class||"w-full"])},null,10,Yh),[[L,n.editedItem[d]]])],8,Hh)):(m(),f("div",Kh,[i("label",{for:d,class:"form-label"},c(r.label),9,Jh),B(h,{id:d,modelValue:n.editedItem[d],"onUpdate:modelValue":u=>n.editedItem[d]=u,editorToolbar:t.toolbarOptions},null,8,["id","modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),i("div",Zh,[i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",em)):y("",!0)],8,$h)])],32))])],8,Bh)])}var nm=he(Nh,[["render",tm]]);const sm={name:"InvoiceViewDetail",components:{Card:Qe,InvoiceNavBar:Oh,EditItemModal:nm,RemoveModal:xt},data(){return{selectedItem:null,SelectedInvoiceId:null,editItemsModal:!1,loading:!1,loading_add:!1,invoice:[],invoiceItems:[],newItem:{loading_del:!1,item_name:"",item_ref:"",item_category:"Type",item_description:"",quantity:1,vat_rate:0,unit_price:0,discount:0,total_price:0,total_amount:0},settings:[],client_detail:[],list_vats:[],client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",articles:[],categories:[],refs:[],showDropdown:!1,showDropdownRef:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},isInvoiceOverdue(){const t=ns(this.invoice.due_date,this.settings.date_format),e=new Date;return t&&t<e},defaultCurrency(){return{currency_id:this.settings.default_currency,currency_symbol:this.default_currency_symbol}},clientCurrency(){return{currency_id:this.client_detail.currency_id,currency_symbol:this.client_currency}},totalAmountWithoutDiscount(){const t=this.invoiceItems.reduce((e,s)=>{const a=s.quantity*s.unit_price;return e+a},0);return this.formatCurrency(t)},totalAmount(){const t=this.invoiceItems.reduce((e,s)=>e+parseFloat(s.total_price),0);return this.formatCurrency(t)},totalAmountDefaultCurrency(){return(this.invoiceItems.reduce((a,n)=>a+parseFloat(n.total_amount),0)*this.invoice.exchange_rate).toFixed(2)},totalAmountWithVAT(){const t=parseFloat(this.totalAmount);if(this.settings.vat_active==1){const e=parseFloat(this.calculateVAT());return this.formatCurrency(t+e)}else return this.formatCurrency(t)}},methods:{getUniqueVATRates(){const t=new Set;return this.invoiceItems.forEach(e=>{e.vat_rate&&t.add(e.vat_rate)}),Array.from(t)},calculateVATForRate(t){let e=0;return this.invoiceItems.forEach(s=>{if(s.vat_rate===t){const a=s.quantity*s.unit_price,n=a*s.discount/100;e+=(a-n)*t/100}}),this.formatCurrency(e)},calculateTotalAmountWithVAT(){let t=this.invoiceItems.reduce((e,s)=>e+parseFloat(s.total_amount),0);return this.formatCurrency(t)},fetchInvoice(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${this.$route.params.id}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t?(this.invoice=t,this.fetchClientInfo(t.client_id)):console.error("Invoice not found")}).catch(t=>{console.error("Error fetching invoice:",t),this.loading=!1})},fetchClientInfo(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e;const s=e.currency_id;s&&this.fetchCurrencyDetails(s)}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},fetchItems(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${this.$route.params.id}/items`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t.code=="no_items_found"?(console.error("No items found"),this.invoiceItems=[],this.loading=!1):(this.invoiceItems=t,this.loading=!1)}).catch(t=>{console.error("Error fetching items:",t),this.loading=!1})},fetchCurrencyDetails(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/settings/currency/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw this.loading=!1,new Error("Currency details not found");return this.loading=!1,e.json()}).then(e=>{this.client_currency=e.symbol,this.loading=!1}).catch(e=>{this.loading=!1,console.error("Error fetching currency details:",e)})},updateTotal(){const t=this.newItem.quantity*this.newItem.unit_price,e=t*this.newItem.discount/100,s=t-e,a=s*this.newItem.vat_rate/100,n=s+a;this.newItem.total_price=this.formatCurrency(s),this.newItem.total_amount=this.formatCurrency(n)},calculateTotal(t,e,s,a){const n=t*e,o=n*a/100,h=n-o,r=h*s/100,d=h+r;return this.formatCurrency(d)},submitItems(){this.updateTotal();const t={...this.newItem,invoice_id:this.$route.params.id};this.loading_add=!0,fetch("/wp-json/my-easy-compta/v1/invoices/element-add",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e.success?(this.loading_add=!1,this.fetchItems(),this.newItem={item_name:"",item_ref:"",item_category:"Type",item_description:"",quantity:1,vat_rate:this.default_vat.rate,unit_price:0,discount:0,total_price:0,total_amount:0}):(this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e.message),this.loading_add=!1)}).catch(e=>{this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e),this.loading_add=!1})},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--},confirmremoveItem(t,e){this.selectedItem=t,this.SelectedInvoiceId=e,modal_remove.showModal(),this.showRemoveModal=!0},removeItem(t,e){const s=this.invoiceItems.find(a=>a.id===t);s.loading_del=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/element-delete/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({invoice_id:e})}).then(a=>a.json()).then(a=>{a.success?(s.loading_del=!1,this.fetchItems()):(this.showToast(a.message,"alert-error"),console.error("Error removing item:",a.message),s.loading_del=!1)}).catch(a=>{this.showToast(a.message,"alert-error"),console.error("Error removing item:",a),s.loading_del=!1})},editItem(t){this.loadingModal=!0,this.editItemsModal=!0,modal_edit_item.showModal(),this.fetchItemDetails(t)},fetchItemDetails(t){fetch(`/wp-json/my-easy-compta/v1/invoices/item-details/${t}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{this.selectedItem=e,this.loading=!1}).catch(e=>{console.error("Error fetching item details:",e),this.loading=!1})},formatCurrency(t){if(isNaN(t))return"0,00";const e=t.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g," "),s=this.client_currency!==this.default_currency_symbol?this.client_currency:this.default_currency_symbol;return`${e} ${s}`},calculateDiscountAmount(t,e,s,a){const o=t*e*a/100,h=o*s/100,r=o+h;return this.formatCurrency(r)},calculateVAT(){const t=parseFloat(this.totalAmount),e=parseFloat(this.default_vat.rate),s=t*(e/100);return this.formatCurrency(s)},onDragEnd(t){const e=this.invoiceItems[t.oldIndex];this.invoiceItems.splice(t.oldIndex,1),this.invoiceItems.splice(t.newIndex,0,e);const s=this.invoiceItems.map(a=>a.id);this.saveOrderToDatabase(s)},nl2br(t){return t?t.replace(/\n/g,"<br>"):""},resize(){let t=this.$refs.textarea;t.style.height="auto",t.style.height=t.scrollHeight+"px"},saveOrderToDatabase(t){fetch("/wp-json/my-easy-compta/v1/invoices/update-invoice-items-order",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({order:t})}).then(e=>{e.ok?console.log("Order saved successfully."):console.error("Failed to save order:",e.statusText)}).catch(e=>{console.error("Error saving order:",e)})},fetchCategoriesArticles(){fetch("/wp-json/my-easy-compta/v1/categories-articles",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.categories=t}).catch(t=>console.error("Error fetching categories:",t))},fetchArticles(){if(this.newItem.item_name.length<1){this.articles=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_name}&method=name`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.articles=t}).catch(t=>console.error("Error fetching articles:",t))},selectItem(t){this.newItem.item_ref=t.ref,this.newItem.item_name=t.name,this.newItem.item_description=t.description,this.newItem.unit_price=t.unit_price,this.showDropdown=!1,this.showDropdownRef=!1},fetchRefs(){if(this.newItem.item_ref.length<1){this.refs=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_ref}&method=ref`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.refs=t}).catch(t=>console.error("Error fetching refrences:",t))},async loadSettings(){try{this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s,listVatData:a}=await Qt();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.list_vats=a,this.newItem.vat_rate=this.default_vat.rate,this.loadingPrice=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1}},highlightMatch(t){if(!this.newItem.item_name)return t;const e=new RegExp(`(${this.escapeRegExp(this.newItem.item_name)})`,"gi");return t.replace(e,"<b>$1</b>")},escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},handleClickOutside(t){this.$el.contains(t.target)||(this.showDropdown=!1,this.showDropdownRef=!1)},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},mounted(){this.fetchInvoice(),this.fetchItems(),this.loadSettings(),this.fetchCategoriesArticles(),document.addEventListener("click",this.handleClickOutside);const t=document.querySelector("tbody");k.create(t,{animation:150,handle:".drag-handle",onEnd:this.onDragEnd})}},om={class:"pt-2 pr-4"},im={key:1,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},am=i("span",{class:"loading loading-spinner text-primary loading-lg"},null,-1),lm=[am],rm={key:2},cm={role:"alert",class:"alert alert-warning"},dm=i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),um={class:"grid grid-cols-2"},hm={class:"md:col-span-1"},mm=["src"],fm={class:"md:col-span-1 text-right"},pm={class:"text-lg font-semibold"},gm={key:0,class:"badge badge-error text-white"},_m={key:1,class:"badge badge-error text-white"},vm={key:2,class:"badge badge-success text-white"},ym={key:3,class:"badge badge-secondary text-white"},bm={class:"bg-base-300 rounded-lg shadow-md flex justify-between p-4 mt-4 gap-4"},wm=i("br",null,null,-1),xm=i("br",null,null,-1),Em=i("br",null,null,-1),Im={key:0,href:"tel:{{ client_detail.phone }}"},Cm=i("br",null,null,-1),Tm=i("br",null,null,-1),km=i("br",null,null,-1),Am={key:0,href:"tel:{{ settings.company_phone }}"},Sm=i("br",null,null,-1),Pm={key:1,href:"tel:{{ settings.mobile_phone }}"},Dm={class:"table mt-8"},jm=i("th",null,null,-1),qm={width:"5%"},Mm={width:"19%"},Rm={width:"21%"},Om={width:"10%",class:"text-center"},Nm={width:"8%",class:"text-center"},Bm={width:"5%",class:"text-center"},Vm={width:"10%",class:"text-center"},Fm={width:"10%",class:"text-right"},Wm=i("th",{width:"18%",class:"text-right inv-actions"},null,-1),Xm=i("td",{class:"draggable-item drag-handle px-2"},[i("i",{class:"fas fa-bars"})],-1),Qm={key:0,class:"badge badge-ghost badge-xs"},Um=["innerHTML"],Lm={class:"text-center"},zm={class:"text-center"},Hm={key:0},Gm={key:1},Ym={class:"text-center"},Km={class:"text-center"},Jm=i("br",null,null,-1),Zm={class:"text-right"},$m={key:0},ef={key:1},tf={key:0},nf=["data-tip"],sf=["onClick"],of=i("i",{class:"far fa-edit"},null,-1),af=[of],lf=["data-tip"],rf=["onClick"],cf={key:0,class:"far fa-trash-alt"},df={key:1,class:"loading loading-spinner loading-xs"},uf={key:0},hf=i("td",{class:"px-2"},null,-1),mf={class:"align-top px-2"},ff={class:"flex items-center border rounded-md relative"},pf=["placeholder"],gf={key:0,class:"autocomplete-dropdown bg-base-100"},_f=["onClick","innerHTML"],vf={class:"align-top px-2"},yf=i("option",{disabled:"",selected:""},"Type",-1),bf=["value"],wf={class:"flex items-center border rounded-md relative"},xf=["placeholder"],Ef={key:0,class:"autocomplete-dropdown bg-base-100"},If=["onClick","innerHTML"],Cf={class:"align-top"},Tf={class:"flex items-center rounded-md"},kf=["placeholder"],Af={class:"align-top"},Sf={class:"flex items-center border rounded-lg"},Pf={class:"inline-flex"},Df=["placeholder"],jf={class:"align-top"},qf={class:"flex items-center border rounded-md"},Mf=["placeholder"],Rf={class:"align-top"},Of=["value"],Nf={class:"align-top"},Bf={class:"flex items-center border rounded-md"},Vf=["placeholder"],Ff=i("div",{class:"px-3 py-2.5 rounded-l-md bg-base-300 border-r"}," % ",-1),Wf={class:"text-right"},Xf=["data-tip"],Qf={type:"submit",class:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"},Uf={key:0,class:"fa fa-plus"},Lf={key:1,class:"loading loading-spinner loading-xs"},zf={colspan:"8",class:"text-right no-border"},Hf={class:"text-right"},Gf={key:0,class:"line-through"},Yf=i("td",null,null,-1),Kf={colspan:"8",class:"text-right no-border"},Jf={class:"text-right"},Zf=i("td",null,null,-1),$f={colspan:"8",class:"text-right no-border font-bold text-xl"},ep={class:"text-right no-border font-bold text-xl"},tp=i("td",null,null,-1),np={key:2},sp={colspan:"8",class:"text-right no-border"},op={class:"text-right no-border"},ip={key:3},ap={colspan:"8",class:"text-right no-border"},lp={class:"text-right no-border font-bold text-xl"};function rp(t,e,s,a,n,o){const h=Q("InvoiceNavBar"),r=Q("remove-modal"),d=Q("edit-item-modal"),u=Q("Card");return m(),f("div",om,[B(h,{invoiceInfo:n.invoice,currencyDefault:o.defaultCurrency,currencyClient:o.clientCurrency,emailActive:n.settings.easy_compta_email_addon_active},null,8,["invoiceInfo","currencyDefault","currencyClient","emailActive"]),B(r,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=l=>this.removeItem(n.selectedItem,n.SelectedInvoiceId)),onCancel:e[1]||(e[1]=l=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),n.toast.visible?(m(),f("div",{key:0,class:G(["toast",n.toast.position]),style:{zIndex:9999}},[i("div",{class:G(["alert",n.toast.type,"text-white"])},[i("span",null,c(n.toast.message),1)],2)],2)):y("",!0),n.loading?(m(),f("div",im,lm)):y("",!0),o.isInvoiceOverdue&&n.invoice.status=="unpaid"?(m(),f("div",rm,[i("div",cm,[dm,i("span",null,c(o.translations.invoice_overdue),1)])])):y("",!0),B(u,{topMargin:"mt-8",id:"invoice-content"},{default:le(()=>[i("div",um,[i("div",hm,[i("div",null,[i("img",{src:n.settings.logo_url,style:Kn({width:n.settings.logo_width+"px"}),alt:"Logo"},null,12,mm)])]),i("div",fm,[i("p",pm,c(n.invoice.invoice_number),1),i("div",null,[T(c(o.translations.created_at)+": ",1),i("strong",null,c(n.invoice.created_at),1)]),i("div",null,[T(c(o.translations.due_date)+": ",1),i("strong",null,c(n.invoice.due_date),1)]),i("div",null,[T(c(o.translations.status)+": ",1),n.invoice.status=="draft"?(m(),f("span",gm,c(o.translations.draft),1)):y("",!0),n.invoice.status=="unpaid"?(m(),f("span",_m,c(o.translations.unpaid),1)):y("",!0),n.invoice.status=="paid"?(m(),f("span",vm,c(o.translations.paid),1)):y("",!0),n.invoice.status=="cancelled"?(m(),f("span",ym,c(o.translations.cancelled),1)):y("",!0)])])]),i("div",bm,[i("div",null,[i("strong",null,c(o.translations.bill_to)+":",1),i("h4",null,[i("strong",null,c(n.client_detail.company_name),1)]),i("p",null,[T(c(n.client_detail.address),1),wm,T(" "+c(n.client_detail.postal_code)+", "+c(n.client_detail.city)+" ",1),xm,T(" "+c(n.client_detail.country),1),Em,n.client_detail.phone?(m(),f("a",Im,c(n.client_detail.phone),1)):y("",!0)])]),i("div",null,[i("strong",null,c(o.translations.received_from)+":",1),i("h4",null,[i("strong",null,c(n.settings.company_name),1)]),i("p",null,[T(c(n.settings.company_address),1),Cm,T(" "+c(n.settings.postal_code)+", "+c(n.settings.city)+" ",1),Tm,T(" "+c(n.settings.country),1),km,n.settings.company_phone?(m(),f("a",Am,c(n.settings.company_phone),1)):y("",!0),Sm,n.settings.mobile_phone?(m(),f("a",Pm,c(n.settings.mobile_phone),1)):y("",!0)])])]),B(d,{loading:t.loadingModal,"show-modal":n.editItemsModal,"modal-id":"modal_edit_item","modal-title":o.translations.edit_item,item:n.selectedItem,onClose:e[2]||(e[2]=l=>n.editItemsModal=!1),onItemEdited:o.fetchItems},null,8,["loading","show-modal","modal-title","item","onItemEdited"]),i("form",{onSubmit:e[22]||(e[22]=re((...l)=>o.submitItems&&o.submitItems(...l),["prevent"]))},[i("table",Dm,[i("thead",null,[i("tr",null,[jm,i("th",qm,c(o.translations.item_ref),1),i("th",Mm,c(o.translations.item_name),1),i("th",Rm,c(o.translations.description),1),i("th",Om,c(o.translations.quantity),1),i("th",Nm,c(o.translations.unit_price),1),i("th",Bm,c(o.translations.vat),1),i("th",Vm,c(o.translations.discount),1),i("th",Fm,c(o.translations.total),1),Wm])]),i("tbody",null,[(m(!0),f(F,null,W(n.invoiceItems,(l,p)=>(m(),f("tr",{key:l.id||p},[Xm,i("td",null,c(l.item_ref),1),i("td",null,[l.category_name?(m(),f("div",Qm,c(l.category_name),1)):y("",!0),i("div",null,c(l.item_name),1)]),i("td",{innerHTML:o.nl2br(l.item_description)},null,8,Um),i("td",Lm,c(l.quantity),1),i("td",zm,[T(c(l.unit_price),1),n.default_currency_symbol==n.client_currency?(m(),f("span",Hm,c(n.default_currency_symbol),1)):(m(),f("span",Gm,c(n.client_currency),1))]),i("td",Ym,c(l.vat_rate)+"%",1),i("td",Km,[T(c(l.discount)+"% ",1),Jm,T(" "+c(o.calculateDiscountAmount(l.quantity,l.unit_price,l.vat_rate,l.discount)),1)]),i("td",Zm,[T(c(l.total_amount)+" ",1),n.default_currency_symbol==n.client_currency?(m(),f("span",$m,c(n.default_currency_symbol),1)):(m(),f("span",ef,c(n.client_currency),1))]),i("td",null,[n.invoice.status=="draft"?(m(),f("div",tf,[i("span",{class:"lg:tooltip","data-tip":o.translations.edit},[i("button",{onClick:re(g=>o.editItem(l.id),["prevent"]),class:"bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded"},af,8,sf)],8,nf),i("span",{class:"lg:tooltip","data-tip":o.translations.delete},[i("button",{onClick:re(g=>o.confirmremoveItem(l.id,n.invoice.id),["prevent"]),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-3 mx-2 rounded"},[l.loading_del?y("",!0):(m(),f("i",cf)),l.loading_del?(m(),f("span",df)):y("",!0)],8,rf)],8,lf)])):y("",!0)])]))),128)),n.invoice.status=="draft"?(m(),f("tr",uf,[hf,i("td",mf,[i("div",ff,[q(i("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>n.newItem.item_ref=l),onInput:e[4]||(e[4]=(...l)=>o.fetchRefs&&o.fetchRefs(...l)),onFocus:e[5]||(e[5]=l=>n.showDropdownRef=!0),placeholder:o.translations.item_ref,class:"w-full p-2.5 input-xs outline-none"},null,40,pf),[[L,n.newItem.item_ref]]),n.showDropdownRef&&n.refs.length?(m(),f("ul",gf,[(m(!0),f(F,null,W(n.refs,l=>(m(),f("li",{key:l.ref,onClick:p=>o.selectItem(l),class:"autocomplete-item",innerHTML:o.highlightMatch(l.ref)},null,8,_f))),128))])):y("",!0)])]),i("td",vf,[q(i("select",{class:"select select-xs w-full mb-1 ecwp-select","onUpdate:modelValue":e[6]||(e[6]=l=>n.newItem.item_category=l)},[yf,(m(!0),f(F,null,W(n.categories,l=>(m(),f("option",{key:l.id,value:l.id},c(l.name),9,bf))),128))],512),[[ye,n.newItem.item_category]]),i("div",wf,[q(i("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=l=>n.newItem.item_name=l),onInput:e[8]||(e[8]=(...l)=>o.fetchArticles&&o.fetchArticles(...l)),onFocus:e[9]||(e[9]=l=>n.showDropdown=!0),placeholder:o.translations.item_name,class:"w-full p-2.5 bg-transparent input-xs outline-none"},null,40,xf),[[L,n.newItem.item_name]]),n.showDropdown&&n.articles.length?(m(),f("ul",Ef,[(m(!0),f(F,null,W(n.articles,l=>(m(),f("li",{key:l.name,onClick:p=>o.selectItem(l),class:"autocomplete-item bt-primary",innerHTML:o.highlightMatch(l.name)},null,8,If))),128))])):y("",!0)])]),i("td",Cf,[i("div",Tf,[q(i("textarea",{"onUpdate:modelValue":e[10]||(e[10]=l=>n.newItem.item_description=l),placeholder:o.translations.item_description,class:"textarea textarea-bordered input-xs w-full",onInput:e[11]||(e[11]=l=>o.resize()),ref:"textarea"},null,40,kf),[[L,n.newItem.item_description]])])]),i("td",Af,[i("div",Sf,[i("div",Pf,[i("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-l",onClick:e[12]||(e[12]=(...l)=>o.decrease&&o.decrease(...l))}," - "),q(i("input",{type:"number",min:"1","onUpdate:modelValue":e[13]||(e[13]=l=>n.newItem.quantity=l),placeholder:o.translations.quantity,class:"w-full p-2.5 bg-transparent outline-none max-w-40",onInput:e[14]||(e[14]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Df),[[L,n.newItem.quantity]]),i("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-r",onClick:e[15]||(e[15]=(...l)=>o.increase&&o.increase(...l))}," + ")])])]),i("td",jf,[i("div",qf,[q(i("input",{type:"number","onUpdate:modelValue":e[16]||(e[16]=l=>n.newItem.unit_price=l),placeholder:o.translations.unit_price,class:"w-full p-2.5 bg-transparent outline-none max-w-40",onInput:e[17]||(e[17]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Mf),[[L,n.newItem.unit_price]])])]),i("td",Rf,[q(i("select",{"onUpdate:modelValue":e[18]||(e[18]=l=>n.newItem.vat_rate=l),onChange:e[19]||(e[19]=(...l)=>o.updateTotal&&o.updateTotal(...l)),class:"select select-sm w-full mb-1 ecwp-select min-w-20"},[(m(!0),f(F,null,W(n.list_vats,l=>(m(),f("option",{key:l,value:l.rate},c(l.rate)+"% ",9,Of))),128))],544),[[ye,n.newItem.vat_rate]])]),i("td",Nf,[i("div",Bf,[q(i("input",{type:"number","onUpdate:modelValue":e[20]||(e[20]=l=>n.newItem.discount=l),min:"0",max:"100",placeholder:o.translations.discount,class:"w-full p-2.5 bg-transparent outline-none max-w-40",onInput:e[21]||(e[21]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Vf),[[L,n.newItem.discount]]),Ff])]),i("td",Wf,c(o.calculateTotal(n.newItem.quantity,n.newItem.unit_price,n.newItem.vat_rate,n.newItem.discount)),1),i("td",null,[i("span",{class:"lg:tooltip","data-tip":o.translations.add},[i("button",Qf,[n.loading_add?y("",!0):(m(),f("i",Uf)),n.loading_add?(m(),f("span",Lf)):y("",!0)])],8,Xf)])])):y("",!0),i("tr",null,[i("td",zf,[i("strong",null,c(o.translations.subtotal),1)]),i("td",Hf,[o.totalAmount!==o.totalAmountWithoutDiscount?(m(),f("span",Gf,c(o.totalAmountWithoutDiscount),1)):y("",!0),T(" "+c(o.totalAmount),1)]),Yf]),n.settings.vat_active==1?(m(!0),f(F,{key:1},W(o.getUniqueVATRates(),(l,p)=>(m(),f("tr",{key:p},[i("td",Kf,[i("strong",null,c(o.translations.tax)+" ("+c(l)+"%) ",1)]),i("td",Jf,c(o.calculateVATForRate(l)),1),Zf]))),128)):y("",!0),i("tr",null,[i("td",$f,[i("strong",null,c(o.translations.total),1)]),i("td",ep,c(o.calculateTotalAmountWithVAT()),1),tp]),n.client_currency!=n.default_currency_symbol?(m(),f("tr",np,[i("td",sp,[i("strong",null,c(o.translations.exchange_rate),1)]),i("td",op,c(n.invoice.exchange_rate),1)])):y("",!0),n.client_currency!=n.default_currency_symbol?(m(),f("tr",ip,[i("td",ap,[i("strong",null,c(o.translations.total)+" "+c(n.default_currency_symbol),1)]),i("td",lp,c(o.totalAmountDefaultCurrency)+c(n.default_currency_symbol),1)])):y("",!0)])])],32)]),_:1})])}var cp=he(sm,[["render",rp]]);const dp={name:"InvoiceNew",components:{Card:Qe},data(){return{invoice:{number:"",date:"",client_id:"",status:"unpaid",exchange_rate:0},loading:!1,loadingBtn:!1,clients:[],settings:[],last_invoice_number:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},currencyMismatch(){const t=this.clients.find(e=>e.id===this.invoice.client_id);return t&&this.settings.default_currency!==t.currency_id}},mounted(){this.fetchClients(),this.fetchSettings()},methods:{cancelAction(){this.$router.push("/invoices")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e;const s=`${this.settings.invoice_prefix}_${String(this.settings.last_invoice_id).padStart(4,"0")}`;this.invoice.number=s}else{const e=await t.json()}}catch{this.loading=!1}},handleClientChange(){const t=this.clients.find(e=>e.id===this.invoice.client_id);t&&this.settings.default_currency!==t.currency_id?this.invoice.exchange_rate=1:this.invoice.exchange_rate=0},submitInvoice(){this.loadingBtn=!0,fetch("/wp-json/my-easy-compta/v1/invoices",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.invoice)}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"InvoiceViewDetail",params:{id:t.id}})):(console.error("Error submitting invoice:",t.message),this.showToast(t.message,"alert-error"),this.loadingBtn=!1)}).catch(t=>{console.error("Error submitting invoice:",t),this.showToast(t,"alert-error"),this.loadingBtn=!1})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},up={class:"pt-2 pr-4"},hp={class:"flex justify-between items-center mb-4"},mp={class:"card-title"},fp=i("div",{class:"divider mt-2"},null,-1),pp={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},gp={class:"grid grid-cols-2 gap-4"},_p={class:"ecwp-group form-group mb-4"},vp={for:"invoiceNumber",class:"ecwp-label"},yp={class:"ecwp-group form-group mb-4"},bp={for:"invoiceDate",class:"ecwp-label"},wp={class:"ecwp-group form-group mb-4"},xp={for:"client",class:"ecwp-label"},Ep=["value"],Ip={class:"ecwp-group form-group mb-4"},Cp={for:"status",class:"ecwp-label"},Tp={value:"draft",selected:""},kp={key:0,class:"ecwp-group form-group mb-4"},Ap={for:"exchangeRate",class:"ecwp-label"},Sp={class:"flex justify-between"},Pp=["disabled"],Dp={key:0,class:"loading loading-spinner loading-sm"};function jp(t,e,s,a,n,o){const h=Q("Card");return m(),f("div",up,[B(h,{topMargin:"mt-8",modalType:"modal_invoice_new"},{default:le(()=>[i("div",hp,[i("h2",mp,c(o.translations.new_invoice),1)]),fp,n.loading?(m(),f("div",pp)):y("",!0),i("form",{onSubmit:e[7]||(e[7]=re((...r)=>o.submitInvoice&&o.submitInvoice(...r),["prevent"]))},[i("div",gp,[i("div",_p,[i("label",vp,c(o.translations.invoice_number),1),q(i("input",{type:"text",id:"invoiceNumber","onUpdate:modelValue":e[0]||(e[0]=r=>n.invoice.number=r),class:"ecwp-input input input-bordered w-full",disabled:"disabled"},null,512),[[L,n.invoice.number]])]),i("div",yp,[i("label",bp,c(o.translations.due_date),1),q(i("input",{type:"date",id:"invoiceDate","onUpdate:modelValue":e[1]||(e[1]=r=>n.invoice.date=r),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[L,n.invoice.date]])]),i("div",wp,[i("label",xp,c(o.translations.company_name),1),q(i("select",{id:"client","onUpdate:modelValue":e[2]||(e[2]=r=>n.invoice.client_id=r),onChange:e[3]||(e[3]=(...r)=>o.handleClientChange&&o.handleClientChange(...r)),class:"ecwp-input select select-bordered w-full",required:""},[(m(!0),f(F,null,W(n.clients,r=>(m(),f("option",{key:r.id,value:r.id},c(r.company_name)+" - "+c(r.email)+" ( "+c(r.currency_symbol)+" ) ",9,Ep))),128))],544),[[ye,n.invoice.client_id]])]),i("div",Ip,[i("label",Cp,c(o.translations.status),1),q(i("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=r=>n.invoice.status=r),class:"ecwp-input select select-bordered w-full"},[i("option",Tp,c(o.translations.draft),1)],512),[[ye,n.invoice.status]])]),o.currencyMismatch?(m(),f("div",kp,[i("label",Ap,c(o.translations.exchange_rate),1),q(i("input",{type:"text",id:"exchangeRate","onUpdate:modelValue":e[5]||(e[5]=r=>n.invoice.exchange_rate=r),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[L,n.invoice.exchange_rate]])])):y("",!0)]),i("div",Sp,[i("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[6]||(e[6]=(...r)=>o.cancelAction&&o.cancelAction(...r))},c(o.translations.cancel),1),i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.submit)+" ",1),n.loadingBtn?(m(),f("span",Dp)):y("",!0)],8,Pp)])],32)]),_:1})])}var qp=he(dp,[["render",jp]]);const Mp={name:"invoiceEdit",components:{Card:Qe},data(){return{invoice:{invoice_number:"",due_date:"",client_id:"",client:null,status:"paid",exchange_rate:0},loading:!1,loadingBtn:!1,clients:[],settings:[],toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},currencyMismatch(){const t=this.clients.find(e=>e.id===this.invoice.client_id);return t&&this.settings.default_currency!==t.currency_id}},mounted(){this.fetchClients(),this.fetchSettings(),this.fetchInvoiceDetails()},methods:{cancelAction(){this.$router.push("/invoices")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e}else{const e=await t.json();console.error("Error fetching settings:",e)}}catch(t){this.loading=!1,console.error("Error fetching settings:",t)}},fetchInvoiceDetails(){const t=this.$route.params.id;!t||(this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{e?(this.invoice=e,console.log(this.invoice)):(console.error("Error fetching invoice details:",e.message),this.showToast(e.message,"alert-error"))}).catch(e=>{console.error("Error fetching invoice details:",e),this.showToast(e,"alert-error")}).finally(()=>{this.loading=!1}))},setClientById(t){this.invoice.client=this.clients.find(e=>e.id===t)||null},handleClientChange(){const t=this.clients.find(e=>e.id===this.invoice.client_id);t&&this.settings.default_currency!==t.currency_id?this.invoice.exchange_rate=1:this.invoice.exchange_rate=0},submitInvoice(){this.loadingBtn=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${this.$route.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.invoice)}).then(t=>{if(!t.ok)throw this.loadingBtn=!1,new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"InvoiceViewDetail",params:{id:t.id}})):(this.loadingBtn=!1,console.error("Error submitting invoice:",t.message),this.showToast(t.message,"alert-error"))}).catch(t=>{this.loadingBtn=!1,console.error("Error submitting invoice:",t),this.showToast(t,"alert-error")})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Rp={class:"pt-2 pr-4"},Op={class:"flex justify-between items-center mb-4"},Np={class:"card-title"},Bp=i("div",{class:"divider mt-2"},null,-1),Vp={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},Fp={class:"grid grid-cols-2 gap-4"},Wp={class:"ecwp-group form-group mb-4"},Xp={for:"invoiceNumber",class:"ecwp-label"},Qp={class:"ecwp-group form-group mb-4"},Up={for:"invoiceDate",class:"ecwp-label"},Lp={class:"ecwp-group form-group mb-4"},zp={for:"client",class:"ecwp-label"},Hp=["value","selected"],Gp={class:"ecwp-group form-group mb-4"},Yp={for:"status",class:"ecwp-label"},Kp={value:"draft",selected:""},Jp={value:"unpaid"},Zp={value:"paid"},$p={value:"cancelled"},eg={key:0,class:"ecwp-group form-group mb-4"},tg={for:"exchangeRate",class:"ecwp-label"},ng={class:"flex justify-between"},sg=["disabled"],og={key:0,class:"loading loading-spinner loading-sm"};function ig(t,e,s,a,n,o){const h=Q("Card");return m(),f("div",Rp,[B(h,{topMargin:"mt-8",modalType:"modal_invoice_new"},{default:le(()=>[i("div",Op,[i("h2",Np,c(o.translations.edit_invoice),1)]),Bp,n.loading?(m(),f("div",Vp)):y("",!0),i("form",{onSubmit:e[6]||(e[6]=re((...r)=>o.submitInvoice&&o.submitInvoice(...r),["prevent"]))},[i("div",Fp,[i("div",Wp,[i("label",Xp,c(o.translations.invoice_number),1),q(i("input",{type:"text",id:"invoiceNumber","onUpdate:modelValue":e[0]||(e[0]=r=>n.invoice.invoice_number=r),class:"ecwp-input input input-bordered w-full",disabled:"true"},null,512),[[L,n.invoice.invoice_number]])]),i("div",Qp,[i("label",Up,c(o.translations.due_date),1),q(i("input",{type:"date",id:"invoiceDate","onUpdate:modelValue":e[1]||(e[1]=r=>n.invoice.due_date=r),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[L,n.invoice.due_date]])]),i("div",Lp,[i("label",zp,c(o.translations.company_name),1),q(i("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>n.invoice.client_id=r),class:"ecwp-input input input-bordered w-full"},[(m(!0),f(F,null,W(n.clients,r=>(m(),f("option",{value:r.id,key:r.id,selected:r.id===n.invoice.client_id},c(r.company_name)+" - "+c(r.email)+" ( "+c(r.currency_symbol)+" ) ",9,Hp))),128))],512),[[ye,n.invoice.client_id]])]),i("div",Gp,[i("label",Yp,c(o.translations.status),1),q(i("select",{id:"status","onUpdate:modelValue":e[3]||(e[3]=r=>n.invoice.status=r),class:"ecwp-input select select-bordered w-full"},[i("option",Kp,c(o.translations.draft),1),i("option",Jp,c(o.translations.unpaid),1),i("option",Zp,c(o.translations.paid),1),i("option",$p,c(o.translations.cancelled),1)],512),[[ye,n.invoice.status]])]),o.currencyMismatch?(m(),f("div",eg,[i("label",tg,c(o.translations.exchange_rate),1),q(i("input",{type:"text",id:"exchangeRate","onUpdate:modelValue":e[4]||(e[4]=r=>n.invoice.exchange_rate=r),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[L,n.invoice.exchange_rate]])])):y("",!0)]),i("div",ng,[i("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[5]||(e[5]=(...r)=>o.cancelAction&&o.cancelAction(...r))},c(o.translations.cancel),1),i("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[T(c(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",og)):y("",!0)],8,sg)])],32)]),_:1})])}var ag=he(Mp,[["render",ig]]);const ae=Xt;(function(t,e){const s=Xt,a=t();for(;[];)try{if(parseInt(s(206))/1+-parseInt(s(222))/2+parseInt(s(216))/3+-parseInt(s(210))/4+parseInt(s(209))/5*(-parseInt(s(227))/6)+-parseInt(s(211))/7+parseInt(s(221))/8===e)break;a.push(a.shift())}catch{a.push(a.shift())}})(Wt,826049);function Wt(){const t=["/quotes","InvoiceViewDetail","4566LGvHOa","/invoice/new","/quote/new","1492169qYhqFz","/invoice/edit/:id","/invoices","7190lgfOdV","1844348YorQzI","11446008inrPQK","InvoiceNew","Invoice","QuoteNew","/quote/detail/:id","2621058PUvWDZ","/quote/edit/:id","Quote","/invoice/detail/:id","InvoiceEdit","24376344NCUcHi","2792600qEXehc","QuoteViewDetail","QuoteEdit"];return Wt=function(){return t},Wt()}function Xt(t,e){const s=Wt();return Xt=function(a,n){return a=a-205,s[a]},Xt(t,e)}const lg=[{path:ae(225),name:ae(218),component:Ia},{path:ae(215),name:ae(223),component:ud},{path:ae(205),name:ae(214),component:Vd},{path:ae(217),name:ae(224),component:ps},{path:ae(208),name:ae(213),component:Mu},{path:ae(219),name:ae(226),component:cp},{path:ae(207),name:ae(220),component:ag},{path:ae(228),name:ae(212),component:qp}],hg=Wo({history:po(),routes:lg});export{hg as r};
